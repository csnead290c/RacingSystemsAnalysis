import{u as Kr,a as Yr,b as Mr,r as v,j as e,c as we,s as ar,d as Ar,e as Ir,f as Fr,g as Zr,v as et,h as Qe,V as Xe,i as Br,k as Hr,R as Rr,W as tr,T as or,P as Pr,l as rt,m as kr,B as tt,n as J,Z as $e,o as Le,J as Oe,p as Ue,A as xe,C as Lr,q as Dr,t as ot,w as it,F as nt,x as st,K as lt,y as at,z as dt,D as ct,E as mt,G as ht,H as Tr,I as Cr,L as zr,M as pt,N as ut,O as gt,Q as ft,S as bt,U as Ee,X as xt,Y as vt,_ as ir,$ as yt,a0 as _t,a1 as jt,a2 as Nr,a3 as qe,a4 as Wr,a5 as nr,a6 as Be,a7 as St,a8 as Rt,a9 as Pt,aa as kt}from"./index-CLxRD22T.js";const Ke=["quarterJr","quarterPro","admin"],sr={quarterJr:"Quarter Jr",quarterPro:"Quarter Pro",admin:"Admin / Developer"},Tt={quarterJr:"Basic mode - enter peak HP and RPM, other parameters are calculated automatically",quarterPro:"Full mode - enter complete HP curve and all vehicle parameters",admin:"Developer mode - all features plus dev tools and diagnostics"};function Ct(r,t){const n=Ke.indexOf(r),i=Ke.indexOf(t);return n>=i}function Et(r){return Ct(r,"quarterPro")}const fe={engine:["peakHP","rpmAtPeakHP","displacement_cid","fuelSystem"],vehicle:["weight_lb","wheelbase_in","tireDia_in","tireWidth_in","rollout_in","bodyStyle"],drivetrain:["gearRatios","finalDrive","shiftRPM","isConverter","slipStallRPM","converterDia_in"],environment:["elevation_ft","barometer_inHg","temperature_F","relHumidity_pct","trackTemp_F","tractionIndex","wind_mph","wind_angle_deg"]},He={engine:["hpCurve","hpTorqueMultiplier"],vehicle:["staticFrontWeight_lb","cgHeight_in","overhang_in"],drivetrain:["perGearEff","shiftsRPM","launchRPM","slippage","torqueMult","lockup"],aero:["frontalArea_ft2","Cd","Cl"],pmi:["engine_flywheel_clutch","transmission_driveshaft","tires_wheels_ringgear"]};function wt(r){return Et(r)?{engine:[...fe.engine,...He.engine],vehicle:[...fe.vehicle,...He.vehicle],drivetrain:[...fe.drivetrain,...He.drivetrain],environment:[...fe.environment],aero:[...He.aero],pmi:[...He.pmi]}:{engine:fe.engine,vehicle:fe.vehicle,drivetrain:fe.drivetrain,environment:fe.environment,aero:[],pmi:[]}}function Mt(){const r=Kr(),t=Yr(),{setFlag:n,setUserLevel:i,resetFlags:c}=Mr(),s=wt(t),[p,u]=v.useState([]),[a,k]=v.useState(""),[_,C]=v.useState(!0),[T,P]=v.useState(!1),m=v.useRef(null);v.useEffect(()=>{const g=console.log,S=console.warn,o=console.error,b=(x,...l)=>{const y=new Date().toISOString().split("T")[1].slice(0,12),A=l.map(N=>typeof N=="object"?JSON.stringify(N):String(N)).join(" "),I=`[${y}] [${x}] ${A}`;u(N=>[...N.slice(-500),I])};return console.log=(...x)=>{g(...x),b("LOG",...x)},console.warn=(...x)=>{S(...x),b("WARN",...x)},console.error=(...x)=>{o(...x),b("ERROR",...x)},()=>{console.log=g,console.warn=S,console.error=o}},[]),v.useEffect(()=>{_&&m.current&&(m.current.scrollTop=m.current.scrollHeight)},[p,_]);const R=()=>{const g=p.join(`
`),S=new Blob([g],{type:"text/plain"}),o=URL.createObjectURL(S),b=document.createElement("a");b.href=o,b.download=`rsa-logs-${Date.now()}.log`,b.click(),URL.revokeObjectURL(o)},h=a?p.filter(g=>g.toLowerCase().includes(a.toLowerCase())):p,j=[{key:"vb6StrictMode",label:"VB6 Strict Mode",description:"Require complete VB6 fixture for simulation (no defaults)"},{key:"showDiagnostics",label:"Show Diagnostics",description:"Display debug information in console and UI"},{key:"enableStepTrace",label:"Step Trace",description:"Log detailed step-by-step simulation data"},{key:"enableEnergyLogging",label:"Energy Logging",description:"Log energy balance calculations"}];return e.jsxs("div",{style:{padding:"2rem",height:"100%",overflow:"auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Settings & Flags"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Configure user level, feature flags, and debug options."})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"User Level (Program Tier)"}),e.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem"},children:Ke.map(g=>e.jsx("button",{onClick:()=>i(g),style:{flex:1,padding:"0.75rem",fontSize:"0.875rem",fontWeight:t===g?"600":"400",backgroundColor:t===g?g==="admin"?"#8b5cf6":g==="quarterPro"?"#3b82f6":"#10b981":"var(--color-bg)",color:t===g?"white":"var(--color-text)",border:`2px solid ${t===g?g==="admin"?"#8b5cf6":g==="quarterPro"?"#3b82f6":"#10b981":"var(--color-border)"}`,borderRadius:"var(--radius-md)",cursor:"pointer",transition:"all 0.2s"},children:sr[g]},g))}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--color-muted)",marginBottom:"1rem"},children:[e.jsx("strong",{children:"Current:"})," ",sr[t]," ‚Äî ",Tt[t]]}),e.jsxs("details",{style:{fontSize:"0.875rem"},children:[e.jsxs("summary",{style:{cursor:"pointer",fontWeight:"500",marginBottom:"0.5rem"},children:["View Available Inputs for ",sr[t]]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"0.75rem",padding:"0.75rem",backgroundColor:"var(--color-bg)",borderRadius:"var(--radius-sm)",marginTop:"0.5rem"},children:[e.jsxs("div",{children:[e.jsx("strong",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"Engine"}),e.jsxs("ul",{style:{margin:"0.25rem 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:[s.engine.slice(0,5).map(g=>e.jsx("li",{children:g},g)),s.engine.length>5&&e.jsxs("li",{children:["+",s.engine.length-5," more"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"Vehicle"}),e.jsxs("ul",{style:{margin:"0.25rem 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:[s.vehicle.slice(0,5).map(g=>e.jsx("li",{children:g},g)),s.vehicle.length>5&&e.jsxs("li",{children:["+",s.vehicle.length-5," more"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"Drivetrain"}),e.jsxs("ul",{style:{margin:"0.25rem 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:[s.drivetrain.slice(0,5).map(g=>e.jsx("li",{children:g},g)),s.drivetrain.length>5&&e.jsxs("li",{children:["+",s.drivetrain.length-5," more"]})]})]})]})]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:"600"},children:"Feature Flags"}),e.jsx("button",{onClick:c,style:{padding:"0.375rem 0.75rem",fontSize:"0.75rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-sm)",cursor:"pointer"},children:"Reset All"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"0.75rem"},children:j.map(g=>e.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.5rem",padding:"0.75rem",backgroundColor:r[g.key]?"#dbeafe":"var(--color-bg)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r[g.key],onChange:S=>n(g.key,S.target.checked),style:{marginTop:"2px"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"500",fontSize:"0.875rem"},children:g.label}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:g.description})]})]},g.key))})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem"},children:[e.jsxs("h3",{style:{margin:0,fontSize:"1rem",fontWeight:"600"},children:["Console Logs (",p.length,")"]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>P(!T),style:{padding:"0.375rem 0.75rem",fontSize:"0.75rem",backgroundColor:T?"#3b82f6":"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-sm)",cursor:"pointer"},children:T?"Hide":"Show"}),e.jsx("button",{onClick:R,disabled:p.length===0,style:{padding:"0.375rem 0.75rem",fontSize:"0.75rem",backgroundColor:p.length>0?"#10b981":"#d1d5db",color:"white",border:"none",borderRadius:"var(--radius-sm)",cursor:p.length>0?"pointer":"not-allowed"},children:"Download"}),e.jsx("button",{onClick:()=>u([]),disabled:p.length===0,style:{padding:"0.375rem 0.75rem",fontSize:"0.75rem",backgroundColor:p.length>0?"#ef4444":"#d1d5db",color:"white",border:"none",borderRadius:"var(--radius-sm)",cursor:p.length>0?"pointer":"not-allowed"},children:"Clear"})]})]}),T&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("input",{type:"text",value:a,onChange:g=>k(g.target.value),placeholder:"Filter logs...",style:{flex:1,padding:"0.375rem 0.5rem",fontSize:"0.75rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-sm)",backgroundColor:"var(--color-bg)"}}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem"},children:[e.jsx("input",{type:"checkbox",checked:_,onChange:g=>C(g.target.checked)}),"Auto-scroll"]})]}),e.jsx("div",{ref:m,style:{height:"200px",padding:"0.5rem",backgroundColor:"#1e293b",color:"#e2e8f0",borderRadius:"var(--radius-sm)",fontFamily:"monospace",fontSize:"0.7rem",overflow:"auto",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:h.length===0?e.jsx("div",{style:{color:"#9ca3af",fontStyle:"italic"},children:p.length===0?"No logs yet":"No matches"}):h.map((g,S)=>{let o="#e2e8f0";return g.includes("[WARN]")&&(o="#fbbf24"),g.includes("[ERROR]")&&(o="#ef4444"),e.jsx("div",{style:{color:o},children:g},S)})})]})]})]})}function Ye(r){var n,i,c,s,p,u;const t=[];return r.drivetrain?((n=r.drivetrain.gearRatios)!=null&&n.length||t.push("drivetrain.gearRatios"),(i=r.drivetrain.perGearEff)!=null&&i.length||t.push("drivetrain.perGearEff"),r.drivetrain.gearRatios&&r.drivetrain.perGearEff&&r.drivetrain.gearRatios.length!==r.drivetrain.perGearEff.length&&t.push("perGearEff length must equal gearRatios length"),!r.drivetrain.clutch&&!r.drivetrain.converter&&t.push("drivetrain.clutch or drivetrain.converter"),(!r.engineHP||r.engineHP.length<2)&&t.push("engineHP (>=2 points)"),(c=r.fuel)!=null&&c.type||t.push("fuel.type"),((s=r.pmi)==null?void 0:s.engine_flywheel_clutch)==null&&t.push("pmi.engine_flywheel_clutch"),((p=r.pmi)==null?void 0:p.transmission_driveshaft)==null&&t.push("pmi.transmission_driveshaft"),((u=r.pmi)==null?void 0:u.tires_wheels_ringgear)==null&&t.push("pmi.tires_wheels_ringgear"),t.length?{ok:!1,missing:t}:{ok:!0}):(t.push("drivetrain.*"),{ok:!1,missing:t})}function At(){var m,R;const{fixture:r}=we(),[t,n]=v.useState(null),[i,c]=v.useState(null),[s,p]=v.useState(null),[u,a]=v.useState(null),[k,_]=v.useState(null),C=()=>{a("validate"),_(null);try{const h=Ye(r);n(h)}catch(h){_((h==null?void 0:h.message)??String(h))}finally{a(null)}},T=async()=>{a("dryrun"),_(null),c(null);try{const h=Ye(r);c({ok:h.ok,message:h.ok?"Fixture can be normalized successfully":`Missing fields: ${h.missing.join(", ")}`,details:h})}catch(h){_((h==null?void 0:h.message)??String(h))}finally{a(null)}},P=async()=>{var h,j,g;a("smoke"),_(null),p(null);try{const S=await ar("VB6Exact",{...r,raceLengthFt:1320});p({et_s:S.et_s,mph:S.mph,model:(h=S.meta)==null?void 0:h.model,steps:(g=(j=S.meta)==null?void 0:j.termination)==null?void 0:g.steps})}catch(S){_((S==null?void 0:S.message)??String(S))}finally{a(null)}};return e.jsxs("div",{style:{padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Health Check"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Quick validation and testing tools for VB6 fixtures."})]}),k&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem",whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"0.875rem",color:"#991b1b"},children:k}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem",marginBottom:"2rem"},children:[e.jsx("button",{onClick:C,disabled:u!==null,style:{padding:"1rem",fontSize:"1rem",fontWeight:500,backgroundColor:u==="validate"?"#9ca3af":"#3b82f6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:u!==null?"not-allowed":"pointer",transition:"background-color 0.2s"},children:u==="validate"?"Validating...":"Validate Current VB6 Fixture"}),e.jsx("button",{onClick:T,disabled:u!==null,style:{padding:"1rem",fontSize:"1rem",fontWeight:500,backgroundColor:u==="dryrun"?"#9ca3af":"#8b5cf6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:u!==null?"not-allowed":"pointer",transition:"background-color 0.2s"},children:u==="dryrun"?"Running...":"Normalize & Dry-Run"}),e.jsx("button",{onClick:P,disabled:u!==null,style:{padding:"1rem",fontSize:"1rem",fontWeight:500,backgroundColor:u==="smoke"?"#9ca3af":"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:u!==null?"not-allowed":"pointer",transition:"background-color 0.2s"},children:u==="smoke"?"Running...":"Smoke Sim (1320 ft)"})]}),t&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:t.ok?"#dcfce7":"#fee2e2",border:`1px solid ${t.ok?"#22c55e":"#ef4444"}`,borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.5rem",fontSize:"1rem"},children:"Validation Result"}),t.ok?e.jsx("p",{style:{margin:0,color:"#166534"},children:"‚úÖ Fixture is valid and complete"}):e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 0.5rem 0",color:"#991b1b",fontWeight:500},children:"‚ùå Fixture is incomplete"}),e.jsx("p",{style:{margin:"0 0 0.5rem 0",color:"#991b1b",fontSize:"0.875rem"},children:"Missing fields:"}),e.jsx("ul",{style:{margin:0,paddingLeft:"1.5rem",color:"#991b1b"},children:t.missing.map(h=>e.jsx("li",{style:{fontSize:"0.875rem"},children:h},h))})]})]}),i&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:i.ok?"#dbeafe":"#fee2e2",border:`1px solid ${i.ok?"#3b82f6":"#ef4444"}`,borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.5rem",fontSize:"1rem"},children:"Dry-Run Result"}),e.jsxs("p",{style:{margin:0,color:i.ok?"#1e40af":"#991b1b"},children:[i.ok?"‚úÖ":"‚ùå"," ",i.message]})]}),s&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#dcfce7",border:"1px solid #22c55e",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem"},children:"Smoke Test Result"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#166534",marginBottom:"0.25rem"},children:"ET (s)"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#166534"},children:((m=s.et_s)==null?void 0:m.toFixed(3))??"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#166534",marginBottom:"0.25rem"},children:"MPH"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#166534"},children:((R=s.mph)==null?void 0:R.toFixed(2))??"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#166534",marginBottom:"0.25rem"},children:"Model"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:"500",color:"#166534"},children:s.model??"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#166534",marginBottom:"0.25rem"},children:"Steps"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:"500",color:"#166534"},children:s.steps??"N/A"})]})]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#eff6ff",border:"1px solid #3b82f6",borderRadius:"var(--radius-md)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.5rem",fontSize:"1rem"},children:"About These Tests"}),e.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.875rem"},children:[e.jsxs("li",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Validate:"})," Checks if all required VB6 fixture fields are present"]}),e.jsxs("li",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Dry-Run:"})," Validates that the fixture can be normalized (no actual simulation)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Smoke Sim:"})," Runs a quick 1320 ft simulation to verify the fixture works end-to-end"]})]})]})]})}function It(r){var t;return(((t=r[r.length-1])==null?void 0:t.rpm)??8e3)+100}function Ft(r){const t=r.pmi??{};return{engine_flywheel_clutch:t.engine_flywheel_clutch??3.42,transmission_driveshaft:t.transmission_driveshaft??.247,tires_wheels_ringgear:t.tires_wheels_ringgear??50.8}}function Bt(r){const t=r.environment??{};return{elevationFt:t.elevation_ft??t.elevation??0,baroInHg:t.barometer_inHg??t.barometer??29.92,tempF:t.temp_F??t.temperature??59,rhPct:t.rel_humidity_pct??t.humidity??0,windMPH:t.wind_mph??t.windVelocity??0,windDeg:t.wind_angle_deg??t.windAngle??0,trackTempF:t.trackTemp_F??t.trackTemp??80,tractionIdx:t.tractionIndex??3}}function Ht(r,t){var C,T,P,m,R,h,j,g;const n=Ft(r),i=Bt(r),c=t<=660?"EIGHTH":"QUARTER",s=r.drivetrain??{},p={finalDrive:Number(s.finalDrive??s.final_drive??0),overallEff:Number(s.overallEff??s.overallEfficiency??s.efficiency??1),gearRatios:Array.isArray(s.gearRatios)?s.gearRatios.map(Number):[],perGearEff:Array.isArray(s.perGearEff)?s.perGearEff.map(Number):[],shiftRPM:Array.isArray(s.shiftRPM??s.shiftsRPM)?(s.shiftRPM??s.shiftsRPM).map(Number):[],clutch:s.clutch?{...s.clutch}:void 0,converter:s.converter?{...s.converter}:void 0},u=r.vehicle??{},a={weightLb:u.weight_lb??u.weight??r.weight??2400,wheelbaseIn:u.wheelbase_in??u.wheelbase??107,tireRolloutIn:((C=r.finalDrive)==null?void 0:C.tireRolloutIn)??u.tire_rollout_in??u.rollout??102.5,tireWidthIn:((T=r.finalDrive)==null?void 0:T.tireWidthIn)??u.tire_width_in??u.tireWidth??17,frontalAreaFt2:((P=r.aero)==null?void 0:P.frontalArea)??u.frontalArea_ft2??18.2,Cd:((m=r.aero)==null?void 0:m.cd)??u.Cd??.24,Cl:((R=r.aero)==null?void 0:R.cl)??u.Cl??.1,overhangIn:u.overhang_in??u.overhang??40},k={model:"VB6Exact",distanceFt:t,raceLength:c,env:i,vehicle:a,drivetrain:p,pmi:n,fuel:r.fuel};if(r.engineHP&&Array.isArray(r.engineHP)){const S=((h=r==null?void 0:r.fuel)==null?void 0:h.hpTorqueMultiplier)??1,o=(r.engineHP??[]).map(b=>Array.isArray(b)?{rpm:Number(b[0]),hp:Number(b[1])*S}:{rpm:Number(b==null?void 0:b.rpm),hp:Number(b==null?void 0:b.hp)*S}).filter(b=>Number.isFinite(b.rpm)&&Number.isFinite(b.hp)).sort((b,x)=>b.rpm-x.rpm);o.length>=2&&(k.engineParams={powerHP:o,redlineRPM:It(o),idleRPM:900})}const _=Number.isFinite(t)?Number(t):Number(r==null?void 0:r.raceLengthFt)||((r==null?void 0:r.raceLength)==="EIGHTH"?660:1320);if(k.raceLengthFt=_,k.raceLength=_===660?"EIGHTH":"QUARTER",!((j=k.engineParams)!=null&&j.powerHP)&&Array.isArray(r==null?void 0:r.engineHP)){const S=((g=r==null?void 0:r.fuel)==null?void 0:g.hpTorqueMultiplier)??1,o=r.engineHP.map(b=>Array.isArray(b)?{rpm:Number(b[0]),hp:Number(b[1])*S}:{rpm:Number(b==null?void 0:b.rpm),hp:Number(b==null?void 0:b.hp)*S}).filter(b=>Number.isFinite(b.rpm)&&Number.isFinite(b.hp)).sort((b,x)=>b.rpm-x.rpm);o.length>=2&&(k.engineParams={...k.engineParams??{},powerHP:o})}return k}function Lt({onSelect:r,showEditButton:t=!0,onEditClick:n}){const{vehicles:i,activeVehicleId:c,setActiveVehicleById:s,loading:p}=Ar(),u=a=>{const k=a.target.value||null;s(k),k&&r&&r(k)};return p?e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)",marginBottom:"1rem",border:"1px solid var(--color-border)"},children:e.jsx("span",{style:{color:"var(--color-text-secondary)",fontSize:"0.875rem"},children:"Loading vehicles..."})}):e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)",marginBottom:"1rem",border:"1px solid var(--color-border)",display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:"500",color:"var(--color-text)",whiteSpace:"nowrap"},children:"Active Vehicle:"}),e.jsxs("select",{value:c??"",onChange:u,style:{flex:1,padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"},children:[e.jsx("option",{value:"",children:"‚Äî Select a vehicle ‚Äî"}),i.map(a=>e.jsx("option",{value:a.id,children:a.name||a.id},a.id))]}),t&&c&&e.jsx("button",{onClick:n,style:{padding:"0.5rem 0.75rem",fontSize:"0.75rem",backgroundColor:"var(--color-primary)",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer",whiteSpace:"nowrap"},children:"Edit in Vehicle Editor"}),i.length===0&&e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",fontStyle:"italic"},children:"No vehicles saved yet"})]})}function Dt(r){var t,n;if(!((t=r==null?void 0:r.engineParams)!=null&&t.powerHP)&&Array.isArray(r==null?void 0:r.engineHP)){const i=((n=r==null?void 0:r.fuel)==null?void 0:n.hpTorqueMultiplier)??1,c=r.engineHP.map(s=>Array.isArray(s)?{rpm:Number(s[0]),hp:Number(s[1])*i}:{rpm:Number(s==null?void 0:s.rpm),hp:Number(s==null?void 0:s.hp)*i}).filter(s=>Number.isFinite(s.rpm)&&Number.isFinite(s.hp)).sort((s,p)=>s.rpm-p.rpm);c.length>=2&&(r.engineParams={...r.engineParams??{},powerHP:c})}return r}function zt(){var l,y,A,I,N,Q,re,te,oe,ie,ae,ne,Y,de,se;const r=Ir(),{fixture:t,setFixture:n}=we(),i=Fr("enableStepTrace"),c=Mr(),{userLevel:s,setUserLevel:p}=c,{activeVehicle:u}=Ar(),[a,k]=v.useState("QUARTER"),[_,C]=v.useState(!1),[T,P]=v.useState(null),[m,R]=v.useState(null),[h,j]=v.useState([]),g=Ye(t),S=d=>{var w,B,F;if(console.log("[RunInspector] Vehicle selected:",d),u&&u.id===d)try{const z=Zr(u),D=et(z);if(!D.ok){console.warn("[RunInspector] Adapter validation warnings:",D.errors),P(`Vehicle data incomplete: ${D.errors.join("; ")}`);return}n(z),console.log("[RunInspector] Fixture updated from vehicle:",{vehicleId:d,vehicleName:u.name,engineHPCount:(w=z.engineHP)==null?void 0:w.length,gearCount:(F=(B=z.drivetrain)==null?void 0:B.gearRatios)==null?void 0:F.length})}catch(z){console.error("[RunInspector] Failed to convert vehicle to fixture:",z),P(`Failed to load vehicle: ${z.message}`)}},o=()=>{v.startTransition(()=>r("/vehicles"))},b=async()=>{var w,B,F,z,D,E,Z;if(!t){P("No fixture loaded.");return}C(!0),P(null),R(null),j([]);let d=null;try{const V=a==="EIGHTH"?660:1320;d=Ht(t,V),d=Dt(d),d.raceLengthFt=V,console.log("[RUN] powerHP?",Array.isArray((w=d==null?void 0:d.engineParams)==null?void 0:w.powerHP),(z=(F=(B=d==null?void 0:d.engineParams)==null?void 0:B.powerHP)==null?void 0:F.slice)==null?void 0:z.call(F,0,2),"raceLengthFt",d==null?void 0:d.raceLengthFt);const H=await ar("VB6Exact",d);R(H),j([])}catch(V){const H=(D=d==null?void 0:d.engineParams)==null?void 0:D.powerHP;console.error("[Run Inspector error]",V,{hpSummary:Array.isArray(H)?`n=${H.length},first=${(E=H[0])==null?void 0:E.rpm},last=${(Z=H[H.length-1])==null?void 0:Z.rpm}`:"none"}),P((V==null?void 0:V.message)??String(V))}finally{C(!1)}},x=()=>{if(h.length===0){alert("No step data available to download");return}const d=["step","v_ftps","EngRPM","wheelRPM","ClutchSlip","HPSave","HPEngPMI","HPChasPMI","DragHP","HP_afterL1","HP_afterL2","PQWT","AMin","AMax","AGS_applied","Vel_next","Dist_next"],w=h.map(E=>[E.step,E.v_ftps,E.EngRPM,E.wheelRPM,E.ClutchSlip,E.HPSave,E.HPEngPMI,E.HPChasPMI,E.DragHP,E.HP_afterL1,E.HP_afterL2,E.PQWT,E.AMin,E.AMax,E.AGS_applied,E.Vel_next,E.Dist_next]),B=[d.join(","),...w.map(E=>E.join(","))].join(`
`),F=new Blob([B],{type:"text/csv"}),z=URL.createObjectURL(F),D=document.createElement("a");D.href=z,D.download=`run-inspector-VB6Exact-${a}-${Date.now()}.csv`,D.click(),URL.revokeObjectURL(z)};return e.jsxs("div",{style:{padding:"2rem",height:"100%",overflow:"auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Run Inspector & Steps"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Run simulations with VB6 fixtures and inspect detailed step-by-step physics data."})]}),!g.ok&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("p",{style:{margin:"0 0 0.75rem 0",fontSize:"0.875rem",color:"#991b1b",fontWeight:"600"},children:"Fixture validation failed."}),e.jsx("pre",{style:{margin:"0 0 0.75rem 0",padding:"0.5rem",backgroundColor:"#fef2f2",border:"1px solid #fca5a5",borderRadius:"var(--radius-sm)",fontSize:"0.75rem",color:"#991b1b",fontFamily:"monospace",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:g.missing.join(", ")}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>v.startTransition(()=>r("/dev?panel=input-inspector")),style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Open VB6 Inputs"}),e.jsx("button",{onClick:()=>r("/dev?panel=quick-paste&example=prostock"),style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Load ProStock_Pro Example"})]})]}),!i&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fef3c7",border:"1px solid #fbbf24",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.875rem",color:"#92400e"},children:[e.jsx("strong",{children:"üí° Hint:"})," Enable ",e.jsx("code",{children:"enableStepTrace"})," flag in the Feature Flags panel to capture detailed step data during simulation runs."]})}),T&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem",whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"0.875rem",color:"#991b1b"},children:T}),e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)",marginBottom:"1rem",border:"1px solid var(--color-border)",display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:"500",color:"var(--color-text)",whiteSpace:"nowrap"},children:"User Level:"}),e.jsx("div",{style:{display:"flex",gap:"0.25rem"},children:Ke.map(d=>e.jsx("button",{onClick:()=>p(d),style:{padding:"0.375rem 0.75rem",fontSize:"0.75rem",fontWeight:s===d?"600":"400",backgroundColor:s===d?"var(--color-primary)":"var(--color-bg)",color:s===d?"white":"var(--color-text)",border:`1px solid ${s===d?"var(--color-primary)":"var(--color-border)"}`,borderRadius:"var(--radius-sm)",cursor:"pointer",textTransform:"capitalize"},children:d},d))}),s==="admin"&&e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"üîì Full access"})]}),e.jsx(Lt,{onSelect:S,onEditClick:o}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Controls"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem"},children:"Distance"}),e.jsxs("select",{value:a,onChange:d=>k(d.target.value),style:{width:"100%",padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"},children:[e.jsx("option",{value:"EIGHTH",children:"EIGHTH (660 ft)"}),e.jsx("option",{value:"QUARTER",children:"QUARTER (1320 ft)"})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"flex-end"},children:e.jsx("button",{onClick:b,disabled:_||!g.ok,style:{width:"100%",padding:"0.5rem 1rem",fontSize:"0.875rem",fontWeight:"500",backgroundColor:_||!g.ok?"#9ca3af":"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:_||!g.ok?"not-allowed":"pointer"},children:_?"Running...":"Run with current VB6 UI Fixture"})})]}),e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem",backgroundColor:g.ok?"#f0fdf4":"#fef2f2",border:`1px solid ${g.ok?"#86efac":"#fca5a5"}`,borderRadius:"var(--radius-md)"},children:[e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:"600",marginBottom:"0.5rem",color:g.ok?"#166534":"#991b1b"},children:"Fixture Requirements"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"0.25rem",fontSize:"0.75rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{children:(y=(l=t.drivetrain)==null?void 0:l.gearRatios)!=null&&y.length?"‚úÖ":"‚ùå"}),e.jsx("span",{style:{color:"var(--color-text)"},children:"drivetrain.gearRatios"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{children:(I=(A=t.drivetrain)==null?void 0:A.perGearEff)!=null&&I.length?"‚úÖ":"‚ùå"}),e.jsx("span",{style:{color:"var(--color-text)"},children:"drivetrain.perGearEff"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{children:(N=t.drivetrain)!=null&&N.clutch||(Q=t.drivetrain)!=null&&Q.converter?"‚úÖ":"‚ùå"}),e.jsx("span",{style:{color:"var(--color-text)"},children:"clutch or converter"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{children:(re=t.engineHP)!=null&&re.length?"‚úÖ":"‚ùå"}),e.jsx("span",{style:{color:"var(--color-text)"},children:"engineHP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{children:(te=t.fuel)!=null&&te.type?"‚úÖ":"‚ùå"}),e.jsx("span",{style:{color:"var(--color-text)"},children:"fuel.type"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{title:((oe=t.pmi)==null?void 0:oe.engine_flywheel_clutch)!=null&&((ie=t.pmi)==null?void 0:ie.transmission_driveshaft)!=null&&((ae=t.pmi)==null?void 0:ae.tires_wheels_ringgear)!=null?"All PMI fields present":(()=>{var w,B,F;const d=[];return((w=t.pmi)==null?void 0:w.engine_flywheel_clutch)==null&&d.push("engine_flywheel_clutch"),((B=t.pmi)==null?void 0:B.transmission_driveshaft)==null&&d.push("transmission_driveshaft"),((F=t.pmi)==null?void 0:F.tires_wheels_ringgear)==null&&d.push("tires_wheels_ringgear"),`Missing: ${d.join(", ")}`})(),children:((ne=t.pmi)==null?void 0:ne.engine_flywheel_clutch)!=null&&((Y=t.pmi)==null?void 0:Y.transmission_driveshaft)!=null&&((de=t.pmi)==null?void 0:de.tires_wheels_ringgear)!=null?"‚úÖ":"‚ùå"}),e.jsx("span",{style:{color:"var(--color-text)"},children:"pmi.*"})]})]})]})]}),m&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Results"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginBottom:"0.25rem"},children:"ET (s)"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:m.et_s.toFixed(3)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginBottom:"0.25rem"},children:"MPH"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:m.mph.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginBottom:"0.25rem"},children:"Model"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:"500"},children:m.meta.model})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginBottom:"0.25rem"},children:"Termination"}),e.jsx("div",{style:{fontSize:"0.875rem"},children:((se=m.meta.termination)==null?void 0:se.reason)||"DISTANCE"})]})]})]}),h.length>0&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:"600"},children:"First 12 Steps"}),e.jsx("button",{onClick:x,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Download CSV"})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.75rem",borderCollapse:"collapse",fontFamily:"monospace"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#1e293b",color:"#e2e8f0"},children:[e.jsx("th",{style:{padding:"0.5rem",textAlign:"left",borderBottom:"2px solid var(--color-border)"},children:"Step"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"v_ftps"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"EngRPM"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"wheelRPM"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"ClutchSlip"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"HPSave"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"HPEngPMI"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"HPChasPMI"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"DragHP"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"HP_L1"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"HP_L2"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"PQWT"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"AMin"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"AMax"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"AGS"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"Vel_next"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"Dist_next"})]})}),e.jsx("tbody",{children:h.map((d,w)=>e.jsxs("tr",{style:{backgroundColor:w%2===0?"transparent":"rgba(0,0,0,0.02)"},children:[e.jsx("td",{style:{padding:"0.5rem",borderBottom:"1px solid var(--color-border)"},children:d.step}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.v_ftps.toFixed(3)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.EngRPM.toFixed(0)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.wheelRPM.toFixed(2)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.ClutchSlip.toFixed(4)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.HPSave.toFixed(1)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.HPEngPMI.toFixed(1)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.HPChasPMI.toFixed(1)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.DragHP.toFixed(2)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.HP_afterL1.toFixed(1)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.HP_afterL2.toFixed(1)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.PQWT.toFixed(1)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.AMin.toFixed(3)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.AMax.toFixed(3)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.AGS_applied.toFixed(3)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.Vel_next.toFixed(3)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:d.Dist_next.toFixed(6)})]},d.step))})]})})]}),m&&h.length===0&&e.jsx("div",{style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",color:"var(--color-muted)"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.875rem"},children:["Step data capture not yet implemented. Enable ",e.jsx("code",{children:"enableStepTrace"})," flag and implement step data collection hook in rsaclassic.ts."]})})]})}function Gr(r){return{vehicle:{name:"VB6 Fixture Vehicle",weightLb:r.vehicle.weight_lb},env:{elevation:r.env.elevation_ft,temperatureF:r.env.temperature_F,barometerInHg:r.env.barometer_inHg,humidityPct:r.env.relHumidity_pct,trackTempF:r.env.trackTemp_F,tractionIndex:r.env.tractionIndex,windMph:r.env.wind_mph,windAngleDeg:r.env.wind_angle_deg},raceLength:"QUARTER"}}function Nt(){const{fixture:r}=we(),t=Fr("enableEnergyLogging"),[n,i]=v.useState(!1),[c,s]=v.useState(null),[p,u]=v.useState(null),[a,k]=v.useState(null),_=async()=>{i(!0),s(null),u(null),k(null);try{Qe(r);const P=Gr(r);P.raceLength="QUARTER";const m=await ar("VB6Exact",P);u(m);const R=m.meta.energy;if(R){const h=R.engine_in_ftlbf||0,j=R.balance_ftlbf||0;k({engine_in_ftlbf:R.engine_in_ftlbf||0,drag_loss_ftlbf:R.drag_loss_ftlbf||0,rolling_resistance_ftlbf:R.rolling_resistance_ftlbf||0,driveline_loss_ftlbf:R.driveline_loss_ftlbf||0,engine_pmi_loss_ftlbf:R.engine_pmi_loss_ftlbf||0,chassis_pmi_loss_ftlbf:R.chassis_pmi_loss_ftlbf||0,final_ke_ftlbf:R.final_ke_ftlbf||0,balance_ftlbf:j,balance_pct:h>0?j/h*100:0})}else s("Energy data not available in simulation result. Enable enableEnergyLogging flag.")}catch(P){P instanceof Xe?s(`Fixture validation failed:

${P.message}

Please complete all required fields in VB6 Inputs panel.`):s(P instanceof Error?P.message:String(P))}finally{i(!1)}},C=()=>{if(!a)return;const P=JSON.stringify(a,null,2),m=new Blob([P],{type:"application/json"}),R=URL.createObjectURL(m),h=document.createElement("a");h.href=R,h.download=`energy-breakdown-${Date.now()}.json`,h.click(),URL.revokeObjectURL(R)},T=()=>{if(!a)return;const P=["Category","Energy (ft-lbf)","Percentage"],m=a.engine_in_ftlbf,R=[["Engine Input",a.engine_in_ftlbf,"100.00%"],["Drag Loss",a.drag_loss_ftlbf,`${(a.drag_loss_ftlbf/m*100).toFixed(2)}%`],["Rolling Resistance",a.rolling_resistance_ftlbf,`${(a.rolling_resistance_ftlbf/m*100).toFixed(2)}%`],["Driveline Loss",a.driveline_loss_ftlbf,`${(a.driveline_loss_ftlbf/m*100).toFixed(2)}%`],["Engine PMI Loss",a.engine_pmi_loss_ftlbf,`${(a.engine_pmi_loss_ftlbf/m*100).toFixed(2)}%`],["Chassis PMI Loss",a.chassis_pmi_loss_ftlbf,`${(a.chassis_pmi_loss_ftlbf/m*100).toFixed(2)}%`],["Final Kinetic Energy",a.final_ke_ftlbf,`${(a.final_ke_ftlbf/m*100).toFixed(2)}%`],["Balance",a.balance_ftlbf,`${a.balance_pct.toFixed(2)}%`]],h=[P.join(","),...R.map(o=>o.join(","))].join(`
`),j=new Blob([h],{type:"text/csv"}),g=URL.createObjectURL(j),S=document.createElement("a");S.href=g,S.download=`energy-breakdown-${Date.now()}.csv`,S.click(),URL.revokeObjectURL(g)};return e.jsxs("div",{style:{padding:"2rem",height:"100%",overflow:"auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Energy Accounting"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Visualize energy flow and balance during simulation runs."})]}),!t&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fef3c7",border:"1px solid #fbbf24",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.875rem",color:"#92400e"},children:[e.jsx("strong",{children:"üí° Instructions:"})," Enable ",e.jsx("code",{children:"enableEnergyLogging"})," flag in the Feature Flags panel to capture energy accounting data during simulation runs."]})}),c&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem",whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"0.875rem",color:"#991b1b"},children:c}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx("button",{onClick:_,disabled:n,style:{padding:"0.75rem 1.5rem",fontSize:"0.875rem",fontWeight:"500",backgroundColor:n?"#9ca3af":"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:n?"not-allowed":"pointer"},children:n?"Running...":"Run VB6Exact (QUARTER)"})}),p&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"Run Results"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"ET (s)"}),e.jsx("div",{style:{fontSize:"1.25rem",fontWeight:"bold"},children:p.et_s.toFixed(3)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"MPH"}),e.jsx("div",{style:{fontSize:"1.25rem",fontWeight:"bold"},children:p.mph.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"Model"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:"500"},children:p.meta.model})]})]})]}),a&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:"600"},children:"Energy Breakdown"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:C,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Export JSON"}),e.jsx("button",{onClick:T,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Export CSV"})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx(be,{label:"Engine Input",value:a.engine_in_ftlbf,percentage:100,color:"#10b981",isInput:!0}),e.jsx(be,{label:"Drag Loss",value:a.drag_loss_ftlbf,percentage:a.drag_loss_ftlbf/a.engine_in_ftlbf*100,color:"#ef4444"}),e.jsx(be,{label:"Rolling Resistance",value:a.rolling_resistance_ftlbf,percentage:a.rolling_resistance_ftlbf/a.engine_in_ftlbf*100,color:"#f59e0b"}),e.jsx(be,{label:"Driveline Loss",value:a.driveline_loss_ftlbf,percentage:a.driveline_loss_ftlbf/a.engine_in_ftlbf*100,color:"#f59e0b"}),e.jsx(be,{label:"Engine PMI Loss",value:a.engine_pmi_loss_ftlbf,percentage:a.engine_pmi_loss_ftlbf/a.engine_in_ftlbf*100,color:"#f59e0b"}),e.jsx(be,{label:"Chassis PMI Loss",value:a.chassis_pmi_loss_ftlbf,percentage:a.chassis_pmi_loss_ftlbf/a.engine_in_ftlbf*100,color:"#f59e0b"}),e.jsx(be,{label:"Final Kinetic Energy",value:a.final_ke_ftlbf,percentage:a.final_ke_ftlbf/a.engine_in_ftlbf*100,color:"#3b82f6"}),e.jsx(be,{label:"Balance (Error)",value:a.balance_ftlbf,percentage:a.balance_pct,color:Math.abs(a.balance_pct)<1?"#10b981":"#ef4444",showSign:!0})]}),e.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#1e293b",borderRadius:"var(--radius-md)",color:"#e2e8f0",fontFamily:"monospace",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Total Energy In:"})," ",a.engine_in_ftlbf.toLocaleString()," ft-lbf"]}),e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Total Losses:"})," ",(a.drag_loss_ftlbf+a.rolling_resistance_ftlbf+a.driveline_loss_ftlbf+a.engine_pmi_loss_ftlbf+a.chassis_pmi_loss_ftlbf).toLocaleString()," ","ft-lbf"]}),e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Final KE:"})," ",a.final_ke_ftlbf.toLocaleString()," ft-lbf"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Balance:"})," ",a.balance_ftlbf.toLocaleString()," ft-lbf (",a.balance_pct.toFixed(2),"%)"]})]})]})]})}function be({label:r,value:t,percentage:n,color:i,isInput:c,showSign:s}){const p=s&&t>=0?`+${t.toLocaleString()}`:t.toLocaleString(),u=Math.min(Math.abs(n),100);return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.25rem",fontSize:"0.875rem"},children:[e.jsx("span",{style:{fontWeight:c?"600":"400"},children:r}),e.jsxs("span",{style:{fontFamily:"monospace"},children:[p," ft-lbf (",n.toFixed(2),"%)"]})]}),e.jsx("div",{style:{width:"100%",height:"24px",backgroundColor:"#e5e7eb",borderRadius:"var(--radius-sm)",overflow:"hidden"},children:e.jsx("div",{style:{width:`${u}%`,height:"100%",backgroundColor:i,transition:"width 0.3s ease"}})})]})}const Je=[{name:"SuperGas_Pro",source:"QuarterPro",raceLengthTargets:{EIGHTH:{et_s:6.27,mph:108.2,tolET_s:.2,tolMPH:3,anchors:{t60_s:1.35}},QUARTER:{et_s:9.9,mph:135.1,tolET_s:.3,tolMPH:4}}},{name:"TA_Dragster_Pro",source:"QuarterPro",raceLengthTargets:{EIGHTH:{et_s:3.56,mph:205.3,tolET_s:.12,tolMPH:5},QUARTER:{et_s:5.52,mph:243.1,tolET_s:.12,tolMPH:6}}},{name:"ProStock_Pro",source:"QuarterPro",raceLengthTargets:{EIGHTH:{et_s:4.37,mph:160.9,tolET_s:.12,tolMPH:4,anchors:{t60_s:1.01}},QUARTER:{et_s:6.8,mph:202.3,tolET_s:.15,tolMPH:5}}},{name:"FunnyCar_Pro",source:"QuarterPro",raceLengthTargets:{EIGHTH:{et_s:3.37,mph:243.5,tolET_s:.1,tolMPH:6},QUARTER:{et_s:4.98,mph:297,tolET_s:.1,tolMPH:7}}},{name:"Motorcycle_Pro",source:"QuarterPro",raceLengthTargets:{EIGHTH:{et_s:7.63,mph:91.1,tolET_s:.25,tolMPH:3},QUARTER:{et_s:11.99,mph:111.3,tolET_s:.3,tolMPH:3}}},{name:"SuperComp_Pro",source:"QuarterPro",raceLengthTargets:{EIGHTH:{et_s:5.66,mph:120.4,tolET_s:.18,tolMPH:4},QUARTER:{et_s:8.9,mph:151.6,tolET_s:.2,tolMPH:4}}},{name:"Motorcycle_Jr",source:"QuarterJr",raceLengthTargets:{EIGHTH:{et_s:7.45,mph:89.4,tolET_s:.25,tolMPH:3},QUARTER:{et_s:12,mph:104.5,tolET_s:.3,tolMPH:3}}},{name:"ETRacer_Jr",source:"QuarterJr",raceLengthTargets:{EIGHTH:{et_s:8.6,mph:80.3,tolET_s:.3,tolMPH:3},QUARTER:{et_s:13.5,mph:100.8,tolET_s:.35,tolMPH:3.5}}},{name:"EXP_Jr",source:"QuarterJr",raceLengthTargets:{EIGHTH:{et_s:5.15,mph:130.3,tolET_s:.15,tolMPH:4},QUARTER:{et_s:8.18,mph:160.2,tolET_s:.2,tolMPH:4}}},{name:"EXP_050523_Jr",source:"QuarterJr",raceLengthTargets:{EIGHTH:{et_s:5.06,mph:132.5,tolET_s:.15,tolMPH:4},QUARTER:{et_s:8.04,mph:163.5,tolET_s:.2,tolMPH:4}}}];function Wt(r,t,n,i){const c=r.raceLengthTargets[t];if(!c)throw new Error(`Benchmark ${r.name} has no target for ${t}`);const s=n-c.et_s,p=i-c.mph,u=Math.abs(s)<=c.tolET_s,a=Math.abs(p)<=c.tolMPH;return{pass:u&&a,etPass:u,mphPass:a,etDelta:s,mphDelta:p,etTolerance:c.tolET_s,mphTolerance:c.tolMPH}}function Gt(r){const t=[];if(r.env.elevation===void 0&&t.push("env.elevation"),r.env.barometerInHg===void 0&&t.push("env.barometerInHg"),r.env.temperatureF===void 0&&t.push("env.temperatureF"),r.env.humidityPct===void 0&&t.push("env.humidityPct"),r.vehicle.weightLb||t.push("vehicle.weightLb"),!r.vehicle.tireDiaIn&&!r.vehicle.tireRolloutIn&&t.push("vehicle.tireDiaIn OR vehicle.tireRolloutIn"),r.vehicle.rolloutIn===void 0&&t.push("vehicle.rolloutIn"),!r.vehicle.rearGear&&!r.vehicle.finalDrive&&t.push("vehicle.rearGear OR vehicle.finalDrive"),(!r.vehicle.gearRatios||r.vehicle.gearRatios.length===0)&&t.push("vehicle.gearRatios[]"),(!r.vehicle.shiftRPM||r.vehicle.shiftRPM.length===0)&&t.push("vehicle.shiftRPM[]"),r.vehicle.frontalArea_ft2===void 0&&t.push("vehicle.frontalArea_ft2"),r.vehicle.cd===void 0&&t.push("vehicle.cd"),!r.vehicle.torqueCurve||r.vehicle.torqueCurve.length===0?t.push("vehicle.torqueCurve[]"):r.vehicle.torqueCurve.every(i=>i.rpm!==void 0&&(i.hp!==void 0||i.tq_lbft!==void 0))||t.push("vehicle.torqueCurve[] must have rpm and (hp OR tq_lbft) for each point"),r.vehicle.converter&&(r.vehicle.converter.stallRPM===void 0&&t.push("vehicle.converter.stallRPM (required if converter present)"),r.vehicle.converter.torqueMult===void 0&&t.push("vehicle.converter.torqueMult (required if converter present)"),r.vehicle.converter.slipRatio===void 0&&t.push("vehicle.converter.slipRatio (required if converter present)")),r.vehicle.clutch&&(r.vehicle.clutch.slipRPM===void 0&&r.vehicle.clutch.launchRPM===void 0&&t.push("vehicle.clutch.slipRPM OR vehicle.clutch.launchRPM (required if clutch present)"),r.vehicle.clutch.slipRatio===void 0&&t.push("vehicle.clutch.slipRatio (required if clutch present)")),r.vehicle.gearRatios&&r.vehicle.shiftRPM){const n=r.vehicle.gearRatios.length,i=r.vehicle.shiftRPM.length;i!==n-1&&i!==n&&t.push(`vehicle.shiftRPM[] length mismatch (${i} shifts for ${n} gears)`)}if(r.vehicle.gearEff&&r.vehicle.gearRatios&&r.vehicle.gearEff.length!==r.vehicle.gearRatios.length&&t.push(`vehicle.gearEff[] length mismatch (${r.vehicle.gearEff.length} vs ${r.vehicle.gearRatios.length} gears)`),t.length>0)throw new Error(`Benchmark config '${r.name}' is missing required VB6 parameters:
`+t.map(n=>`  - ${n}`).join(`
`)+`

All required fields must be present from VB6 printouts - NO DEFAULTS ALLOWED.
This ensures VB6 parity by preventing silent defaults in the simulation.`)}const dr={ProStock_Pro:{name:"ProStock_Pro",fuel:"GAS",env:{elevation:32,barometerInHg:29.92,temperatureF:75,humidityPct:55,windMph:5,windAngleDeg:135,trackTempF:105,tractionIndex:3},vehicle:{weightLb:2355,wheelbaseIn:107,overhangIn:40,rolloutIn:9,tireRolloutIn:102.5,tireWidthIn:17,frontalArea_ft2:18.2,cd:.24,liftCoeff:.1,finalDrive:4.86,transEff:.975,gearRatios:[2.6,1.9,1.5,1.2,1],gearEff:[.99,.991,.992,.993,.994],shiftRPM:[9400,9400,9400,9400],clutch:{launchRPM:7200,slipRPM:7600,slipRatio:1.004,lockup:!1},torqueCurve:[{rpm:7e3,hp:1220},{rpm:7200,hp:1235},{rpm:7400,hp:1248},{rpm:7600,hp:1258},{rpm:7800,hp:1266},{rpm:8e3,hp:1272},{rpm:8200,hp:1276},{rpm:8400,hp:1278},{rpm:8600,hp:1279},{rpm:8800,hp:1278},{rpm:9e3,hp:1276},{rpm:9200,hp:1272},{rpm:9400,hp:1266},{rpm:9500,hp:1263}]}},FunnyCar_Pro:{name:"FunnyCar_Pro",fuel:"NITRO",env:{elevation:300,barometerInHg:29.92,temperatureF:76,humidityPct:50,windMph:0,trackTempF:112,tractionIndex:1},vehicle:{weightLb:2350,wheelbaseIn:125,overhangIn:40,rolloutIn:12,tireRolloutIn:118,tireWidthIn:18,frontalArea_ft2:24.1,cd:.5,liftCoeff:.8,finalDrive:3.2,transEff:.96,gearRatios:[1],gearEff:[1],shiftRPM:[100],clutch:{launchRPM:6400,slipRPM:6800,slippageFactor:1.0068,lockup:!1},pmi:{engine_flywheel_clutch:6.03,transmission_driveshaft:.107,tires_wheels_ringgear:75.4},torqueCurve:[{rpm:6400,hp:6116},{rpm:6600,hp:6276},{rpm:6800,hp:6306},{rpm:7e3,hp:6139},{rpm:7200,hp:5829},{rpm:7400,hp:5344},{rpm:7600,hp:4732},{rpm:7800,hp:3993},{rpm:9e3,hp:1297},{rpm:9250,hp:1269},{rpm:9500,hp:1222}]}},TA_Dragster_Pro:{name:"TA_Dragster_Pro",fuel:"METHANOL",env:{elevation:0,barometerInHg:29.92,temperatureF:77,humidityPct:45,windMph:0,trackTempF:110,tractionIndex:2},vehicle:{weightLb:1980,wheelbaseIn:280,overhangIn:30,rolloutIn:12,tireRolloutIn:110,tireWidthIn:17,frontalArea_ft2:19.5,cd:.58,liftCoeff:.4,finalDrive:4.56,transEff:.97,gearRatios:[1.85,1.3,1],gearEff:[.97,.98,.99],shiftRPM:[9200,9400],clutch:{launchRPM:6e3,slipRPM:7200,slipRatio:1.01,lockup:!1},torqueCurve:[{rpm:6e3,hp:1800},{rpm:6500,hp:2e3},{rpm:7e3,hp:2180},{rpm:7500,hp:2340},{rpm:8e3,hp:2480},{rpm:8500,hp:2600},{rpm:9e3,hp:2700},{rpm:9500,hp:2780},{rpm:1e4,hp:2840},{rpm:10500,hp:2880},{rpm:11e3,hp:2900},{rpm:11500,hp:2900}]}},SuperComp_Pro:{name:"SuperComp_Pro",fuel:"GAS",env:{elevation:600,barometerInHg:29.92,temperatureF:87,humidityPct:35,windMph:0,trackTempF:112,tractionIndex:5},vehicle:{weightLb:1700,wheelbaseIn:225,overhangIn:30,rolloutIn:12,tireDiaIn:32.6,tireWidthIn:13.2,frontalArea_ft2:13.6,cd:.5,liftCoeff:.15,finalDrive:4.56,transEff:.97,gearRatios:[1.76,1],gearEff:[.97,.99],shiftRPM:[7500],converter:{launchRPM:5e3,stallRPM:5500,slipRatio:1.06,torqueMult:1.7,lockup:!1,diameterIn:10},torqueCurve:[{rpm:3500,hp:520},{rpm:4e3,hp:560},{rpm:4500,hp:600},{rpm:5e3,hp:640},{rpm:5500,hp:680},{rpm:6e3,hp:715},{rpm:6500,hp:745},{rpm:7e3,hp:770},{rpm:7500,hp:790},{rpm:8e3,hp:805},{rpm:8500,hp:815},{rpm:9e3,hp:820},{rpm:9500,hp:820},{rpm:1e4,hp:815}]}},SuperGas_Pro:{name:"SuperGas_Pro",fuel:"GAS",env:{elevation:850,barometerInHg:29.92,temperatureF:77,humidityPct:30,windMph:0,trackTempF:102,tractionIndex:5},vehicle:{weightLb:2300,wheelbaseIn:103,overhangIn:30,rolloutIn:12,tireDiaIn:32.4,tireWidthIn:14.4,frontalArea_ft2:22.1,cd:.4,liftCoeff:.25,finalDrive:5.14,transEff:.97,gearRatios:[1.76,1],gearEff:[.97,.99],shiftRPM:[7600],converter:{launchRPM:5e3,stallRPM:5500,slipRatio:1.06,torqueMult:1.7,lockup:!1,diameterIn:10},torqueCurve:[{rpm:3500,hp:450},{rpm:4e3,hp:490},{rpm:4500,hp:530},{rpm:5e3,hp:565},{rpm:5500,hp:600},{rpm:6e3,hp:630},{rpm:6500,hp:655},{rpm:7e3,hp:675},{rpm:7500,hp:690},{rpm:8e3,hp:700},{rpm:8500,hp:705},{rpm:9e3,hp:705},{rpm:9500,hp:700}]}},Motorcycle_Pro:{name:"Motorcycle_Pro",fuel:"GAS",env:{elevation:500,barometerInHg:29.92,temperatureF:75,humidityPct:50,windMph:0,trackTempF:100,tractionIndex:4},vehicle:{weightLb:650,wheelbaseIn:54,rolloutIn:12,tireDiaIn:28,tireWidthIn:5,frontalArea_ft2:7.5,cd:.55,liftCoeff:.05,finalDrive:6.5,transEff:.99,gearRatios:[2.74,1.96,1.4,1],shiftRPM:[8e3,8e3,8e3],clutch:{launchRPM:6e3,slipRPM:6e3,slipRatio:1,lockup:!0},torqueCurve:[{rpm:5e3,hp:60},{rpm:5500,hp:64},{rpm:6e3,hp:68},{rpm:6500,hp:71},{rpm:7e3,hp:73},{rpm:7200,hp:74},{rpm:7500,hp:74},{rpm:8e3,hp:73},{rpm:8500,hp:71}]}},Motorcycle_Jr:{name:"Motorcycle_Jr",fuel:"GAS",env:{elevation:900,barometerInHg:29.92,temperatureF:74,humidityPct:40,tractionIndex:4},vehicle:{weightLb:730,wheelbaseIn:54,rolloutIn:12,tireDiaIn:28,tireWidthIn:5,frontalArea_ft2:7.9,cd:.55,liftCoeff:.05,finalDrive:6.81,transEff:.99,gearRatios:[2.74,1.96,1.4,1],shiftRPM:[8e3,8e3,8e3],clutch:{launchRPM:6e3,slipRPM:6e3,slipRatio:1,lockup:!0},torqueCurve:[{rpm:5e3,hp:62},{rpm:5500,hp:68},{rpm:6e3,hp:73},{rpm:6500,hp:77},{rpm:7e3,hp:80},{rpm:7200,hp:81},{rpm:7500,hp:81},{rpm:8e3,hp:80},{rpm:8500,hp:78}]}},ETRacer_Jr:{name:"ETRacer_Jr",fuel:"GAS",env:{elevation:680,barometerInHg:29.92,temperatureF:86,humidityPct:60,tractionIndex:5},vehicle:{weightLb:3600,wheelbaseIn:108,rolloutIn:14,tireDiaIn:28,tireWidthIn:10,frontalArea_ft2:26.1,cd:.45,liftCoeff:.2,finalDrive:4.11,transEff:.97,gearRatios:[2.48,1.48,1],shiftRPM:[6e3,6e3],converter:{launchRPM:2500,stallRPM:3e3,lockup:!1,diameterIn:10,slipRatio:1.05,torqueMult:1.6},powerHP:325,torqueCurve:[{rpm:3e3,hp:220},{rpm:3500,hp:250},{rpm:4e3,hp:275},{rpm:4500,hp:295},{rpm:5e3,hp:310},{rpm:5500,hp:322},{rpm:5600,hp:325},{rpm:6e3,hp:325},{rpm:6500,hp:320}]}},EXP_Jr:{name:"EXP_Jr",fuel:"GAS",env:{elevation:400,barometerInHg:29.92,temperatureF:80,humidityPct:45,tractionIndex:4},vehicle:{weightLb:2100,wheelbaseIn:180,rolloutIn:12,tireDiaIn:30,tireWidthIn:12,frontalArea_ft2:15.5,cd:.48,liftCoeff:.18,finalDrive:4.3,transEff:.97,gearRatios:[1.8,1.3,1],shiftRPM:[7800,8e3],clutch:{launchRPM:5500,slipRPM:6e3,slipRatio:1.005,lockup:!1},torqueCurve:[{rpm:5e3,hp:750},{rpm:5500,hp:810},{rpm:6e3,hp:860},{rpm:6500,hp:900},{rpm:7e3,hp:930},{rpm:7500,hp:950},{rpm:8e3,hp:960},{rpm:8500,hp:960},{rpm:9e3,hp:950}]}},EXP_050523_Jr:{name:"EXP_050523_Jr",fuel:"GAS",env:{elevation:420,barometerInHg:29.92,temperatureF:78,humidityPct:48,tractionIndex:4},vehicle:{weightLb:2080,wheelbaseIn:180,rolloutIn:12,tireDiaIn:30.5,tireWidthIn:12.5,frontalArea_ft2:15.2,cd:.46,liftCoeff:.16,finalDrive:4.25,transEff:.975,gearRatios:[1.82,1.32,1],shiftRPM:[7900,8100],clutch:{launchRPM:5600,slipRPM:6100,slipRatio:1.004,lockup:!1},torqueCurve:[{rpm:5e3,hp:770},{rpm:5500,hp:830},{rpm:6e3,hp:880},{rpm:6500,hp:920},{rpm:7e3,hp:955},{rpm:7500,hp:980},{rpm:8e3,hp:995},{rpm:8500,hp:1e3},{rpm:9e3,hp:995}]}}};(()=>{const r=dr.ProStock_Pro;if(!r)return;const t=Br,n=r.vehicle;n.weightLb=t.vehicle.weight_lb,n.wheelbaseIn=t.vehicle.wheelbase_in,n.overhangIn=t.vehicle.overhang_in??n.overhangIn,n.rolloutIn=t.vehicle.rollout_in??n.rolloutIn,n.tireDiaIn=t.vehicle.tire.diameter_in,n.tireRolloutIn=t.vehicle.tire.diameter_in*Math.PI,n.tireWidthIn=t.vehicle.tire.width_in,n.frontalArea_ft2=t.aero.frontalArea_ft2,n.cd=t.aero.Cd,n.liftCoeff=t.aero.Cl??n.liftCoeff,n.finalDrive=t.drivetrain.finalDrive,n.transEff=t.drivetrain.overallEfficiency,n.gearRatios=[...t.drivetrain.gearRatios],n.gearEff=[...t.drivetrain.perGearEff],n.shiftRPM=[...t.drivetrain.shiftsRPM],n.clutch={launchRPM:t.drivetrain.clutch.launchRPM,slipRPM:t.drivetrain.clutch.slipRPM,slipRatio:t.drivetrain.clutch.slippageFactor,lockup:t.drivetrain.clutch.lockup},n.pmi={engine_flywheel_clutch:t.pmi.engine_flywheel_clutch,transmission_driveshaft:t.pmi.transmission_driveshaft,tires_wheels_ringgear:t.pmi.tires_wheels_ringgear},n.engine={hpCurve:t.engineHP.map(([i,c])=>({rpm:i,hp:c})),fuelType:t.fuel.type,hpTorqueMultiplier:t.fuel.hpTorqueMultiplier},r.env.elevation=t.env.elevation_ft,r.env.barometerInHg=t.env.barometer_inHg,r.env.temperatureF=t.env.temperature_F,r.env.humidityPct=t.env.relHumidity_pct,r.env.windMph=t.env.wind_mph,r.env.windAngleDeg=t.env.wind_angle_deg,r.env.trackTempF=t.env.trackTemp_F,r.env.tractionIndex=t.env.tractionIndex})();const Er={ProStock_Pro:Br};function Vt(r){var i;const t=dr[r];if(!t)throw new Error(`Benchmark config not found: ${r}`);return{env:{elevation_ft:t.env.elevation,barometer_inHg:t.env.barometerInHg,temperature_F:t.env.temperatureF,relHumidity_pct:t.env.humidityPct,wind_mph:t.env.windMph??0,wind_angle_deg:t.env.windAngleDeg??0,trackTemp_F:t.env.trackTempF??t.env.temperatureF,tractionIndex:t.env.tractionIndex??1},vehicle:{weight_lb:t.vehicle.weightLb,wheelbase_in:t.vehicle.wheelbaseIn??100,overhang_in:t.vehicle.overhangIn??40,rollout_in:t.vehicle.rolloutIn,staticFrontWeight_lb:t.vehicle.weightLb*.38,cgHeight_in:(t.vehicle.tireDiaIn??32)/2+3.75,bodyStyle:1,tire:{diameter_in:t.vehicle.tireDiaIn??(t.vehicle.tireRolloutIn??100)/Math.PI,width_in:t.vehicle.tireWidthIn??10}},aero:{frontalArea_ft2:t.vehicle.frontalArea_ft2,Cd:t.vehicle.cd,Cl:t.vehicle.liftCoeff??0},drivetrain:{finalDrive:t.vehicle.finalDrive??t.vehicle.rearGear??3,overallEfficiency:t.vehicle.transEff??.95,gearRatios:t.vehicle.gearRatios??[1],perGearEff:t.vehicle.gearEff??[.95],shiftsRPM:t.vehicle.shiftRPM??[7e3],clutch:t.vehicle.clutch?{launchRPM:t.vehicle.clutch.launchRPM??3e3,slipRPM:t.vehicle.clutch.slipRPM??3500,slippageFactor:t.vehicle.clutch.slipRatio??.1,lockup:t.vehicle.clutch.lockup??!1}:void 0,converter:t.vehicle.converter?{stallRPM:t.vehicle.converter.stallRPM??2500,torqueMult:t.vehicle.converter.torqueMult??2,slippageFactor:t.vehicle.converter.slipRatio??.1,lockup:t.vehicle.converter.lockup??!1}:void 0},pmi:{engine_flywheel_clutch:.5,transmission_driveshaft:.2,tires_wheels_ringgear:.3},engineHP:((i=t.vehicle.torqueCurve)==null?void 0:i.map(c=>[c.rpm,c.hp??0]))??[],fuel:{type:t.fuel??"GAS",hpTorqueMultiplier:1}}}function Ot(){const{fixture:r,setFixture:t}=we(),[n,i]=v.useState(JSON.stringify(r,null,2)),[c,s]=v.useState(null),[p,u]=v.useState(null),[a,k]=v.useState("ProStock_Pro"),[_,C]=v.useState("ProStock_Pro"),[T,P]=v.useState(null),m=()=>{try{const o=JSON.parse(n);Qe(o),s(null),alert("‚úì Fixture is valid and complete!")}catch(o){o instanceof Xe?s(o.message):o instanceof SyntaxError?s(`JSON Syntax Error: ${o.message}`):s(o instanceof Error?o.message:String(o))}},R=()=>{try{const o=JSON.parse(n);t(o),s(null),alert("‚úì Applied to UI fixture store!")}catch(o){o instanceof SyntaxError?s(`JSON Syntax Error: ${o.message}`):s(o instanceof Error?o.message:String(o))}},h=()=>{try{const o=JSON.parse(n);Qe(o);const b=Gr(o);u(b),s(null)}catch(o){o instanceof Xe?(s(o.message),u(null)):o instanceof SyntaxError?s(`JSON Syntax Error: ${o.message}`):s(o instanceof Error?o.message:String(o))}},j=()=>{p&&(navigator.clipboard.writeText(JSON.stringify(p,null,2)),alert("‚úì Copied simulation input to clipboard!"))},g=()=>{try{const o=JSON.parse(n),b=Er[a],x=Vr(o,b,"");P(x.length>0?x.join(`
`):"No differences found")}catch(o){P(`Error: ${o instanceof Error?o.message:String(o)}`)}},S=()=>{try{const o=Vt(_),b=JSON.stringify(o,null,2);i(b),t(o),s(null),alert(`‚úì Populated from benchmark: ${_}`)}catch(o){s(o instanceof Error?o.message:String(o))}};return e.jsxs("div",{style:{padding:"2rem",height:"100%",overflow:"auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Input Inspector (VB6)"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Visualize, validate, and compare VB6 fixtures and simulation inputs."})]}),c&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem",whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"0.875rem",color:"#991b1b"},children:c}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"Load from Benchmark"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("select",{value:_,onChange:o=>C(o.target.value),style:{flex:1,padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"},children:Je.map(o=>e.jsxs("option",{value:o.name,children:[o.name," (",o.source,")"]},o.name))}),e.jsx("button",{onClick:S,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer",whiteSpace:"nowrap"},children:"Populate from Benchmark"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"(A) VB6 UI Fixture (Editable)"}),e.jsx("textarea",{value:n,onChange:o=>i(o.target.value),style:{width:"100%",height:"400px",padding:"0.75rem",fontFamily:"monospace",fontSize:"0.75rem",backgroundColor:"#1e293b",color:"#e2e8f0",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",resize:"vertical"}}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("button",{onClick:m,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Validate"}),e.jsx("button",{onClick:R,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Apply to UI"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"(B) Simulation Input (Readonly)"}),e.jsx("pre",{style:{width:"100%",height:"400px",padding:"0.75rem",fontFamily:"monospace",fontSize:"0.75rem",backgroundColor:"#1e293b",color:"#e2e8f0",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",overflow:"auto",margin:0},children:p?JSON.stringify(p,null,2):'// Click "Build Input From UI" to generate'}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("button",{onClick:h,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Build Input From UI"}),e.jsx("button",{onClick:j,disabled:!p,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:p?"#6b7280":"#d1d5db",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:p?"pointer":"not-allowed"},children:"Copy Input JSON"})]})]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"Diff vs Code Fixture"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",alignItems:"center"},children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:"500"},children:"Compare against:"}),e.jsx("select",{value:a,onChange:o=>k(o.target.value),style:{padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"},children:Object.keys(Er).map(o=>e.jsx("option",{value:o,children:o},o))}),e.jsx("button",{onClick:g,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#f59e0b",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Diff vs Fixture"})]}),T&&e.jsx("pre",{style:{padding:"0.75rem",backgroundColor:"#1e293b",color:"#e2e8f0",borderRadius:"var(--radius-sm)",fontSize:"0.75rem",overflow:"auto",margin:0,maxHeight:"300px",whiteSpace:"pre-wrap"},children:T})]})]})}function Vr(r,t,n){const i=[];for(const c in t){const s=n?`${n}.${c}`:c;c in r?typeof t[c]=="object"&&t[c]!==null&&!Array.isArray(t[c])?i.push(...Vr(r[c],t[c],s)):JSON.stringify(r[c])!==JSON.stringify(t[c])&&(i.push(`~ CHANGED: ${s}`),i.push(`  Reference: ${JSON.stringify(t[c])}`),i.push(`  Current:   ${JSON.stringify(r[c])}`)):i.push(`- MISSING: ${s}`)}for(const c in r)if(!(c in t)){const s=n?`${n}.${c}`:c;i.push(`+ ADDED: ${s} = ${JSON.stringify(r[c])}`)}return i}const wr="rsa.quickpaste.profiles.v1";function Ut(){const r=Ir(),[t]=Hr(),{fixture:n,setFixture:i}=we(),[c,s]=v.useState(""),[p,u]=v.useState([]),[a,k]=v.useState(null),[_,C]=v.useState(""),[T,P]=v.useState(""),[m,R]=v.useState(""),[h,j]=v.useState(null),[g,S]=v.useState([]),[o,b]=v.useState(""),[x,l]=v.useState(""),[y,A]=v.useState(null),[I,N]=v.useState(!1);v.useEffect(()=>{try{const d=localStorage.getItem(wr);d&&S(JSON.parse(d))}catch(d){console.error("Failed to load profiles:",d)}},[]);const Q=d=>{try{localStorage.setItem(wr,JSON.stringify(d)),S(d)}catch(w){console.error("Failed to save profiles:",w)}},re=d=>{const w=d.trim().split(`
`),B=[];for(const F of w){const z=F.trim();if(!z)continue;const D=z.split(/[\s,]+/);if(D.length<2)throw new Error(`Invalid line: "${F}" - expected "RPM HP" or "RPM,HP"`);const E=parseFloat(D[0]),Z=parseFloat(D[1]);if(isNaN(E)||isNaN(Z))throw new Error(`Invalid numbers in line: "${F}"`);B.push({rpm:E,hp:Z})}if(B.length===0)throw new Error("No valid dyno data found");return B.sort((F,z)=>F.rpm-z.rpm),B},te=()=>{try{const d=re(c);u(d),k(null)}catch(d){k(d instanceof Error?d.message:String(d)),u([])}},oe=()=>{try{const d=re(c);i({...n,engineHP:d.map(w=>[w.rpm,w.hp])}),k(null),alert(`‚úì Applied ${d.length} dyno points to VB6 UI Fixture!`)}catch(d){k(d instanceof Error?d.message:String(d))}},ie=()=>{try{j(null);const d={},w={};if(_.trim()){const F=parseFloat(_);if(isNaN(F))throw new Error("Invalid PMI Engine value");d.engine_flywheel_clutch=F}if(T.trim()){const F=parseFloat(T);if(isNaN(F))throw new Error("Invalid PMI Chassis value");d.tires_wheels_ringgear=F}if(m.trim()){const F=m.split(",").map(D=>D.trim()),z=[];for(const D of F){const E=parseFloat(D);if(isNaN(E))throw new Error(`Invalid gear efficiency value: "${D}"`);z.push(E)}w.perGearEff=z}if(Object.keys(d).length===0&&Object.keys(w).length===0){j("No values to apply");return}const B={...n};Object.keys(d).length>0&&(B.pmi={...n.pmi,...d}),Object.keys(w).length>0&&(B.drivetrain={...n.drivetrain,...w}),i(B),alert("‚úì Applied PMI values to VB6 UI Fixture!")}catch(d){j(d instanceof Error?d.message:String(d))}},ae=()=>{if(!x.trim()){alert("Please enter a profile name");return}const d={name:x.trim(),timestamp:Date.now(),fixture:JSON.parse(JSON.stringify(n))},w=[...g,d];Q(w),l(""),alert(`‚úì Saved profile "${d.name}"`)},ne=()=>{if(!o){alert("Please select a profile");return}const d=g.find(w=>w.name===o);if(!d){alert("Profile not found");return}i(d.fixture),alert(`‚úì Loaded profile "${d.name}"`)},Y=()=>{if(!o){alert("Please select a profile");return}if(!confirm(`Delete profile "${o}"?`))return;const d=g.filter(w=>w.name!==o);Q(d),b("")},de=()=>{try{Qe(n),A(null),alert("‚úì Fixture is complete and valid!")}catch(d){d instanceof Xe?A(d.message):A(d instanceof Error?d.message:String(d))}},se=async()=>{N(!0),A(null);try{const d=await fetch("/src/dev/fixtures/ProStock_Pro.vb6.json");if(!d.ok)throw new Error(`Failed to load fixture: ${d.statusText}`);const w=await d.json();w.pmi||(w.pmi={engine_flywheel_clutch:3.42,transmission_driveshaft:.247,tires_wheels_ringgear:50.8}),i(w);const B=Ye(w);if(B.ok)alert(`‚úì ProStock_Pro fixture loaded and validated successfully!

Fixture valid: all PMI fields detected.`);else{const F=B.missing.join(", ");alert(`‚ö† Fixture loaded but incomplete.

Missing fields: ${F}`),A(`Missing fields: ${F}`)}v.startTransition(()=>{r("/dev?panel=input-inspector")})}catch(d){const w=d instanceof Error?d.message:String(d);A(`Failed to load ProStock_Pro fixture: ${w}`),alert(`‚ùå Error loading fixture: ${w}`)}finally{N(!1)}};return v.useEffect(()=>{t.get("example")==="prostock"&&setTimeout(()=>{se()},0)},[t]),e.jsxs("div",{style:{padding:"2rem",height:"100%",overflow:"auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Quick Paste (Dyno & PMI)"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Quickly paste dyno tables and PMI values into VB6 fixtures."})]}),y&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem",whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"0.875rem",color:"#991b1b"},children:y}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"1. Paste Dyno Table"}),e.jsx("p",{style:{fontSize:"0.875rem",color:"var(--color-muted)",marginBottom:"0.75rem"},children:'Paste dyno data as "RPM HP" or "RPM,HP" (one pair per line)'}),e.jsx("textarea",{value:c,onChange:d=>s(d.target.value),placeholder:`7000 1275
7100 1280
7200 1285`,style:{width:"100%",height:"150px",padding:"0.75rem",fontFamily:"monospace",fontSize:"0.875rem",backgroundColor:"#1e293b",color:"#e2e8f0",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",resize:"vertical"}}),a&&e.jsx("div",{style:{marginTop:"0.5rem",padding:"0.5rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-sm)",fontSize:"0.875rem",color:"#991b1b"},children:a}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.75rem"},children:[e.jsx("button",{onClick:te,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Preview"}),e.jsx("button",{onClick:oe,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Apply to VB6 UI Fixture"})]}),p.length>0&&e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("h4",{style:{marginTop:0,marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:["Preview (",p.length," points)"]}),e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#1e293b",borderRadius:"var(--radius-sm)",fontFamily:"monospace",fontSize:"0.75rem",color:"#e2e8f0",maxHeight:"150px",overflow:"auto"},children:[p.slice(0,10).map((d,w)=>e.jsxs("div",{children:[d.rpm.toFixed(0)," RPM ‚Üí ",d.hp.toFixed(1)," HP"]},w)),p.length>10&&e.jsxs("div",{style:{color:"#9ca3af",marginTop:"0.5rem"},children:["... and ",p.length-10," more points"]})]})]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"2. Paste PMI Values"}),h&&e.jsx("div",{style:{marginBottom:"0.75rem",padding:"0.5rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-sm)",fontSize:"0.875rem",color:"#991b1b"},children:h}),e.jsxs("div",{style:{display:"grid",gap:"0.75rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.25rem"},children:"PMI Engine (slug-ft¬≤)"}),e.jsx("input",{type:"text",value:_,onChange:d=>C(d.target.value),placeholder:"e.g., 3.42",style:{width:"100%",padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.25rem"},children:"PMI Chassis (slug-ft¬≤)"}),e.jsx("input",{type:"text",value:T,onChange:d=>P(d.target.value),placeholder:"e.g., 50.8",style:{width:"100%",padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.25rem"},children:"Gear Efficiencies (comma-separated)"}),e.jsx("input",{type:"text",value:m,onChange:d=>R(d.target.value),placeholder:"e.g., 0.98, 0.97, 0.96, 0.95",style:{width:"100%",padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"}})]})]}),e.jsx("button",{onClick:ie,style:{marginTop:"0.75rem",padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Apply PMI Values"})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"3. Load/Save Profiles"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem"},children:"Save Current Fixture as Profile"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:x,onChange:d=>l(d.target.value),placeholder:"Profile name",style:{flex:1,padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"}}),e.jsx("button",{onClick:ae,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Save"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem"},children:"Load Profile"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("select",{value:o,onChange:d=>b(d.target.value),style:{flex:1,padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"},children:[e.jsx("option",{value:"",children:"Select a profile..."}),g.map(d=>e.jsxs("option",{value:d.name,children:[d.name," (",new Date(d.timestamp).toLocaleDateString(),")"]},d.name))]}),e.jsx("button",{onClick:ne,disabled:!o,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:o?"#10b981":"#d1d5db",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:o?"pointer":"not-allowed"},children:"Load"}),e.jsx("button",{onClick:Y,disabled:!o,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:o?"#ef4444":"#d1d5db",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:o?"pointer":"not-allowed"},children:"Delete"})]})]}),g.length===0&&e.jsx("p",{style:{marginTop:"0.75rem",fontSize:"0.875rem",color:"var(--color-muted)",fontStyle:"italic"},children:"No saved profiles yet"})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"4. Load Example Fixture"}),e.jsx("button",{onClick:se,disabled:I,style:{padding:"0.75rem 1.5rem",fontSize:"0.875rem",fontWeight:"500",backgroundColor:I?"#9ca3af":"#f59e0b",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:I?"not-allowed":"pointer"},children:I?"Loading...":"Load Example: ProStock_Pro"}),e.jsx("p",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"var(--color-muted)"},children:"Loads complete ProStock_Pro fixture from VB6 printout, validates it, and opens Input Inspector"})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:de,style:{padding:"0.75rem 1.5rem",fontSize:"0.875rem",fontWeight:"500",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Validate Current Fixture"}),e.jsx("p",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"var(--color-muted)"},children:"Runs assertComplete() to check if all required fields are present"})]})]})}function Or(r){const t=r.elevation_ft??0,n=r.fuelSystem??1,i=[.0205558,.00118163,154988e-10,40245e-11,434856e-15,2096e-14],c=i[0]+i[1]*r.temperature_F+i[2]*r.temperature_F**2+i[3]*r.temperature_F**3+i[4]*r.temperature_F**4+i[5]*r.temperature_F**5,s=r.relHumidity_pct/100*c,p=Math.pow((or-.00356616*t)/or,5.25588),u=Pr*r.barometer_inHg/tt*p,a=u-s,k=a/Pr,_=s*kr/(a*tr),C=Rr*(1/tr+_/kr)/(1+_),T=C/(Rr/tr),P=r.temperature_F+rt,m=P/or,h=144*u/(C*P)/32.174;let j,g;switch(n){case 1:j=1,g=1;break;case 2:j=1,g=2;break;case 3:j=2,g=1;break;case 4:j=2,g=2;break;case 5:j=3,g=2;break;case 6:j=1,g=3;break;case 7:case 9:j=2,g=3;break;case 8:j=3,g=3;break;default:j=1,g=1;break}const S=1+2.48*Math.pow(_,1.5);let o,b,x;switch(j){case 1:o=1,b=.6,x=.15;break;case 2:o=1,b=.3,x=.13;break;case 3:o=.85,b=.5,x=.055;break;default:o=1,b=.6,x=.15;break}if(g===2&&(x=x-.005),g===3){const y=.3050108932461874;o=.95-y*b,b=b+y,x=.6*x}let l=Math.pow(k,o)/(Math.sqrt(T)*Math.pow(m,b));return l=(1+x)*S/l-x,n===9&&(l=1),{rho_slug_per_ft3:h,pamb_psi:u,PWV_psi:s,pair_psi:a,WAR:_,RGAS:C,temp_R:P,hpc:l,delta:k,theta:m,rgrs:T}}const lr=.002377;function qt(r,t){return .5*r*t*t}function $t(r){return r*5280/3600}function Jt(){const{fixture:r,setFixture:t}=we(),[n,i]=v.useState(""),[c,s]=v.useState(""),[p,u]=v.useState(""),[a,k]=v.useState(null),[_,C]=v.useState(null);v.useEffect(()=>{var m,R,h;r.env?(i(((m=r.env.barometer_inHg)==null?void 0:m.toString())||"29.92"),s(((R=r.env.temperature_F)==null?void 0:R.toString())||"75"),u(((h=r.env.relHumidity_pct)==null?void 0:h.toString())||"50")):(i("29.92"),s("75"),u("50"))},[r.env]),v.useEffect(()=>{try{const m=parseFloat(n),R=parseFloat(c),h=parseFloat(p);if(isNaN(m)||isNaN(R)||isNaN(h)){k(null),C(null);return}const g=Or({barometer_inHg:m,temperature_F:R,relHumidity_pct:h});k(g),C(null)}catch(m){C(m instanceof Error?m.message:String(m)),k(null)}},[n,c,p]);const T=()=>{var m,R,h,j,g;try{const S=parseFloat(n),o=parseFloat(c),b=parseFloat(p);if(isNaN(S)||isNaN(o)||isNaN(b)){alert("Please enter valid numbers for all fields");return}t({...r,env:{elevation_ft:((m=r.env)==null?void 0:m.elevation_ft)??0,barometer_inHg:S,temperature_F:o,relHumidity_pct:b,wind_mph:((R=r.env)==null?void 0:R.wind_mph)??0,wind_angle_deg:((h=r.env)==null?void 0:h.wind_angle_deg)??0,trackTemp_F:((j=r.env)==null?void 0:j.trackTemp_F)??o,tractionIndex:((g=r.env)==null?void 0:g.tractionIndex)??1}}),alert("‚úì Applied environment values to VB6 UI Fixture!")}catch(S){alert(`Error: ${S instanceof Error?S.message:String(S)}`)}},P=a?(a.rho_slug_per_ft3-lr)/lr*100:0;return e.jsxs("div",{style:{padding:"2rem",height:"100%",overflow:"auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Environment & Air Model"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Visualize air density calculations and dynamic pressure at various speeds."})]}),_&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem",fontSize:"0.875rem",color:"#991b1b"},children:_}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Environmental Conditions"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem"},children:"Barometer (inHg)"}),e.jsx("input",{type:"text",value:n,onChange:m=>i(m.target.value),placeholder:"29.92",style:{width:"100%",padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem"},children:"Temperature (¬∞F)"}),e.jsx("input",{type:"text",value:c,onChange:m=>s(m.target.value),placeholder:"75",style:{width:"100%",padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem"},children:"Relative Humidity (%)"}),e.jsx("input",{type:"text",value:p,onChange:m=>u(m.target.value),placeholder:"50",style:{width:"100%",padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"}})]})]}),e.jsx("button",{onClick:T,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Apply to current VB6 UI Fixture"})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Computed Air Density"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginBottom:"0.25rem"},children:"Air Density (œÅ)"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",fontFamily:"monospace"},children:a.rho_slug_per_ft3.toFixed(6)}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"slugs/ft¬≥"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginBottom:"0.25rem"},children:"Standard œÅ"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",fontFamily:"monospace"},children:lr.toFixed(6)}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"slugs/ft¬≥ (sea level, 59¬∞F)"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginBottom:"0.25rem"},children:"Delta from Standard"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",fontFamily:"monospace",color:P>0?"#10b981":P<0?"#ef4444":"inherit"},children:[P>=0?"+":"",P.toFixed(2),"%"]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:P>0?"Denser (more power)":P<0?"Thinner (less power)":"Standard"})]})]}),e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem",backgroundColor:"#1e293b",borderRadius:"var(--radius-sm)",fontFamily:"monospace",fontSize:"0.75rem",color:"#e2e8f0"},children:[e.jsx("div",{style:{marginBottom:"0.25rem"},children:e.jsx("strong",{children:"Intermediate Values:"})}),e.jsxs("div",{children:["Ambient Pressure: ",a.pamb_psi.toFixed(4)," psi"]}),e.jsxs("div",{children:["Water Vapor Pressure: ",a.PWV_psi.toFixed(4)," psi"]}),e.jsxs("div",{children:["Dry Air Pressure: ",a.pair_psi.toFixed(4)," psi"]}),e.jsxs("div",{children:["Water-to-Air Ratio: ",a.WAR.toFixed(6)]}),e.jsxs("div",{children:["Gas Constant: ",a.RGAS.toFixed(4)," ft¬∑lbf/(lbm¬∑¬∞R)"]}),e.jsxs("div",{children:["Temperature: ",a.temp_R.toFixed(2)," ¬∞R"]})]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Dynamic Pressure (q) at Various Speeds"}),e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#1e293b",color:"#e2e8f0"},children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",borderBottom:"2px solid var(--color-border)"},children:"Speed (MPH)"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"Speed (ft/s)"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"q (psf)"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"q (psi)"})]})}),e.jsx("tbody",{children:[10,50,100,200].map((m,R)=>{const h=$t(m),j=qt(a.rho_slug_per_ft3,h),g=j/144;return e.jsxs("tr",{style:{backgroundColor:R%2===0?"transparent":"rgba(0,0,0,0.02)"},children:[e.jsx("td",{style:{padding:"0.75rem",borderBottom:"1px solid var(--color-border)"},children:m}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",borderBottom:"1px solid var(--color-border)"},children:h.toFixed(2)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",borderBottom:"1px solid var(--color-border)"},children:j.toFixed(4)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",borderBottom:"1px solid var(--color-border)"},children:g.toFixed(6)})]},m)})})]}),e.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.75rem",color:"var(--color-muted)"},children:[e.jsx("strong",{children:"Note:"})," Dynamic pressure q = 0.5 √ó œÅ √ó v¬≤. Used in drag force calculation: F_drag = Cd √ó A √ó q"]})]})]})]})}function cr(r,t,n,i,c){let s=0;for(s=0;s<n-1&&!(c<=r[s+1]);s++);s>=n-1&&(s=n-2),s<0&&(s=0);const p=r[s],u=r[s+1],a=t[s],k=t[s+1];if(u===p)return a;const _=(c-p)/(u-p);return a+_*(k-a)}function Ur(r,t,n,i,c){let s,p;if(c)s=1+4e-5*n,p=s*r*Le/12;else{const u=(Math.pow(t,1.4)+r-16)/(.171*Math.pow(r,1.7));s=1+u*135e-7*Math.pow(n,1.6);const a=1+u*35e-5*n;a<s&&(s=a),p=(s-.035*Math.abs(i))*r*Le/12}return{TireGrowth:s,TireCirFt:p}}function qr(r,t){return(1-(r-1)*.01)/Math.pow(t,.25)}function $r(r){return r?mt:ht}function Qt(r,t){if(!(t!=null&&t.enabled))return 1;const{activateTime_s:n,duration_s:i,throttlePct:c,rampTime_s:s=0}=t,p=n+i;if(r<n||r>=p)return 1;const u=c/100;if(s>0&&r<n+s){const a=(r-n)/s;return 1-(1-u)*a}if(s>0&&r>p-s){const a=(p-r)/s;return 1-(1-u)*a}return u}function Xt(r,t,n,i,c){const s=r.Gear;let p;const u=r.Gear!==r.PrevGear;if(u)p=t.DTShift,r.PrevGear=r.Gear;else{if(p=i,r.Ags0_g>0&&r.L>1){const G=Math.min(r.AgsMax_g/r.Ags0_g,10);p=i*Math.pow(G,4)}p>.1&&(p=.1)}let a=0;const k=r.time_s-r.Time0_s;k>0&&(a=(r.AGS_g-r.Ags0_g)/k),a<Oe&&(a=Oe),a>Ue&&(a=Ue),r.Vel0_ftps=r.Vel_ftps,r.Ags0_g=r.AGS_g,r.Time0_s=r.time_s,r.Dist0_ft=r.Dist_ft,r.RPM0=r.EngRPM,r.DSRPM0=r.DSRPM,r.RPM0===t.LaunchRPM&&r.Time0_s===0&&(r.RPM0=t.Stall,t.LaunchRPM<t.Stall&&(r.Time0_s=t.EnginePMI*(t.Stall-t.LaunchRPM)/25e4));const _=Ur(t.TireDia_in,t.TireWidth_in,r.Vel_ftps,r.Ags0_g,n.isLandSpeed);r.TireGrowth=_.TireGrowth,r.TireCirFt=_.TireCirFt;let C;n.isLandSpeed?C=1.01+(n.TractionIndex-1)*.01:C=1.02+(.005*(n.TractionIndex-1)+3*(n.TrackTempEffect-1))*(1-Math.pow(r.Dist0_ft/1320,2));const T=t.TGR[s-1]??1,P=t.TiresPMI+t.TransPMI*Math.pow(t.GearRatio,2)*Math.pow(T,2);let m=r.Vel0_ftps+r.Ags0_g*J*p+a*J*p*p/2;m<r.Vel0_ftps*.9&&r.Vel0_ftps>100&&(m=r.Vel0_ftps),m<0&&(m=0);const R=t.ShiftRPM[s-1]??9e3;if(!u&&(p<.005&&(p=.005),p>.05&&(p=.05),m=r.Vel0_ftps+r.Ags0_g*J*p+a*J*p*p/2,r.Vel0_ftps>0&&r.RPM0>t.Stall&&s<t.NGR)){const G=r.Vel0_ftps*(R+5)/r.RPM0;m>G&&(m=G,r.Ags0_g*J>0&&(p=(m-r.Vel0_ftps)/(r.Ags0_g*J)))}const h=m*m-r.Vel0_ftps*r.Vel0_ftps,j=C*m*60/r.TireCirFt,g=j*t.GearRatio*T;let S=t.Slippage*g,o,b=t.Stall,x=0;t.isClutch?(S<t.Stall&&(s===1||!t.LockUp)&&(S=t.Stall),o=g/S):s===1||!t.LockUp?(b=t.Stall,x=t.Slippage*g/b,r.L>2&&(x>.6&&(b=b*(1+(t.Slippage-1)*(x-.6)/(1/t.Slippage-.6))),x=t.Slippage*g/b),o=1/t.Slippage,S<b&&(S=b,o=(t.TorqueMult-(t.TorqueMult-1)*x)*g/b)):(S=1.005*g,o=g/S),o>1&&(o=1);let l=cr(t.xrpm,t.yhp,t.NHP,1,S);l=t.HPTQMult*l/n.hpc,t.RevLimiterRPM>0&&S>=t.RevLimiterRPM&&(l=l*.05);const y=Qt(r.time_s,c);l=l*y;const A=l;l=l*o;const I=Math.sqrt(m*m+2*m*(n.WindSpeed_mph/$e)*Math.cos(Le*n.WindAngle_deg/180)+Math.pow(n.WindSpeed_mph/$e,2)),N=Math.sign(I)*n.rho*Math.pow(Math.abs(I),2)/(2*J);let Q;t.BodyStyle===8?Q=t.RefArea_ft2+(r.TireGrowth-1)*t.TireDia_in/2*t.TireWidth_in/144:Q=t.RefArea_ft2+(r.TireGrowth-1)*t.TireDia_in/2*(2*t.TireWidth_in)/144;const re=t.Weight_lbf+t.LiftCoef*Q*N,te=n.isLandSpeed?Lr:Dr,oe=n.isLandSpeed?ot:it,ie=n.isLandSpeed?nt:st,ne=(te-r.Dist0_ft/1320*oe)*re+1e-4*re*($e*m)+t.DragCoef*Q*N,Y=ne*m/550,de=12*r.TireCirFt/(2*Le),se=(r.Ags0_g*t.Weight_lbf*(t.YCG_in-de+ie/t.Efficiency*de)+ne*t.YCG_in)/t.Wheelbase_in;let d=t.StaticFWt_lbf-se,w=0;d<0&&(w=-d*t.Wheelbase_in/64,d=0);let B=re-d-w;B<0&&(B=t.Weight_lbf);const F=qr(n.TractionIndex,n.TrackTempEffect),z=$r(n.isLandSpeed);let D=F*z*t.TireDia_in*(t.TireWidth_in+1)*(.92+.08*Math.pow(B/1900,2.15));t.BodyStyle===8&&(D=.5*D);const E=(D/r.TireGrowth-ne)/t.Weight_lbf,Z=t.TGEff[s-1]??.99;l=l*Z*t.Efficiency/C;const V=l;l=l-Y;let H=550*J*l/t.Weight_lbf,W=H/(m*J),ce=!1;W>E&&(ce=!0,H=H*(E-(W-E))/W,W=E-(W-E)),W<xe&&(W=xe,H=xe*J*m);let me=Math.max(0,h)/(2*H)+r.Time0_s;const Me=n.isLandSpeed?lt:at,Ae=n.isLandSpeed?dt:ct;let he=t.EnginePMI*S*(S-r.RPM0);he<0&&(t.isClutch?he=Me*he:he=Ae*he);let Se=P*j*(j-r.DSRPM0);Se<0&&(Se=0);let Ie=0,ee=0,ve=0;for(ve=1;ve<=12;ve++){const G=me-r.Time0_s;if(G<=0)break;const M=Math.pow(2*Le/60,2)/(12*550*G);Ie=he*M,ee=Se*M,l=(A-Ie)*o,l=(l*Z*t.Efficiency-ee)/C-Y,H=550*J*l/t.Weight_lbf,W=H/(m*J);let le=0;G!==0&&(le=(W-r.Ags0_g)/G),le<Oe&&(le=Oe,W=r.Ags0_g+le*G,H=W*J*m),le>Ue&&(le=Ue,W=r.Ags0_g+le*G,H=W*J*m),ce=!1,W>E&&(ce=!0,H=H*(E-(W-E))/W,W=E-(W-E)),W<xe&&(W=xe,H=xe*J*m);const ze=Math.max(0,h)/(2*H)+r.Time0_s,Fe=ze-r.Time0_s;if(ve===12||Math.abs(100*(Fe-G)/Fe)<=.01){me=ze;break}let pe=l/A;pe<Tr&&(pe=Tr),pe>Cr&&(pe=Cr),me=r.Time0_s+G+pe*(Fe-G)}const ye=me-r.Time0_s;let ue;if(H<.1||ye<=0){const G=(r.Vel0_ftps+m)/2;ue=r.Dist0_ft+Math.max(0,G*Math.abs(ye))}else{const G=Math.pow(r.Vel0_ftps,3),M=2*H*ye+r.Vel0_ftps*r.Vel0_ftps;if(M<0){const le=(r.Vel0_ftps+m)/2;ue=r.Dist0_ft+le*ye}else ue=(Math.pow(M,1.5)-G)/(3*H)+r.Dist0_ft}return r.L+=1,r.time_s=me,r.Vel_ftps=m,r.Dist_ft=ue,r.AGS_g=W,r.EngRPM=S,r.DSRPM=j,r.SLIP=ce,{TimeStep_s:p,VelSqrd:h,LockRPM:g,ClutchSlip:o,zStall:b,SlipRatio:x,TireSlip:C,WindFPS:I,q:N,RefArea2_ft2:Q,DownForce_lbf:re,DragForce_lbf:ne,DragHP:Y,DynamicFWT_lbf:d,DynamicRWT_lbf:B,WheelBarWT_lbf:w,CRTF:D,AMax_g:E,ChassisPMI:P,EngAccHP:he,ChasAccHP:Se,HPSave:A,HPAtWheels:V,HP:l,PQWT:H,iterations:ve}}function Kt(r,t,n){const i=Ur(r.TireDia_in,r.TireWidth_in,0,0,t.isLandSpeed),c=cr(r.xrpm,r.yhp,r.NHP,1,n);let u=5252*(r.HPTQMult*c/t.hpc)/n;const a=r.TGR[0]??1,k=r.TGEff[0]??.99;u=u*r.TorqueMult*a*k;const _=t.isLandSpeed?Lr:Dr,C=t.WindSpeed_mph/$e,T=Math.sign(C)*t.rho*Math.pow(Math.abs(C),2)/(2*J),P=_*r.Weight_lbf+r.DragCoef*r.RefArea_ft2*T;let m;t.isLandSpeed?m=1.01+(t.TractionIndex-1)*.01:m=1.02+(t.TractionIndex-1)*.005+(t.TrackTempEffect-1)*3;const R=u*r.GearRatio*r.Efficiency/(m*r.TireDia_in/24)-P;let j=(r.isClutch?.88:.96)*R/r.Weight_lbf;const S=r.Weight_lbf-r.StaticFWt_lbf,o=qr(t.TractionIndex,t.TrackTempEffect),b=$r(t.isLandSpeed);let x=o*b*r.TireDia_in*(r.TireWidth_in+1)*(.92+.08*Math.pow(S/1900,2.15));r.BodyStyle===8&&(x=.5*x);const l=(x-P)/r.Weight_lbf;return j>l&&(j=l),j<xe&&(j=xe),{L:1,time_s:0,Vel_ftps:.001,Dist_ft:0,AGS_g:j,EngRPM:n,DSRPM:0,Gear:1,SLIP:!1,Vel0_ftps:0,Ags0_g:j,Time0_s:0,Dist0_ft:0,RPM0:n,DSRPM0:0,AgsMax_g:j,TireGrowth:i.TireGrowth,TireCirFt:i.TireCirFt,ShiftFlag:0,PrevGear:1}}function Yt(r,t,n,i){let c=r*.11*Math.pow(t*n/i,-.3333333333333333);return c=c/15,c<.005&&(c=.005),c}function Zt(r){const t=zr[r];return t?t.lengthFt:r==="EIGHTH"?660:1320}function eo(r){const t=ir[r];return t||(r==="EIGHTH"?ir.EIGHTH:ir.QUARTER)}function ro(r){if(!r)return 1;const t=r.toUpperCase();return t==="GASOLINE"?1:t==="GASOLINE EFI"?2:t==="METHANOL"?3:t==="METHANOL EFI"?4:t==="NITROMETHANE"?5:t==="SUPERCHARGED GASOLINE"?6:t==="SUPERCHARGED METHANOL"?7:t==="SUPERCHARGED NITRO"?8:t==="E85"||t==="DIESEL"||t==="GAS+CARB"||t==="GASOLINE+CARBURETOR"?1:t==="GAS+INJECT"||t==="GASOLINE+FUEL INJECTION"?2:t==="METHANOL+CARB"||t==="METHANOL+CARBURETOR"?3:t==="METHANOL+INJECT"||t==="METHANOL+FUEL INJECTION"?4:t==="NITRO+INJECT"||t==="NITROMETHANE+FUEL INJECTION"?5:t==="GAS+SUPERCHARGED"||t==="GASOLINE+SUPERCHARGED"?6:t==="METHANOL+SUPERCHARGED"?7:t==="NITRO+SUPERCHARGED"||t==="NITROMETHANE+SUPERCHARGED"?8:t==="ELECTRIC"?9:t.includes("SUPERCHARG")||t.includes("BLOWN")?t.includes("NITRO")?8:t.includes("METHANOL")||t.includes("ALCOHOL")?7:6:t.includes("INJECT")||t.includes("EFI")?t.includes("NITRO")?5:t.includes("METHANOL")||t.includes("ALCOHOL")?4:2:t.includes("NITRO")?5:t.includes("METHANOL")||t.includes("ALCOHOL")?3:t.includes("ELECTRIC")?9:1}function to(r){const t=r.vehicle,n=r.engine??t.engine,i=(n==null?void 0:n.hpCurve)??(n==null?void 0:n.torqueCurve)??t.torqueCurve??t.hpCurve??[],c=[],s=[];for(const _ of i)Array.isArray(_)?(c.push(_[0]),s.push(_[1])):_&&typeof _=="object"&&(c.push(_.rpm),_.hp!==void 0?s.push(_.hp):_.torque!==void 0?s.push(_.torque*_.rpm/5252):_.tq_lbft!==void 0&&s.push(_.tq_lbft*_.rpm/5252));if(c.length>=2)return{xrpm:c,yhp:s,NHP:c.length,isQuarterJr:!1};const p=Number(t.powerHP??t.peakHP),u=Number(t.rpmAtPeakHP??t.peakRPM??6500),a=Number(t.displacement_cid??t.displacementCID??350),k=r.fuelSystem??t.fuelSystem??1;if(Number.isFinite(p)&&p>0){const _=xt({peakHP:p,peakRPM:u,displacement_cid:a,fuelSystem:k}),{rpm:C,hp:T}=vt(_);return{xrpm:C,yhp:T,NHP:_.NHP,isQuarterJr:!0,quarterJrParams:{peakHP:p,rpmAtPeakHP:u,displacement_cid:a,fuelSystem:k}}}return{xrpm:[4e3,6500],yhp:[100,150],NHP:2,isQuarterJr:!1}}function oo(r){const t=Math.abs(100-r);let n;return r>100?n=1+25e-7*Math.pow(t,2.5):n=1+2e-6*Math.pow(t,2.5),n>1.04&&(n=1.04),n}function io(r){var ur,gr,fr,br,xr,vr,yr,_r,jr;const t=[],n=[],i=r.vehicle,c=r.env,s=r.raceLength??"QUARTER",p=r.raceLengthFt??Zt(s),u=((ur=zr[s])==null?void 0:ur.category)==="landspeed",a=i.rolloutIn??9,k=i.overhangIn??0;let _=2*a;_<24&&(_=24);let C=(k+.25*_)/12;const T=.5*_/12;C<T&&(C=T);const P=a/12,m=r.drivetrain??i.drivetrain,R=(m==null?void 0:m.clutch)??r.clutch??i.clutch,h=(m==null?void 0:m.converter)??r.converter??i.converter,j=r.engine??i.engine,g=r.pmi??i.pmi,S=r.throttleStop,o=S!=null&&S.enabled?{enabled:!0,activateTime_s:S.activateTime_s,duration_s:S.duration_s,throttlePct:S.throttlePct,rampTime_s:S.rampTime_s}:void 0,b=i.transmissionType??r.transmissionType,x=b==="clutch"?!0:b==="converter"?!1:!h||R&&!h,l=r.fuel,y=typeof l=="string"?l:(l==null?void 0:l.fuelType)??(l==null?void 0:l.fuelSystem)??(l==null?void 0:l.type)??r.fuelType??i.fuelType??r.fuelSystem??i.fuelSystem,A=ro(y),I=Or({barometer_inHg:c.barometerInHg??29.92,temperature_F:c.temperatureF??59,relHumidity_pct:c.humidityPct??50,elevation_ft:c.elevation??0,fuelSystem:A}),N=I.rho_slug_per_ft3*J,Q=I.hpc,re=to(r),{xrpm:te,yhp:oe,NHP:ie,isQuarterJr:ae,quarterJrParams:ne}=re;ie<2&&t.push("HP curve has fewer than 2 points"),ae&&t.push("Using QuarterJr mode (synthetic HP curve from peak HP)");const Y=(m==null?void 0:m.gearRatios)??i.gearRatios??[2.5,1.8,1.4,1.1,1],de=(m==null?void 0:m.finalDriveRatio)??i.finalDrive??i.rearGear??3.73,se=Y.length,d=i.tire,w=(d==null?void 0:d.diameter_in)??i.tireDiaIn??32,B=(d==null?void 0:d.width_in)??i.tireWidthIn??17,F=i.bodyStyle??pt(i.weightLb);let z,D,E,Z,V,H,W,ce,De,me,Me,Ae;if(ae&&ne){const{displacement_cid:L,fuelSystem:_e}=ne;z=ut(se,!x);const X=i.shiftRPM??(m==null?void 0:m.shiftRPM)??7e3;D=Y.map(()=>X);const O=(R==null?void 0:R.slipRPM)??(h==null?void 0:h.stallRPM)??i.slipStallRPM??5e3;if(x)Z=yt(O),V=1,E=O;else{const rr=(h==null?void 0:h.diameter_in)??(h==null?void 0:h.diameter)??i.converterDiameterIn??i.converterDia_in??10;let ge;if(O>220){E=O;const U=gt(te,oe,ie,1,E)*(jt/E)/Q;ge=E/1e3*(E/U)}else ge=O,E=O;const Ge=ge/(200*Math.pow(7/rr,4));Z=1.01+Ge/20+ge/8e3,V=2.633-Math.pow(Ge,.3)-ge/1500,V<1&&(V=1),V>2&&(V=2)}De=_t(F);const K=ft(F);me=K.dragCoef,Me=K.liftCoef,Ae=K.overhang_in;const q=bt(L,_e,!x,se,w,B,F);H=q.enginePMI,W=q.transPMI,ce=q.tiresPMI}else{z=(m==null?void 0:m.perGearEff)??i.gearEfficiencies??null??Y.map(()=>.99),D=(m==null?void 0:m.shiftRPMs)??(m==null?void 0:m.shiftsRPM)??i.shiftRPMs??Y.map(()=>7e3);const _e=(R==null?void 0:R.slipRPM)??i.clutchSlipRPM??7200,X=(h==null?void 0:h.stallRPM)??i.converterStallRPM??5500;E=x?_e:X;const O=(R==null?void 0:R.slippageFactor)??(R==null?void 0:R.slippage)??i.clutchSlippage??1.0025,K=(h==null?void 0:h.slippageFactor)??(h==null?void 0:h.slippage)??i.converterSlippage??1.06;Z=x?O:K,V=x?1:(h==null?void 0:h.torqueMult)??(h==null?void 0:h.torqueMultiplier)??i.converterTorqueMult??2.2,H=(g==null?void 0:g.engine_flywheel_clutch)??i.enginePMI??(j==null?void 0:j.enginePMI)??4,ce=(g==null?void 0:g.tires_wheels_ringgear)??i.tiresPMI??(j==null?void 0:j.tiresPMI)??.5,W=(g==null?void 0:g.transmission_driveshaft)??i.transPMI??(j==null?void 0:j.transPMI)??.2,De=(m==null?void 0:m.overallEfficiency)??i.transEfficiency??.97;const q=r.aero??i.aero;me=(q==null?void 0:q.Cd)??(q==null?void 0:q.cd)??i.cd??.35,Me=(q==null?void 0:q.Cl)??(q==null?void 0:q.cl)??i.liftCoeff??0,Ae=k}const he=i.cgHeight_in??i.cgHeightIn??w/2+3.75,Se=i.staticFrontWeight_lb??i.staticFrontWeightLb??i.weightLb*.38,Ie=ae?Ae:k,ee={Weight_lbf:i.weightLb,Wheelbase_in:i.wheelbaseIn??100,YCG_in:he,StaticFWt_lbf:Se,TireDia_in:w,TireWidth_in:B,Rollout_in:i.rolloutIn??12,GearRatio:de,TGR:Y,TGEff:z,Efficiency:De,DTShift:x?.2:.25,Slippage:Z,TorqueMult:V,Stall:E,LockUp:(h==null?void 0:h.lockup)??!1,isClutch:x,RefArea_ft2:((gr=r.aero)==null?void 0:gr.frontalArea_ft2)??i.frontalArea_ft2??i.frontalAreaFt2??20,DragCoef:me,LiftCoef:Me,BodyStyle:F,EnginePMI:H,TiresPMI:ce,TransPMI:W,xrpm:te,yhp:oe,NHP:ie,HPTQMult:i.hpTorqueMultiplier??(j==null?void 0:j.hpTqMult)??1,ShiftRPM:D,NGR:se,LaunchRPM:x?(R==null?void 0:R.launchRPM)??i.clutchLaunchRPM??E:E,ShiftMode:i.shiftMode??"rpm",ShiftTimes:i.shiftTimes??[],RevLimiterRPM:i.revLimiterRPM??0};if(ae&&Ie!==k){let L=2*a;L<24&&(L=24),C=(Ie+.25*L)/12;const _e=.5*L/12;C<_e&&(C=_e)}const ve=c.trackTempF??100,ye=u?1:oo(ve),ue={rho:N,hpc:Q,TractionIndex:c.tractionIndex??5,TrackTempEffect:ye,WindSpeed_mph:c.windMph??0,WindAngle_deg:c.windAngleDeg??0,isLandSpeed:u},G=x?(R==null?void 0:R.launchRPM)??E:E,M=Kt(ee,ue,G),le=cr(te,oe,ie,1,G),mr=Yt(60,le,V,i.weightLb),ze=u?5e4:5e3,Fe=u?300:30,pe={iterations:[],convergenceHistory:[]},Ze=[],er=eo(s);let Ne=0,We=null,Re=null,Pe=null;for(let L=0;L<ze&&!(M.Dist_ft-P+C>=p+50||M.time_s>=Fe);L++){if(!Number.isFinite(M.Vel_ftps)||!Number.isFinite(M.Dist_ft)||!Number.isFinite(M.AGS_g)){t.push(`NaN detected at step ${L}: Vel=${M.Vel_ftps}, Dist=${M.Dist_ft}, AGS=${M.AGS_g}`);break}const X=Xt(M,ee,ue,mr,o);if(pe.iterations.push(X.iterations),L<20&&pe.convergenceHistory.push({step:L,iterations:X.iterations,HPSave:X.HPSave,HP:X.HP,PQWT:X.PQWT,AGS_g:M.AGS_g}),We===null&&M.Dist_ft>=P){const $=(M.Dist_ft-P)/M.Vel_ftps;We=M.time_s-$}const O=Math.max(0,M.Dist_ft-P+C),K=We!==null?M.time_s-We:0,q=ee.TGR[M.Gear-1]??1,rr=(X.LockRPM??M.EngRPM)/q,ge=X.TireSlip,Ge=M.Vel_ftps*ge*Ee,Sr=(o==null?void 0:o.enabled)&&K>=o.activateTime_s&&K<o.activateTime_s+o.duration_s;if(n.push({t_s:K,s_ft:O,v_fps:M.Vel_ftps,v_mph:M.Vel_ftps*Ee,a_g:M.AGS_g,rpm:M.EngRPM,dsrpm:rr,lockRpm:X.LockRPM,gear:M.Gear,slip:M.SLIP,tireSlip:ge,hp:X.HPAtWheels,dragHp:X.DragHP,netHp:X.HP,wheelSpeed_mph:Ge,throttleStopActive:Sr}),Re===null&&O>=594){const U=n.length>1?((fr=n[n.length-2])==null?void 0:fr.s_ft)??0:0,$=n.length>1?((br=n[n.length-2])==null?void 0:br.t_s)??0:0;if(U<594&&O>U){const Te=(594-U)/(O-U);Re=$+Te*(K-$)}else Re=K}if(Pe===null&&O>=1254){const U=n.length>1?((xr=n[n.length-2])==null?void 0:xr.s_ft)??0:0,$=n.length>1?((vr=n[n.length-2])==null?void 0:vr.t_s)??0:0;if(U<1254&&O>U){const Te=(1254-U)/(O-U);Pe=$+Te*(K-$)}else Pe=K}for(;Ne<er.length&&O>=er[Ne];){const U=er[Ne],$=n.length>1?((yr=n[n.length-2])==null?void 0:yr.s_ft)??0:0,Te=n.length>1?((_r=n[n.length-2])==null?void 0:_r.t_s)??0:0;let Ce=K;if($<U&&O>$){const Xr=(U-$)/(O-$);Ce=Te+Xr*(K-Te)}let Ve;U===660&&Re!==null&&Ce>Re?Ve=Ee*66/(Ce-Re):U===1320&&Pe!==null&&Ce>Pe?Ve=Ee*66/(Ce-Pe):Ve=M.Vel_ftps*Ee,Ze.push({d_ft:U,t_s:Ce,v_mph:Ve}),Ne++}if(M.ShiftFlag===1)M.ShiftFlag=2,M.Gear++;else if(M.ShiftFlag===2)M.ShiftFlag=0;else if(M.Gear<ee.NGR)if((ee.ShiftMode??"rpm")==="time"){const $=(jr=ee.ShiftTimes)==null?void 0:jr[M.Gear-1];$!==void 0&&M.time_s>=$&&(M.ShiftFlag=1)}else{const $=ee.ShiftRPM[M.Gear-1]??7e3;M.EngRPM>=$&&(M.ShiftFlag=1)}}const ke=Ze.find(L=>L.d_ft===p),hr=(ke==null?void 0:ke.t_s)??M.time_s,pr=(ke==null?void 0:ke.v_mph)??M.Vel_ftps*Ee,Jr=n.map(L=>({t_s:L.t_s,s_ft:L.s_ft,v_mph:L.v_mph,v_fps:L.v_fps,a_g:L.a_g,rpm:L.rpm,dsrpm:L.dsrpm,lockRpm:L.lockRpm,gear:L.gear,slip:L.slip,tireSlip:L.tireSlip,hp:L.hp,dragHp:L.dragHp,wheelSpeed_mph:L.wheelSpeed_mph})),Qr={fuelType:{resolved:y??"unknown",fuelSystemType:A,vehicleFuelType:i.fuelType,vehicleFuelSystem:i.fuelSystem},hpCurve:{length:ie,peakHP:Math.max(...oe),rpmRange:`${Math.min(...te)} - ${Math.max(...te)}`},airCalc:{rho_lbm_ft3:N,hpc:Q},simParams:{weight:i.weightLb,tireDia:w,wheelbase:i.wheelbaseIn??100,finalDrive:de,NGR:se,peakHP:Math.max(...oe),stallRPM:E,slippage:Z,isClutch:x,tractionIndex:ue.TractionIndex,trackTempEffect:ye,pmi:{engine:H,trans:W,tires:ce},aero:{frontalArea:ee.RefArea_ft2,cd:ee.DragCoef,cl:ee.LiftCoef},launchRPM:ee.LaunchRPM},result:{et:hr,mph:pr}};return{et_s:hr,mph:pr,timeslip:Ze,traces:Jr,meta:{model:"VB6Exact",steps:n.length,warnings:t},vb6Diagnostics:pe,debugData:Qr}}const no={name:"VB6Exact",simulate:io};function so(){const[r,t]=v.useState(new Set),[n,i]=v.useState(new Set(["QUARTER"])),[c,s]=v.useState(!1),[p,u]=v.useState([]),[a,k]=v.useState(null),_=o=>{const b=new Set(r);b.has(o)?b.delete(o):b.add(o),t(b)},C=o=>{const b=new Set(n);b.has(o)?b.delete(o):b.add(o),i(b)},T=()=>{t(new Set(Je.map(o=>o.name)))},P=()=>{t(new Set)},m=(o,b)=>{const x=dr[o];if(!x)throw new Error(`Benchmark config not found: ${o}`);return Gt(x),{vehicle:{id:`benchmark_${o}`,name:o,weightLb:x.vehicle.weightLb,tireDiaIn:x.vehicle.tireDiaIn??x.vehicle.tireRolloutIn/Math.PI,rearGear:x.vehicle.rearGear??x.vehicle.finalDrive,rolloutIn:x.vehicle.rolloutIn,powerHP:x.vehicle.torqueCurve?Math.max(...x.vehicle.torqueCurve.map(y=>y.hp??0)):x.vehicle.powerHP,defaultRaceLength:b,torqueCurve:x.vehicle.torqueCurve,frontalArea_ft2:x.vehicle.frontalArea_ft2,cd:x.vehicle.cd,gearRatios:x.vehicle.gearRatios,shiftRPM:x.vehicle.shiftRPM,wheelbaseIn:x.vehicle.wheelbaseIn,overhangIn:x.vehicle.overhangIn,tireRolloutIn:x.vehicle.tireRolloutIn,tireWidthIn:x.vehicle.tireWidthIn,liftCoeff:x.vehicle.liftCoeff,rrCoeff:x.vehicle.rrCoeff,finalDrive:x.vehicle.finalDrive??x.vehicle.rearGear,transEff:x.vehicle.transEff,gearEff:x.vehicle.gearEff,converter:x.vehicle.converter,clutch:x.vehicle.clutch},env:{elevation:x.env.elevation,barometerInHg:x.env.barometerInHg,temperatureF:x.env.temperatureF,humidityPct:x.env.humidityPct},raceLength:b}},R=async()=>{if(r.size===0||n.size===0){k("Please select at least one benchmark and one race length");return}s(!0),k(null),u([]);const o=[];try{for(const b of r){const x=Je.find(l=>l.name===b);if(x)for(const l of n){const y=x.raceLengthTargets[l];if(y)try{const A=m(b,l),I=no.simulate(A),N=Wt(x,l,I.et_s,I.mph);o.push({benchmarkName:b,raceLength:l,targetET:y.et_s,targetMPH:y.mph,actualET:I.et_s,actualMPH:I.mph,etDelta:N.etDelta,mphDelta:N.mphDelta,etPass:N.etPass,mphPass:N.mphPass,pass:N.pass,etTolerance:N.etTolerance,mphTolerance:N.mphTolerance})}catch(A){console.error(`Error running ${b} ${l}:`,A),o.push({benchmarkName:b,raceLength:l,targetET:y.et_s,targetMPH:y.mph,actualET:0,actualMPH:0,etDelta:0,mphDelta:0,etPass:!1,mphPass:!1,pass:!1,etTolerance:y.tolET_s,mphTolerance:y.tolMPH})}}}u(o)}catch(b){k(b instanceof Error?b.message:String(b))}finally{s(!1)}},h=o=>{alert(`TODO: Load ${o} fixture into VB6 Inputs and navigate to Run Inspector`)},j=()=>{if(p.length===0){alert("No results to export");return}const o=["Benchmark","Distance","Target ET (s)","Actual ET (s)","ET Delta (s)","ET Tolerance (s)","ET Pass","Target MPH","Actual MPH","MPH Delta","MPH Tolerance","MPH Pass","Overall Pass"],b=p.map(I=>[I.benchmarkName,I.raceLength,I.targetET.toFixed(3),I.actualET.toFixed(3),I.etDelta.toFixed(3),I.etTolerance.toFixed(3),I.etPass?"PASS":"FAIL",I.targetMPH.toFixed(2),I.actualMPH.toFixed(2),I.mphDelta.toFixed(2),I.mphTolerance.toFixed(2),I.mphPass?"PASS":"FAIL",I.pass?"PASS":"FAIL"]),x=[o.join(","),...b.map(I=>I.join(","))].join(`
`),l=new Blob([x],{type:"text/csv"}),y=URL.createObjectURL(l),A=document.createElement("a");A.href=y,A.download=`parity-results-${Date.now()}.csv`,A.click(),URL.revokeObjectURL(y)},g=p.filter(o=>o.pass).length,S=p.length;return e.jsxs("div",{style:{padding:"2rem",height:"100%",overflow:"auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Parity Runner"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Run benchmark tests and compare VB6Exact against Quarter Pro/Jr targets."})]}),a&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem",fontSize:"0.875rem",color:"#991b1b"},children:a}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Select Benchmarks"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("button",{onClick:T,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Select All"}),e.jsx("button",{onClick:P,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Select None"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.5rem",marginBottom:"1rem"},children:Je.map(o=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",cursor:"pointer",fontSize:"0.875rem"},children:[e.jsx("input",{type:"checkbox",checked:r.has(o.name),onChange:()=>_(o.name)}),e.jsx("span",{children:o.name}),e.jsxs("span",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:["(",o.source,")"]})]},o.name))}),e.jsx("h3",{style:{marginTop:"1rem",marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"Race Lengths"}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:n.has("EIGHTH"),onChange:()=>C("EIGHTH")}),e.jsx("span",{children:"EIGHTH (660 ft)"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:n.has("QUARTER"),onChange:()=>C("QUARTER")}),e.jsx("span",{children:"QUARTER (1320 ft)"})]})]})]}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx("button",{onClick:R,disabled:c,style:{padding:"0.75rem 1.5rem",fontSize:"0.875rem",fontWeight:"500",backgroundColor:c?"#9ca3af":"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:c?"not-allowed":"pointer"},children:c?"Running...":"Run Selected Benchmarks"})}),p.length>0&&e.jsx("div",{style:{padding:"1rem",backgroundColor:g===S?"#d1fae5":"#fee2e2",border:`1px solid ${g===S?"#10b981":"#ef4444"}`,borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:"1rem",fontWeight:"600"},children:g===S?"‚úì All Tests Passed":`‚ö† ${S-g} Test(s) Failed`}),e.jsxs("div",{style:{fontSize:"0.875rem"},children:[g," / ",S," passed"]})]})}),p.length>0&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:"600"},children:"Results"}),e.jsx("button",{onClick:j,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Export CSV"})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#1e293b",color:"#e2e8f0"},children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",borderBottom:"2px solid var(--color-border)"},children:"Benchmark"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"center",borderBottom:"2px solid var(--color-border)"},children:"Distance"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"Target ET"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"Actual ET"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"ET Œî"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"Target MPH"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"Actual MPH"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"MPH Œî"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"center",borderBottom:"2px solid var(--color-border)"},children:"Status"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"center",borderBottom:"2px solid var(--color-border)"},children:"Actions"})]})}),e.jsx("tbody",{children:p.map((o,b)=>e.jsxs("tr",{style:{backgroundColor:b%2===0?"transparent":"rgba(0,0,0,0.02)"},children:[e.jsx("td",{style:{padding:"0.75rem",borderBottom:"1px solid var(--color-border)"},children:o.benchmarkName}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center",borderBottom:"1px solid var(--color-border)"},children:o.raceLength}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",borderBottom:"1px solid var(--color-border)"},children:o.targetET.toFixed(3)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",borderBottom:"1px solid var(--color-border)"},children:o.actualET.toFixed(3)}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",color:o.etPass?"#10b981":"#ef4444",borderBottom:"1px solid var(--color-border)"},children:[o.etDelta>=0?"+":"",o.etDelta.toFixed(3)]}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",borderBottom:"1px solid var(--color-border)"},children:o.targetMPH.toFixed(2)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",borderBottom:"1px solid var(--color-border)"},children:o.actualMPH.toFixed(2)}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",color:o.mphPass?"#10b981":"#ef4444",borderBottom:"1px solid var(--color-border)"},children:[o.mphDelta>=0?"+":"",o.mphDelta.toFixed(2)]}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center",borderBottom:"1px solid var(--color-border)"},children:e.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"9999px",fontSize:"0.75rem",fontWeight:"600",backgroundColor:o.pass?"#10b981":"#ef4444",color:"white"},children:o.pass?"PASS":"FAIL"})}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center",borderBottom:"1px solid var(--color-border)"},children:e.jsx("button",{onClick:()=>h(o.benchmarkName),style:{padding:"0.25rem 0.75rem",fontSize:"0.75rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"var(--radius-sm)",cursor:"pointer"},children:"Open in Run Inspector"})})]},`${o.benchmarkName}-${o.raceLength}`))})]})})]})]})}const f={container:{padding:"1rem"},tabs:{display:"flex",gap:"0.25rem",marginBottom:"1rem",borderBottom:"1px solid var(--color-border)"},tab:{padding:"0.75rem 1.5rem",border:"none",background:"transparent",cursor:"pointer",fontSize:"0.875rem",fontWeight:500,color:"var(--color-muted)",borderBottom:"2px solid transparent",marginBottom:"-1px"},tabActive:{color:"var(--color-primary)",borderBottomColor:"var(--color-primary)"},section:{marginBottom:"1.5rem"},sectionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem"},sectionTitle:{fontSize:"0.875rem",fontWeight:600,textTransform:"uppercase",color:"var(--color-muted)"},card:{backgroundColor:"var(--color-background)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",overflow:"hidden"},row:{display:"flex",alignItems:"center",gap:"1rem",padding:"0.75rem 1rem",borderBottom:"1px solid var(--color-border)"},badge:{padding:"0.25rem 0.5rem",borderRadius:"9999px",fontSize:"0.75rem",fontWeight:600},button:{padding:"0.5rem 1rem",borderRadius:"var(--radius-sm)",border:"none",cursor:"pointer",fontSize:"0.875rem",fontWeight:500},primaryBtn:{backgroundColor:"var(--color-primary)",color:"white"},secondaryBtn:{backgroundColor:"var(--color-surface)",color:"var(--color-text)",border:"1px solid var(--color-border)"},dangerBtn:{backgroundColor:"#dc2626",color:"white"},smallBtn:{padding:"0.25rem 0.5rem",fontSize:"0.75rem"},input:{width:"100%",padding:"0.5rem",borderRadius:"var(--radius-sm)",border:"1px solid var(--color-border)",backgroundColor:"var(--color-background)",color:"var(--color-text)",fontSize:"0.875rem"},formGroup:{marginBottom:"1rem"},label:{display:"block",fontSize:"0.875rem",fontWeight:500,marginBottom:"0.25rem"},modal:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},modalContent:{backgroundColor:"var(--color-surface)",borderRadius:"var(--radius-lg)",padding:"1.5rem",width:"500px",maxWidth:"90vw",maxHeight:"90vh",overflow:"auto"},checkboxGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))",gap:"0.5rem"},checkbox:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.75rem"}},lo=[{id:"quarter_jr",name:"Quarter Jr"},{id:"quarter_pro",name:"Quarter Pro"},{id:"bonneville_pro",name:"Bonneville Pro"},{id:"engine_pro",name:"Engine Pro"},{id:"fourlink",name:"Four Link"},{id:"cam_analyzer",name:"Cam Analyzer"}];function ao({user:r,onClose:t,onSave:n,onDelete:i}){const[c,s]=v.useState((r==null?void 0:r.email)||""),[p,u]=v.useState((r==null?void 0:r.name)||""),[a,k]=v.useState((r==null?void 0:r.role)||"user"),[_,C]=v.useState((r==null?void 0:r.products)||[]),[T,P]=v.useState(""),m=h=>{C(j=>j.includes(h)?j.filter(g=>g!==h):[...j,h])},R=h=>{h.preventDefault(),n({email:c,name:p,role:a,products:_,...T?{password:T}:{}}),t()};return e.jsx("div",{style:f.modal,onClick:t,children:e.jsxs("div",{style:f.modalContent,onClick:h=>h.stopPropagation(),children:[e.jsx("h3",{style:{marginTop:0},children:r?"Edit User":"Create User"}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Email"}),e.jsx("input",{style:f.input,type:"email",value:c,onChange:h=>s(h.target.value),required:!0,disabled:!!r})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Name"}),e.jsx("input",{style:f.input,type:"text",value:p,onChange:h=>u(h.target.value),required:!0})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Role"}),e.jsxs("select",{style:f.input,value:a,onChange:h=>k(h.target.value),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"beta",children:"Beta Tester"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"owner",children:"Owner"})]})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Products"}),e.jsx("div",{style:f.checkboxGrid,children:lo.map(h=>e.jsxs("label",{style:f.checkbox,children:[e.jsx("input",{type:"checkbox",checked:_.includes(h.id),onChange:()=>m(h.id)}),h.name]},h.id))})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:r?"New Password (leave blank to keep)":"Password"}),e.jsx("input",{style:f.input,type:"password",value:T,onChange:h=>P(h.target.value),...!r&&{required:!0,minLength:6}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"1rem"},children:[r&&i&&e.jsx("button",{type:"button",style:{...f.button,...f.dangerBtn},onClick:()=>{i(),t()},children:"Delete"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginLeft:"auto"},children:[e.jsx("button",{type:"button",style:{...f.button,...f.secondaryBtn},onClick:t,children:"Cancel"}),e.jsx("button",{type:"submit",style:{...f.button,...f.primaryBtn},children:r?"Save":"Create"})]})]})]})]})})}function co({role:r,products:t,onClose:n,onSave:i,onDelete:c}){const[s,p]=v.useState((r==null?void 0:r.name)||""),[u,a]=v.useState((r==null?void 0:r.description)||""),[k,_]=v.useState((r==null?void 0:r.color)||"#6b7280"),[C,T]=v.useState((r==null?void 0:r.products)||[]),[P,m]=v.useState((r==null?void 0:r.additionalFeatures)||[]),[R,h]=v.useState((r==null?void 0:r.canManageUsers)||!1),[j,g]=v.useState((r==null?void 0:r.canManageRoles)||!1),[S,o]=v.useState((r==null?void 0:r.sortOrder)||50),b=y=>{y.preventDefault(),i({name:s,description:u,color:k,products:C,additionalFeatures:P,canManageUsers:R,canManageRoles:j,isSystem:(r==null?void 0:r.isSystem)||!1,sortOrder:S}),n()},x=y=>{T(A=>A.includes(y)?A.filter(I=>I!==y):[...A,y])},l=y=>{m(A=>A.includes(y)?A.filter(I=>I!==y):[...A,y])};return e.jsx("div",{style:f.modal,onClick:n,children:e.jsxs("div",{style:f.modalContent,onClick:y=>y.stopPropagation(),children:[e.jsx("h3",{style:{marginTop:0},children:r?"Edit Role":"Create Role"}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 100px",gap:"1rem"},children:[e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Name"}),e.jsx("input",{style:f.input,value:s,onChange:y=>p(y.target.value),required:!0})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Color"}),e.jsx("input",{type:"color",style:{...f.input,height:"38px",padding:"2px"},value:k,onChange:y=>_(y.target.value)})]})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Description"}),e.jsx("textarea",{style:{...f.input,minHeight:"50px"},value:u,onChange:y=>a(y.target.value)})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Products Access"}),e.jsx("div",{style:f.checkboxGrid,children:t.map(y=>e.jsxs("label",{style:f.checkbox,children:[e.jsx("input",{type:"checkbox",checked:C.includes(y.id),onChange:()=>x(y.id)}),e.jsx("span",{style:{color:y.color},children:y.icon})," ",y.name]},y.id))})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Additional Features"}),e.jsx("div",{style:f.checkboxGrid,children:Wr.filter(y=>["dev_tools","user_management","role_management","system_settings","view_analytics","beta_features"].includes(y)).map(y=>e.jsxs("label",{style:f.checkbox,children:[e.jsx("input",{type:"checkbox",checked:P.includes(y),onChange:()=>l(y)}),y.replace(/_/g," ")]},y))})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem"},children:[e.jsxs("label",{style:f.checkbox,children:[e.jsx("input",{type:"checkbox",checked:R,onChange:y=>h(y.target.checked)}),"Can Manage Users"]}),e.jsxs("label",{style:f.checkbox,children:[e.jsx("input",{type:"checkbox",checked:j,onChange:y=>g(y.target.checked)}),"Can Manage Roles"]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Sort Order"}),e.jsx("input",{type:"number",style:f.input,value:S,onChange:y=>o(parseInt(y.target.value)||0)})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"1rem"},children:[r&&!r.isSystem&&c&&e.jsx("button",{type:"button",style:{...f.button,...f.dangerBtn},onClick:()=>{c(),n()},children:"Delete"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginLeft:"auto"},children:[e.jsx("button",{type:"button",style:{...f.button,...f.secondaryBtn},onClick:n,children:"Cancel"}),e.jsx("button",{type:"submit",style:{...f.button,...f.primaryBtn},children:r?"Save":"Create"})]})]})]})]})})}function mo({product:r,onClose:t,onSave:n,onDelete:i}){const[c,s]=v.useState((r==null?void 0:r.name)||""),[p,u]=v.useState((r==null?void 0:r.description)||""),[a,k]=v.useState((r==null?void 0:r.icon)||"üì¶"),[_,C]=v.useState((r==null?void 0:r.color)||"#6b7280"),[T,P]=v.useState((r==null?void 0:r.features)||[]),[m,R]=v.useState((r==null?void 0:r.isPremium)||!1),[h,j]=v.useState((r==null?void 0:r.sortOrder)||50),g=o=>{o.preventDefault(),n({name:c,description:p,icon:a,color:_,features:T,isPremium:m,sortOrder:h}),t()},S=o=>{P(b=>b.includes(o)?b.filter(x=>x!==o):[...b,o])};return e.jsx("div",{style:f.modal,onClick:t,children:e.jsxs("div",{style:f.modalContent,onClick:o=>o.stopPropagation(),children:[e.jsx("h3",{style:{marginTop:0},children:r?"Edit Product":"Create Product"}),e.jsxs("form",{onSubmit:g,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"60px 1fr 100px",gap:"1rem"},children:[e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Icon"}),e.jsx("input",{style:{...f.input,textAlign:"center",fontSize:"1.5rem"},value:a,onChange:o=>k(o.target.value)})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Name"}),e.jsx("input",{style:f.input,value:c,onChange:o=>s(o.target.value),required:!0})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Color"}),e.jsx("input",{type:"color",style:{...f.input,height:"38px",padding:"2px"},value:_,onChange:o=>C(o.target.value)})]})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Description"}),e.jsx("textarea",{style:{...f.input,minHeight:"50px"},value:p,onChange:o=>u(o.target.value)})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Features"}),e.jsx("div",{style:f.checkboxGrid,children:Wr.filter(o=>!["dev_tools","user_management","role_management","system_settings","view_analytics","beta_features"].includes(o)).map(o=>e.jsxs("label",{style:f.checkbox,children:[e.jsx("input",{type:"checkbox",checked:T.includes(o),onChange:()=>S(o)}),o.replace(/_/g," ")]},o))})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("label",{style:f.checkbox,children:[e.jsx("input",{type:"checkbox",checked:m,onChange:o=>R(o.target.checked)}),"Premium Product"]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Sort Order"}),e.jsx("input",{type:"number",style:f.input,value:h,onChange:o=>j(parseInt(o.target.value)||0)})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"1rem"},children:[r&&i&&e.jsx("button",{type:"button",style:{...f.button,...f.dangerBtn},onClick:()=>{i(),t()},children:"Delete"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginLeft:"auto"},children:[e.jsx("button",{type:"button",style:{...f.button,...f.secondaryBtn},onClick:t,children:"Cancel"}),e.jsx("button",{type:"submit",style:{...f.button,...f.primaryBtn},children:r?"Save":"Create"})]})]})]})]})})}function ho(){var g,S,o,b,x;const r=Nr(),[t,n]=v.useState("users"),[i,c]=v.useState(null),[s,p]=v.useState(null),[u,a]=v.useState(null),[k,_]=v.useState([]),[C,T]=v.useState(!0),[P,m]=v.useState(null),R=r.getAllRoles(),h=r.getAllProducts(),j=async()=>{T(!0),m(null);try{const l=await qe.getAll();_(l.users)}catch(l){m(l.message||"Failed to load users")}finally{T(!1)}};return v.useEffect(()=>{j()},[]),e.jsxs("div",{style:f.container,children:[e.jsxs("div",{style:{marginBottom:"1rem",padding:"0.75rem",backgroundColor:"#fef3c7",borderRadius:"var(--radius-sm)",fontSize:"0.75rem"},children:[e.jsx("strong",{children:"Current User:"})," ",(g=r.user)==null?void 0:g.email," (Role: ",(S=r.user)==null?void 0:S.roleId,")",e.jsx("br",{}),e.jsx("strong",{children:"User Role Object:"})," ",((o=r.getUserRole())==null?void 0:o.name)||"NOT FOUND",e.jsx("br",{}),e.jsx("strong",{children:"Products:"})," ",((x=(b=r.getUserRole())==null?void 0:b.products)==null?void 0:x.join(", "))||"NONE",e.jsx("br",{}),e.jsx("button",{onClick:()=>{r.resetAuthData(),window.location.reload()},style:{...f.button,...f.dangerBtn,marginTop:"0.5rem"},children:"üîÑ Reset All Auth Data"})]}),e.jsx("div",{style:f.tabs,children:["users","roles","products"].map(l=>e.jsx("button",{style:{...f.tab,...t===l?f.tabActive:{}},onClick:()=>n(l),children:l==="users"?`üë• Users (${k.length})`:l==="roles"?`üé≠ Roles (${R.length})`:`üì¶ Products (${h.length})`},l))}),t==="users"&&e.jsxs("div",{style:f.section,children:[e.jsxs("div",{style:f.sectionHeader,children:[e.jsx("span",{style:f.sectionTitle,children:"Database Users (API)"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{style:{...f.button,...f.secondaryBtn},onClick:j,children:"üîÑ Refresh"}),e.jsx("button",{style:{...f.button,...f.primaryBtn},onClick:()=>c("new"),children:"+ Add User"})]})]}),P&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#fee2e2",color:"#991b1b",borderRadius:"var(--radius-sm)",marginBottom:"0.5rem"},children:P}),C?e.jsx("div",{style:{padding:"1rem",textAlign:"center",color:"var(--color-muted)"},children:"Loading users..."}):e.jsxs("div",{style:f.card,children:[k.map(l=>{var A;const y={owner:"#7c3aed",admin:"#dc2626",beta:"#2563eb",user:"#6b7280"};return e.jsxs("div",{style:f.row,children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:500},children:l.name}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:l.email})]}),e.jsx("span",{style:{...f.badge,backgroundColor:y[l.role]||"#6b7280",color:"white"},children:l.role}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:((A=l.products)==null?void 0:A.join(", "))||"no products"}),e.jsx("button",{style:{...f.button,...f.secondaryBtn,...f.smallBtn},onClick:()=>c(l),children:"Edit"})]},l.id)}),k.length===0&&e.jsx("div",{style:{padding:"1rem",textAlign:"center",color:"var(--color-muted)"},children:"No users found"})]})]}),t==="roles"&&e.jsxs("div",{style:f.section,children:[e.jsxs("div",{style:f.sectionHeader,children:[e.jsx("span",{style:f.sectionTitle,children:"All Roles"}),e.jsx("button",{style:{...f.button,...f.primaryBtn},onClick:()=>p("new"),children:"+ Add Role"})]}),e.jsx("div",{style:f.card,children:R.map(l=>e.jsxs("div",{style:f.row,children:[e.jsx("span",{style:{...f.badge,backgroundColor:l.color,color:"white"},children:l.name}),e.jsx("div",{style:{flex:1,fontSize:"0.75rem",color:"var(--color-muted)"},children:l.description}),e.jsxs("div",{style:{fontSize:"0.75rem"},children:[l.products.length," products, ",l.additionalFeatures.length," features"]}),l.isSystem&&e.jsx("span",{style:{...f.badge,backgroundColor:"#f3f4f6",color:"#4b5563"},children:"System"}),e.jsx("button",{style:{...f.button,...f.secondaryBtn,...f.smallBtn},onClick:()=>p(l),children:"Edit"})]},l.id))})]}),t==="products"&&e.jsxs("div",{style:f.section,children:[e.jsxs("div",{style:f.sectionHeader,children:[e.jsx("span",{style:f.sectionTitle,children:"All Products"}),e.jsx("button",{style:{...f.button,...f.primaryBtn},onClick:()=>a("new"),children:"+ Add Product"})]}),e.jsx("div",{style:f.card,children:h.map(l=>e.jsxs("div",{style:f.row,children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:l.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:500,color:l.color},children:l.name}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:l.description})]}),e.jsxs("div",{style:{fontSize:"0.75rem"},children:[l.features.length," features"]}),l.isPremium&&e.jsx("span",{style:{...f.badge,backgroundColor:"#fef3c7",color:"#92400e"},children:"Premium"}),e.jsx("button",{style:{...f.button,...f.secondaryBtn,...f.smallBtn},onClick:()=>a(l),children:"Edit"})]},l.id))})]}),i&&e.jsx(ao,{user:i==="new"?null:i,onClose:()=>c(null),onSave:async l=>{try{i==="new"?await qe.create({email:l.email,password:l.password,name:l.name,role:l.role,products:l.products}):await qe.update(i.id,{name:l.name,role:l.role,products:l.products}),j()}catch(y){alert(y.message||"Failed to save user")}},onDelete:i!=="new"?async()=>{await qe.delete(i.id),j()}:void 0}),s&&e.jsx(co,{role:s==="new"?null:s,products:h,onClose:()=>p(null),onSave:l=>{s==="new"?r.createRole(l):r.updateRole(s.id,l)},onDelete:s!=="new"?()=>r.deleteRole(s.id):void 0}),u&&e.jsx(mo,{product:u==="new"?null:u,onClose:()=>a(null),onSave:l=>{u==="new"?r.createProduct(l):r.updateProduct(u.id,l)},onDelete:u!=="new"?()=>r.deleteProduct(u.id):void 0})]})}function po(){const{user:r}=Nr(),[t,n]=v.useState([]),[i,c]=v.useState(null),[s,p]=v.useState(!1),[u,a]=v.useState(""),[k,_]=v.useState(!1),[C,T]=v.useState(null),P=(r==null?void 0:r.roleId)==="admin"||(r==null?void 0:r.roleId)==="owner",m=(r==null?void 0:r.roleId)==="owner";v.useEffect(()=>{nr().then(n)},[]);const R=[...Be,...t.filter(l=>!Be.some(y=>y.id===l.id))],h=u?R.filter(l=>l.name.toLowerCase().includes(u.toLowerCase())||l.city.toLowerCase().includes(u.toLowerCase())||l.state.toLowerCase().includes(u.toLowerCase())):R,j=()=>{if(!P){T({type:"error",text:"Only admins can add tracks"});return}c({id:`custom_${Date.now()}`,name:"",city:"",state:"",country:"USA",lat:0,lon:0,elevation_ft:0,length:"1/4"}),p(!0)},g=l=>{if(!P){T({type:"error",text:"Only admins can edit tracks"});return}if(Be.some(y=>y.id===l.id)){T({type:"error",text:"Built-in tracks cannot be edited. Create a copy instead."});return}c({...l}),p(!1)},S=l=>{if(!P){T({type:"error",text:"Only admins can add tracks"});return}c({...l,id:`custom_${Date.now()}`,name:`${l.name} (Copy)`}),p(!0)},o=async()=>{if(i){if(!i.name.trim()){T({type:"error",text:"Track name is required"});return}_(!0),T(null);try{if(s){const y=await St(i);if(!y.success){T({type:"error",text:y.error||"Failed to save track"});return}}else{const y=await Rt(i.id,i);if(!y.success){T({type:"error",text:y.error||"Failed to update track"});return}}const l=await nr();n(l),c(null),p(!1),T({type:"success",text:s?"Track added successfully":"Track updated successfully"})}finally{_(!1)}}},b=async l=>{if(!m){T({type:"error",text:"Only owners can delete tracks"});return}if(Be.some(A=>A.id===l)){T({type:"error",text:"Built-in tracks cannot be deleted."});return}if(!confirm("Delete this track?"))return;_(!0);const y=await Pt(l);if(y.success){const A=await nr();n(A),T({type:"success",text:"Track deleted"})}else T({type:"error",text:y.error||"Failed to delete track"});_(!1)},x=l=>Be.some(y=>y.id===l);return e.jsxs("div",{children:[C&&e.jsx("div",{style:{padding:"10px 16px",marginBottom:"1rem",borderRadius:"6px",backgroundColor:C.type==="error"?"rgba(239, 68, 68, 0.1)":"rgba(34, 197, 94, 0.1)",color:C.type==="error"?"#ef4444":"#22c55e",border:`1px solid ${C.type==="error"?"#ef4444":"#22c55e"}`},children:C.text}),e.jsxs("div",{style:{marginBottom:"1rem",display:"flex",gap:"1rem",alignItems:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:j,className:"btn",style:{backgroundColor:P?"var(--color-primary)":"var(--color-muted)"},disabled:!P||k,children:"+ Add Track"}),e.jsx("input",{type:"text",placeholder:"Search tracks...",value:u,onChange:l=>a(l.target.value),className:"input",style:{width:"200px"}}),e.jsxs("span",{style:{color:"var(--color-muted)",fontSize:"0.85rem"},children:[h.length," tracks (",t.length," custom)"]}),!P&&e.jsx("span",{style:{color:"var(--color-muted)",fontSize:"0.8rem",fontStyle:"italic"},children:"(Admin access required to edit)"})]}),i&&e.jsxs("div",{className:"card",style:{marginBottom:"1rem",padding:"1rem"},children:[e.jsx("h4",{style:{marginBottom:"1rem"},children:s?"New Track":"Edit Track"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Track Name *"}),e.jsx("input",{type:"text",className:"input",value:i.name,onChange:l=>c({...i,name:l.target.value}),placeholder:"e.g., My Local Dragstrip"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"City"}),e.jsx("input",{type:"text",className:"input",value:i.city,onChange:l=>c({...i,city:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"State"}),e.jsx("input",{type:"text",className:"input",value:i.state,onChange:l=>c({...i,state:l.target.value}),maxLength:2,style:{width:"60px"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Latitude"}),e.jsx("input",{type:"number",className:"input",step:"0.0001",value:i.lat,onChange:l=>c({...i,lat:parseFloat(l.target.value)||0}),placeholder:"e.g., 34.0589"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Longitude"}),e.jsx("input",{type:"number",className:"input",step:"0.0001",value:i.lon,onChange:l=>c({...i,lon:parseFloat(l.target.value)||0}),placeholder:"e.g., -117.7517"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Elevation (ft)"}),e.jsx("input",{type:"number",className:"input",value:i.elevation_ft,onChange:l=>c({...i,elevation_ft:parseInt(l.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Track Angle (¬∞)"}),e.jsx("input",{type:"number",className:"input",step:"1",min:"0",max:"359",value:i.trackAngle??0,onChange:l=>c({...i,trackAngle:parseInt(l.target.value)||0}),placeholder:"0 = North"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginTop:"4px"},children:"Direction track points (0=N, 90=E, 180=S, 270=W)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Track Length"}),e.jsxs("select",{className:"input",value:i.length,onChange:l=>c({...i,length:l.target.value}),children:[e.jsx("option",{value:"1/4",children:"1/4 Mile"}),e.jsx("option",{value:"1/8",children:"1/8 Mile"}),e.jsx("option",{value:"both",children:"Both"})]})]})]}),e.jsxs("div",{style:{marginTop:"1rem",display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:o,className:"btn",style:{backgroundColor:"var(--color-primary)"},children:"Save Track"}),e.jsx("button",{onClick:()=>{c(null),p(!1)},className:"btn",children:"Cancel"})]})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.85rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"2px solid var(--color-border)"},children:[e.jsx("th",{style:{textAlign:"left",padding:"8px"},children:"Track Name"}),e.jsx("th",{style:{textAlign:"left",padding:"8px"},children:"Location"}),e.jsx("th",{style:{textAlign:"right",padding:"8px"},children:"Lat"}),e.jsx("th",{style:{textAlign:"right",padding:"8px"},children:"Lon"}),e.jsx("th",{style:{textAlign:"right",padding:"8px"},children:"Elev (ft)"}),e.jsx("th",{style:{textAlign:"right",padding:"8px"},children:"Angle"}),e.jsx("th",{style:{textAlign:"center",padding:"8px"},children:"Length"}),e.jsx("th",{style:{textAlign:"center",padding:"8px"},children:"Actions"})]})}),e.jsx("tbody",{children:h.map(l=>e.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)",backgroundColor:x(l.id)?"transparent":"rgba(34, 197, 94, 0.05)"},children:[e.jsxs("td",{style:{padding:"8px"},children:[l.name,x(l.id)&&e.jsx("span",{style:{marginLeft:"6px",fontSize:"0.7rem",color:"var(--color-muted)"},children:"(built-in)"})]}),e.jsxs("td",{style:{padding:"8px"},children:[l.city,", ",l.state]}),e.jsx("td",{style:{padding:"8px",textAlign:"right",fontFamily:"monospace"},children:l.lat.toFixed(4)}),e.jsx("td",{style:{padding:"8px",textAlign:"right",fontFamily:"monospace"},children:l.lon.toFixed(4)}),e.jsx("td",{style:{padding:"8px",textAlign:"right"},children:l.elevation_ft.toLocaleString()}),e.jsxs("td",{style:{padding:"8px",textAlign:"right"},children:[l.trackAngle??"-","¬∞"]}),e.jsx("td",{style:{padding:"8px",textAlign:"center"},children:l.length}),e.jsx("td",{style:{padding:"8px",textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"center"},children:[e.jsx("button",{onClick:()=>S(l),style:{padding:"4px 8px",fontSize:"0.75rem",border:"1px solid var(--color-border)",borderRadius:"4px",backgroundColor:"var(--color-bg-secondary)",cursor:"pointer"},title:"Copy track",children:"üìã"}),!x(l.id)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>g(l),style:{padding:"4px 8px",fontSize:"0.75rem",border:"1px solid var(--color-border)",borderRadius:"4px",backgroundColor:"var(--color-bg-secondary)",cursor:"pointer"},title:"Edit track",children:"‚úèÔ∏è"}),e.jsx("button",{onClick:()=>b(l.id),style:{padding:"4px 8px",fontSize:"0.75rem",border:"1px solid #ef4444",borderRadius:"4px",backgroundColor:"transparent",color:"#ef4444",cursor:"pointer"},title:"Delete track",children:"üóëÔ∏è"})]})]})})]},l.id))})]})}),e.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"var(--color-bg-secondary)",borderRadius:"8px",fontSize:"0.85rem"},children:[e.jsx("h4",{style:{marginBottom:"0.5rem"},children:"Track Angle"}),e.jsxs("p",{style:{color:"var(--color-muted)",margin:0},children:["The track angle is the compass direction the track points (direction cars travel down the strip). This is used to calculate the effective headwind/tailwind from the weather wind direction.",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"0¬∞"})," = North, ",e.jsx("strong",{children:"90¬∞"})," = East, ",e.jsx("strong",{children:"180¬∞"})," = South, ",e.jsx("strong",{children:"270¬∞"})," = West",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"Tip:"})," Use Google Maps to find coordinates. Right-click on the track location and copy the coordinates."]})]})]})}const je=[{id:"settings",title:"‚öôÔ∏è Settings & Flags",component:Mt,category:"core"},{id:"health-check",title:"ü©∫ Health Check",component:At,category:"core"},{id:"run-inspector",title:"‚ñ∂Ô∏è Run Inspector",component:zt,category:"simulation"},{id:"energy",title:"‚ö° Energy Accounting",component:Nt,category:"simulation"},{id:"input-inspector",title:"üîç Input Inspector",component:Ot,category:"data"},{id:"quick-paste",title:"üìã Quick Paste",component:Ut,category:"data"},{id:"air",title:"üå°Ô∏è Air Model",component:Jt,category:"data"},{id:"parity",title:"üß™ Parity Runner",component:so,category:"testing"},{id:"users",title:"üë• User Management",component:ho,category:"core"},{id:"tracks",title:"üèÅ Track Editor",component:po,category:"data"}];function go(){const[r,t]=Hr(),n=r.get("panel"),[i,c]=v.useState(()=>n&&je.some(u=>u.id===n)?n:je.length>0?je[0].id:"");v.useEffect(()=>{i&&t({panel:i},{replace:!0})},[i,t]),v.useEffect(()=>{n&&je.some(u=>u.id===n)&&c(n)},[n]);const s=je.find(u=>u.id===i),p=s==null?void 0:s.component;return e.jsx(kt,{title:"Dev Portal",children:e.jsxs("div",{style:{display:"flex",gap:"1rem",minHeight:"70vh"},children:[e.jsxs("nav",{style:{width:"200px",flexShrink:0,borderRight:"1px solid var(--color-border)",paddingRight:"1rem"},children:[e.jsx("h3",{style:{fontSize:"0.875rem",fontWeight:"600",textTransform:"uppercase",color:"var(--color-muted)",marginBottom:"1rem"},children:"Dev Panels"}),e.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:je.map(u=>e.jsx("li",{style:{marginBottom:"0.25rem"},children:e.jsx("button",{onClick:()=>c(u.id),style:{width:"100%",textAlign:"left",padding:"0.5rem 0.75rem",border:"none",background:i===u.id?"var(--color-primary)":"transparent",color:i===u.id?"white":"var(--color-text)",borderRadius:"var(--radius-sm)",cursor:"pointer",fontSize:"0.875rem",transition:"background-color 0.2s"},onMouseEnter:a=>{i!==u.id&&(a.currentTarget.style.backgroundColor="var(--color-surface)")},onMouseLeave:a=>{i!==u.id&&(a.currentTarget.style.backgroundColor="transparent")},children:u.title})},u.id))}),je.length===0&&e.jsx("p",{style:{fontSize:"0.875rem",color:"var(--color-muted)",fontStyle:"italic"},children:"No panels registered"})]}),e.jsx("div",{style:{flex:1,minWidth:0,backgroundColor:"var(--color-surface)",borderRadius:"var(--radius-md)",overflow:"auto"},children:p?e.jsx(p,{}):e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:e.jsx("p",{style:{color:"var(--color-muted)"},children:"No panel selected"})})})]})})}export{go as default};
//# sourceMappingURL=DevPortal-D__eY-iO.js.map
