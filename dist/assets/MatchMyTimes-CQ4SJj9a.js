import{r as a,g as Q,an as X,s as Z,j as e}from"./index-CNLlDnIA.js";function te({vehicle:o,env:l,raceLength:F,isOpen:D,onClose:w,onApply:L}){const[S,C]=a.useState("input"),[n,y]=a.useState([{et:0,mph:0}]),[N,E]=a.useState(!1),[_,p]=a.useState(0),[G,h]=a.useState(""),[M,T]=a.useState([]),[R,A]=a.useState(1),[H,V]=a.useState(null),[W,J]=a.useState(0),[B,O]=a.useState(0),m=a.useCallback(async t=>{try{const r=Q(t),i=X(r,F);i.env={elevation:l.elevation??0,barometerInHg:l.barometerInHg??29.92,temperatureF:l.temperatureF??75,humidityPct:l.humidityPct??50,windMph:l.windMph??0,windAngleDeg:l.windAngleDeg??0,trackTempF:l.trackTempF??100,tractionIndex:l.tractionIndex??5};const d=await Z("VB6Exact",i);return{et:d.et_s,mph:d.mph}}catch(r){return console.error("Simulation failed:",r),{et:999,mph:0}}},[l,F]),U=()=>{y([...n,{et:0,mph:0}])},Y=t=>{n.length>1&&y(n.filter((r,i)=>i!==t))},I=(t,r,i)=>{const d=[...n];d[t]={...d[t],[r]:i},y(d)},$=a.useCallback(async()=>{const t=n.filter(s=>s.et>0);if(t.length===0)return;C("tuning"),E(!0),p(0),T([]);const r=t.reduce((s,c)=>s+c.et,0)/t.length;t.reduce((s,c)=>s+c.mph,0)/t.length,O(r),h("Running baseline simulation...");const i=await m(o);p(10);const d=r-i.et,j=[];let b={...o};if(Math.abs(d)>.01){h("Tuning power output..."),p(30);let s=o.powerHP??500,c=Math.abs(d);for(let u=-50;u<=50;u+=5){const g=(o.powerHP??500)+u;if(g<50)continue;const z={...o,powerHP:g},P=await m(z),f=Math.abs(P.et-r);f<c&&(c=f,s=g)}s!==(o.powerHP??500)&&(j.push({parameter:"Horsepower",originalValue:o.powerHP??500,adjustedValue:s,unit:"HP",change:s-(o.powerHP??500),changePercent:(s-(o.powerHP??500))/(o.powerHP??500)*100}),b.powerHP=s),p(50),h("Tuning weight...");let x=o.weightLb??3e3;c=Math.abs(d);for(let u=-100;u<=100;u+=10){const g=(o.weightLb??3e3)+u;if(g<1e3)continue;const z={...b,weightLb:g},P=await m(z),f=Math.abs(P.et-r);f<c&&(c=f,x=g)}x!==(o.weightLb??3e3)&&(j.push({parameter:"Weight",originalValue:o.weightLb??3e3,adjustedValue:x,unit:"lbs",change:x-(o.weightLb??3e3),changePercent:(x-(o.weightLb??3e3))/(o.weightLb??3e3)*100}),b.weightLb=x),p(70)}h("Calculating calibration factor...");const k=await m(b),v=r/k.et;p(90),Math.abs(k.et-r)>.02&&j.push({parameter:"Calibration Factor",originalValue:1,adjustedValue:v,unit:"",change:v-1,changePercent:(v-1)*100}),p(100),h("Complete!"),T(j),A(v),V(b),J(k.et),E(!1),C("results")},[n,o,m]),q=()=>{H&&(L(H,R),w())},K=()=>{C("input"),y([{et:0,mph:0}]),T([]),A(1),V(null)};return D?e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:w,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.6)",zIndex:1e3}}),e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"var(--color-bg)",borderRadius:"12px",boxShadow:"0 20px 60px rgba(0,0,0,0.4)",zIndex:1001,width:"550px",maxWidth:"95vw",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--color-border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"var(--color-text)"},children:"ðŸŽ¯ Match My Times"}),e.jsx("button",{onClick:w,style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",color:"var(--color-text-muted)",padding:"0 4px"},children:"Ã—"})]}),e.jsxs("div",{style:{padding:"20px"},children:[S==="input"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--color-text-muted)",marginBottom:"20px"},children:"Enter your actual run times. RSA will automatically adjust your vehicle specs to match your real-world performance."}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 40px",gap:"8px",marginBottom:"8px",fontSize:"0.8rem",fontWeight:600,color:"var(--color-text-muted)"},children:[e.jsx("div",{children:"ET (seconds)"}),e.jsx("div",{children:"MPH"}),e.jsx("div",{})]}),n.map((t,r)=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 40px",gap:"8px",marginBottom:"8px"},children:[e.jsx("input",{type:"number",step:"0.001",value:t.et||"",onChange:i=>I(r,"et",parseFloat(i.target.value)||0),placeholder:"e.g., 11.234",style:{padding:"10px",borderRadius:"6px",border:"1px solid var(--color-border)",backgroundColor:"var(--color-bg)",color:"var(--color-text)",fontSize:"0.95rem"}}),e.jsx("input",{type:"number",step:"0.1",value:t.mph||"",onChange:i=>I(r,"mph",parseFloat(i.target.value)||0),placeholder:"e.g., 118.5",style:{padding:"10px",borderRadius:"6px",border:"1px solid var(--color-border)",backgroundColor:"var(--color-bg)",color:"var(--color-text)",fontSize:"0.95rem"}}),e.jsx("button",{onClick:()=>Y(r),disabled:n.length===1,style:{padding:"10px",borderRadius:"6px",border:"1px solid var(--color-border)",backgroundColor:"transparent",color:n.length===1?"var(--color-border)":"#ef4444",cursor:n.length===1?"not-allowed":"pointer",fontSize:"1rem"},children:"Ã—"})]},r)),e.jsx("button",{onClick:U,style:{padding:"8px 16px",borderRadius:"6px",border:"1px dashed var(--color-border)",backgroundColor:"transparent",color:"var(--color-text-muted)",cursor:"pointer",fontSize:"0.85rem",width:"100%"},children:"+ Add Another Run"})]}),e.jsxs("div",{style:{padding:"12px",backgroundColor:"rgba(59, 130, 246, 0.1)",borderRadius:"8px",marginBottom:"20px",fontSize:"0.85rem",color:"var(--color-text-muted)"},children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Enter 3-5 runs from similar conditions for best results. Make sure the weather settings above match the conditions when you made these runs."]}),e.jsx("button",{onClick:$,disabled:!n.some(t=>t.et>0),style:{width:"100%",padding:"14px",borderRadius:"8px",border:"none",backgroundColor:n.some(t=>t.et>0)?"#22c55e":"var(--color-border)",color:"white",fontSize:"1rem",fontWeight:600,cursor:n.some(t=>t.et>0)?"pointer":"not-allowed"},children:"Tune My Vehicle"})]}),S==="tuning"&&e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx("div",{style:{fontSize:"1.1rem",marginBottom:"16px"},children:N?"Tuning your vehicle...":"Complete!"}),e.jsx("div",{style:{width:"100%",height:"10px",backgroundColor:"var(--color-bg-secondary)",borderRadius:"5px",overflow:"hidden",marginBottom:"12px"},children:e.jsx("div",{style:{width:`${_}%`,height:"100%",backgroundColor:"#22c55e",transition:"width 0.3s ease"}})}),e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--color-text-muted)"},children:G})]}),S==="results"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"16px",backgroundColor:"rgba(34, 197, 94, 0.1)",borderRadius:"8px",marginBottom:"20px",border:"1px solid rgba(34, 197, 94, 0.3)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#22c55e",fontWeight:600},children:"TARGET ET"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:700},children:[B.toFixed(3),"s"]})]}),e.jsx("div",{style:{fontSize:"1.5rem"},children:"â†’"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.8rem",color:"#22c55e",fontWeight:600},children:"PREDICTED ET"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:700},children:[(W*R).toFixed(3),"s"]})]})]}),e.jsxs("div",{style:{marginTop:"8px",fontSize:"0.85rem",color:"var(--color-text-muted)",textAlign:"center"},children:["Difference: ",Math.abs(B-W*R).toFixed(3),"s"]})]}),M.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:"0.8rem",fontWeight:600,marginBottom:"12px",color:"var(--color-text-muted)"},children:"RECOMMENDED ADJUSTMENTS"}),M.map((t,r)=>e.jsxs("div",{style:{padding:"12px",backgroundColor:"var(--color-surface)",borderRadius:"8px",marginBottom:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,fontSize:"0.95rem"},children:t.parameter}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--color-text-muted)"},children:[t.originalValue.toFixed(1)," â†’ ",t.adjustedValue.toFixed(1)," ",t.unit]})]}),e.jsxs("div",{style:{padding:"4px 10px",borderRadius:"4px",backgroundColor:t.change>0?"rgba(34, 197, 94, 0.2)":"rgba(239, 68, 68, 0.2)",color:t.change>0?"#22c55e":"#ef4444",fontWeight:600,fontSize:"0.85rem"},children:[t.change>0?"+":"",t.changePercent.toFixed(1),"%"]})]},r))]}):e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--color-text-muted)",fontSize:"0.9rem"},children:"Your vehicle specs are already well-calibrated! No significant adjustments needed."}),e.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"20px"},children:[e.jsx("button",{onClick:q,style:{flex:1,padding:"12px",borderRadius:"8px",border:"none",backgroundColor:"#22c55e",color:"white",fontWeight:600,cursor:"pointer"},children:"Apply Changes"}),e.jsx("button",{onClick:K,style:{flex:1,padding:"12px",borderRadius:"8px",border:"1px solid var(--color-border)",backgroundColor:"transparent",color:"var(--color-text)",cursor:"pointer"},children:"Try Again"})]})]})]})]})]}):null}export{te as default};
//# sourceMappingURL=MatchMyTimes-CQ4SJj9a.js.map
