{"version":3,"file":"VehicleEditorPopup-cyv7iTaN.js","sources":["../../src/shared/components/VehicleEditorPopup.tsx"],"sourcesContent":["/**\r\n * VehicleEditorPopup - Popup modal for editing vehicle settings in ET Sim\r\n * \r\n * Allows quick adjustments to vehicle specs without leaving the simulation page.\r\n * Changes can be applied temporarily (for what-if) or saved permanently.\r\n */\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport VehicleEditorPanel from './VehicleEditorPanel';\r\nimport type { Vehicle } from '../../domain/schemas/vehicle.schema';\r\nimport { saveVehicle } from '../../state/vehicles';\r\n\r\ninterface VehicleEditorPopupProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  vehicle: Vehicle | null;\r\n  onApply: (vehicle: Vehicle) => void; // Apply changes (temporary or permanent)\r\n  isPro?: boolean;\r\n}\r\n\r\nexport default function VehicleEditorPopup({\r\n  isOpen,\r\n  onClose,\r\n  vehicle,\r\n  onApply,\r\n  isPro = false,\r\n}: VehicleEditorPopupProps) {\r\n  const [editedVehicle, setEditedVehicle] = useState<Partial<Vehicle>>({});\r\n  const [saving, setSaving] = useState(false);\r\n  const [hasChanges, setHasChanges] = useState(false);\r\n\r\n  // Initialize edited vehicle when popup opens\r\n  useEffect(() => {\r\n    if (isOpen && vehicle) {\r\n      setEditedVehicle({ ...vehicle });\r\n      setHasChanges(false);\r\n    }\r\n  }, [isOpen, vehicle]);\r\n\r\n  // Handle changes from the editor panel\r\n  const handleChange = (updated: Partial<Vehicle>) => {\r\n    setEditedVehicle(updated);\r\n    setHasChanges(true);\r\n  };\r\n\r\n  // Apply changes temporarily (just update the sim)\r\n  const handleApplyTemp = () => {\r\n    if (editedVehicle && vehicle) {\r\n      onApply({ ...vehicle, ...editedVehicle } as Vehicle);\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  // Save changes permanently\r\n  const handleSave = async () => {\r\n    if (!editedVehicle || !vehicle) return;\r\n    \r\n    setSaving(true);\r\n    try {\r\n      const updatedVehicle = { ...vehicle, ...editedVehicle } as Vehicle;\r\n      await saveVehicle(updatedVehicle);\r\n      onApply(updatedVehicle);\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Failed to save vehicle:', error);\r\n      alert('Failed to save vehicle. Please try again.');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  // Handle escape key\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    \r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onClose();\r\n      }\r\n    };\r\n    \r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [isOpen, onClose]);\r\n\r\n  if (!isOpen || !vehicle) return null;\r\n\r\n  return (\r\n    <>\r\n      {/* Backdrop */}\r\n      <div\r\n        onClick={onClose}\r\n        style={{\r\n          position: 'fixed',\r\n          top: 0,\r\n          left: 0,\r\n          right: 0,\r\n          bottom: 0,\r\n          backgroundColor: 'rgba(0, 0, 0, 0.6)',\r\n          zIndex: 1000,\r\n        }}\r\n      />\r\n\r\n      {/* Modal */}\r\n      <div style={{\r\n        position: 'fixed',\r\n        top: '50%',\r\n        left: '50%',\r\n        transform: 'translate(-50%, -50%)',\r\n        backgroundColor: 'var(--color-bg)',\r\n        borderRadius: '12px',\r\n        boxShadow: '0 20px 60px rgba(0,0,0,0.5)',\r\n        zIndex: 1001,\r\n        width: '500px',\r\n        maxWidth: '95vw',\r\n        maxHeight: '90vh',\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n      }}>\r\n        {/* Header */}\r\n        <div style={{\r\n          padding: '14px 18px',\r\n          borderBottom: '1px solid var(--color-border)',\r\n          display: 'flex',\r\n          justifyContent: 'space-between',\r\n          alignItems: 'center',\r\n          flexShrink: 0,\r\n        }}>\r\n          <div>\r\n            <h3 style={{ margin: 0, fontSize: '1.1rem', color: 'var(--color-text)' }}>\r\n              ⚙️ Edit Vehicle\r\n            </h3>\r\n            <div style={{ fontSize: '0.8rem', color: 'var(--color-text-muted)' }}>\r\n              {vehicle.name}\r\n            </div>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            style={{\r\n              background: 'none',\r\n              border: 'none',\r\n              fontSize: '1.5rem',\r\n              cursor: 'pointer',\r\n              color: 'var(--color-text-muted)',\r\n              padding: '0 4px',\r\n            }}\r\n          >\r\n            ×\r\n          </button>\r\n        </div>\r\n\r\n        {/* Content - scrollable */}\r\n        <div style={{\r\n          padding: '16px',\r\n          overflowY: 'auto',\r\n          flex: 1,\r\n        }}>\r\n          <VehicleEditorPanel\r\n            vehicle={editedVehicle}\r\n            onChange={handleChange}\r\n            isPro={isPro}\r\n            compact={true}\r\n            showName={false}\r\n          />\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div style={{\r\n          padding: '12px 18px',\r\n          borderTop: '1px solid var(--color-border)',\r\n          display: 'flex',\r\n          justifyContent: 'space-between',\r\n          alignItems: 'center',\r\n          flexShrink: 0,\r\n          backgroundColor: 'var(--color-surface)',\r\n        }}>\r\n          <div style={{ fontSize: '0.75rem', color: 'var(--color-text-muted)' }}>\r\n            {hasChanges ? '• Unsaved changes' : 'No changes'}\r\n          </div>\r\n          <div style={{ display: 'flex', gap: '8px' }}>\r\n            <button\r\n              onClick={onClose}\r\n              style={{\r\n                padding: '8px 16px',\r\n                borderRadius: '6px',\r\n                border: '1px solid var(--color-border)',\r\n                backgroundColor: 'transparent',\r\n                color: 'var(--color-text)',\r\n                cursor: 'pointer',\r\n                fontSize: '0.85rem',\r\n              }}\r\n            >\r\n              Cancel\r\n            </button>\r\n            <button\r\n              onClick={handleApplyTemp}\r\n              disabled={!hasChanges}\r\n              style={{\r\n                padding: '8px 16px',\r\n                borderRadius: '6px',\r\n                border: '1px solid var(--color-accent)',\r\n                backgroundColor: 'transparent',\r\n                color: 'var(--color-accent)',\r\n                cursor: hasChanges ? 'pointer' : 'not-allowed',\r\n                opacity: hasChanges ? 1 : 0.5,\r\n                fontSize: '0.85rem',\r\n              }}\r\n              title=\"Apply changes for this session only\"\r\n            >\r\n              Apply\r\n            </button>\r\n            <button\r\n              onClick={handleSave}\r\n              disabled={!hasChanges || saving}\r\n              style={{\r\n                padding: '8px 16px',\r\n                borderRadius: '6px',\r\n                border: 'none',\r\n                backgroundColor: hasChanges ? 'var(--color-accent)' : 'var(--color-border)',\r\n                color: 'white',\r\n                cursor: hasChanges && !saving ? 'pointer' : 'not-allowed',\r\n                fontSize: '0.85rem',\r\n                fontWeight: 500,\r\n              }}\r\n              title=\"Save changes permanently\"\r\n            >\r\n              {saving ? 'Saving...' : 'Save'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n"],"names":["VehicleEditorPopup","isOpen","onClose","vehicle","onApply","isPro","editedVehicle","setEditedVehicle","useState","saving","setSaving","hasChanges","setHasChanges","useEffect","handleChange","updated","handleApplyTemp","handleSave","updatedVehicle","saveVehicle","error","handleKeyDown","e","jsxs","Fragment","jsx","VehicleEditorPanel"],"mappings":"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"}