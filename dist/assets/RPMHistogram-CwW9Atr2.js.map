{"version":3,"file":"RPMHistogram-CwW9Atr2.js","sources":["../../node_modules/recharts/es6/chart/BarChart.js","../../src/shared/components/charts/RPMHistogram.tsx"],"sourcesContent":["/**\n * @fileOverview Bar Chart\n */\nimport { generateCategoricalChart } from './generateCategoricalChart';\nimport { Bar } from '../cartesian/Bar';\nimport { XAxis } from '../cartesian/XAxis';\nimport { YAxis } from '../cartesian/YAxis';\nimport { formatAxisMap } from '../util/CartesianUtils';\nexport var BarChart = generateCategoricalChart({\n  chartName: 'BarChart',\n  GraphicalChild: Bar,\n  defaultTooltipEventType: 'axis',\n  validateTooltipEventTypes: ['axis', 'item'],\n  axisComponents: [{\n    axisType: 'xAxis',\n    AxisComp: XAxis\n  }, {\n    axisType: 'yAxis',\n    AxisComp: YAxis\n  }],\n  formatAxisMap: formatAxisMap\n});","import { useMemo } from 'react';\nimport {\n  ResponsiveContainer,\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Cell,\n} from 'recharts';\n\ninterface RPMHistogramProps {\n  /** Trace data with rpm values */\n  data: { rpm: number; t_s: number }[];\n  /** Target number of bins (will adjust based on data range) */\n  targetBins?: number;\n  /** Compact mode for dashboard layout */\n  compact?: boolean;\n}\n\n/**\n * RPM Histogram - shows time spent at each RPM range\n */\nfunction RPMHistogram({ data, targetBins = 15, compact = false }: RPMHistogramProps) {\n  const histogramData = useMemo(() => {\n    if (!data || data.length < 2) return [];\n\n    // Find RPM range\n    const rpms = data.map(d => d.rpm).filter(r => r > 0);\n    if (rpms.length === 0) return [];\n    \n    const minRPM = Math.min(...rpms);\n    const maxRPM = Math.max(...rpms);\n    const range = maxRPM - minRPM;\n    \n    // Calculate bin size - aim for targetBins, round to nice numbers\n    let binSize: number;\n    const rawBinSize = range / targetBins;\n    if (rawBinSize <= 100) binSize = 100;\n    else if (rawBinSize <= 250) binSize = 250;\n    else if (rawBinSize <= 500) binSize = 500;\n    else binSize = Math.ceil(rawBinSize / 500) * 500;\n    \n    // Round min/max to bin boundaries\n    const binMin = Math.floor(minRPM / binSize) * binSize;\n    const binMax = Math.ceil(maxRPM / binSize) * binSize;\n    \n    // Create bins\n    const histogram: { rpmRange: string; rpmMin: number; rpmMax: number; timeSpent: number }[] = [];\n    for (let rpm = binMin; rpm < binMax; rpm += binSize) {\n      histogram.push({\n        rpmRange: `${rpm}`,\n        rpmMin: rpm,\n        rpmMax: rpm + binSize,\n        timeSpent: 0,\n      });\n    }\n    \n    // Calculate time spent in each bin\n    for (let i = 1; i < data.length; i++) {\n      const dt = data[i].t_s - data[i - 1].t_s;\n      if (dt <= 0) continue;\n      const rpm = data[i].rpm;\n      \n      const bin = histogram.find(b => rpm >= b.rpmMin && rpm < b.rpmMax);\n      if (bin) {\n        bin.timeSpent += dt;\n      }\n    }\n    \n    // Filter out empty bins\n    return histogram.filter(b => b.timeSpent > 0.001);\n  }, [data, targetBins]);\n\n  if (!histogramData || histogramData.length === 0) {\n    return (\n      <div className=\"text-center text-muted\" style={{ padding: 'var(--space-6)' }}>\n        No RPM data available\n      </div>\n    );\n  }\n\n  // Color gradient from green (low RPM) to yellow to red (high RPM)\n  const getBarColor = (index: number, total: number) => {\n    const ratio = index / (total - 1 || 1);\n    // Green -> Yellow -> Red gradient\n    if (ratio < 0.5) {\n      // Green to Yellow\n      const r = Math.round(34 + (234 - 34) * (ratio * 2));\n      const g = Math.round(197 + (179 - 197) * (ratio * 2));\n      const b = Math.round(94 + (8 - 94) * (ratio * 2));\n      return `rgb(${r}, ${g}, ${b})`;\n    } else {\n      // Yellow to Red\n      const r = Math.round(234 + (239 - 234) * ((ratio - 0.5) * 2));\n      const g = Math.round(179 - 179 * ((ratio - 0.5) * 2));\n      const b = Math.round(8 + (68 - 8) * ((ratio - 0.5) * 2));\n      return `rgb(${r}, ${g}, ${b})`;\n    }\n  };\n\n  return (\n    <ResponsiveContainer width=\"100%\" height=\"100%\">\n      <BarChart data={histogramData} margin={compact ? { top: 4, right: 8, left: 35, bottom: 20 } : { top: 5, right: 20, left: 0, bottom: 25 }}>\n        <CartesianGrid strokeDasharray=\"3 3\" stroke=\"var(--color-border)\" opacity={0.3} />\n        <XAxis\n          dataKey=\"rpmRange\"\n          stroke=\"var(--color-text-muted)\"\n          tick={{ fontSize: compact ? 8 : 9, fill: 'var(--color-text-muted)' }}\n          interval={compact ? 'preserveStartEnd' : 0}\n          angle={compact ? 0 : -45}\n          textAnchor={compact ? 'middle' : 'end'}\n          height={compact ? 20 : 50}\n          label={compact ? undefined : { \n            value: 'Engine RPM', \n            position: 'insideBottom', \n            offset: -5,\n            fontSize: 10,\n            fill: 'var(--color-text-muted)',\n          }}\n        />\n        <YAxis\n          stroke=\"var(--color-text-muted)\"\n          tick={{ fontSize: compact ? 8 : 9, fill: 'var(--color-text-muted)' }}\n          tickFormatter={(v) => `${v.toFixed(1)}s`}\n          width={compact ? 32 : 40}\n        />\n        <Tooltip\n          contentStyle={{\n            backgroundColor: 'var(--color-bg)',\n            border: '1px solid var(--color-border)',\n            borderRadius: 'var(--radius-sm)',\n            color: 'var(--color-text)',\n            fontSize: '0.75rem',\n          }}\n          formatter={(value: number) => [`${value.toFixed(2)}s`, 'Time']}\n          labelFormatter={(_label: string, payload: any[]) => {\n            if (payload && payload[0]) {\n              const item = payload[0].payload;\n              return `${item.rpmMin} - ${item.rpmMax} RPM`;\n            }\n            return '';\n          }}\n        />\n        <Bar dataKey=\"timeSpent\" radius={[3, 3, 0, 0]}>\n          {histogramData.map((_, index) => (\n            <Cell key={`cell-${index}`} fill={getBarColor(index, histogramData.length)} />\n          ))}\n        </Bar>\n      </BarChart>\n    </ResponsiveContainer>\n  );\n}\n\nexport default RPMHistogram;"],"names":["BarChart","generateCategoricalChart","Bar","XAxis","YAxis","formatAxisMap","RPMHistogram","data","targetBins","compact","histogramData","useMemo","rpms","d","r","minRPM","maxRPM","range","binSize","rawBinSize","binMin","binMax","histogram","rpm","i","dt","bin","b","jsx","getBarColor","index","total","ratio","g","ResponsiveContainer","jsxs","CartesianGrid","v","Tooltip","value","_label","payload","item","_","Cell"],"mappings":"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","x_google_ignoreList":[0]}