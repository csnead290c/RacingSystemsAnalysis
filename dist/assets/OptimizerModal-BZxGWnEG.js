import{r as o,g as X,an as Y,s as Z,j as e}from"./index-CSRxrVsw.js";function te({vehicle:r,env:m,raceLength:w,isOpen:J,onClose:f,onApplyToSession:I,onSaveToVehicle:v}){var N;const[z,P]=o.useState(!1),[,O]=o.useState(null),[B,C]=o.useState(0),[K,b]=o.useState(""),[R,G]=o.useState([]),[k,A]=o.useState([]),[s,W]=o.useState(null),[c,E]=o.useState(null),[y,$]=o.useState(!1),[V,D]=o.useState(!1),j=o.useCallback(async t=>{try{const i=X(t),d=Y(i,w);d.env={elevation:m.elevation??0,barometerInHg:m.barometerInHg??29.92,temperatureF:m.temperatureF??75,humidityPct:m.humidityPct??50,windMph:m.windMph??0,windAngleDeg:m.windAngleDeg??0,trackTempF:m.trackTempF??100,tractionIndex:m.tractionIndex??5};const n=await Z("VB6Exact",d);return{et:n.et_s,mph:n.mph}}catch(i){return console.error("Simulation failed:",i),{et:999,mph:0}}},[m,w]),M=o.useCallback(()=>{O(null),C(0),b(""),G([]),A([]),W(null),E(null),D(!1)},[]),H=o.useCallback(async()=>{const t=r.rearGear??3.73,i=Math.max(2,t-2),d=Math.min(6,t+2),n=.05,p=[],g=Math.ceil((d-i)/n);let u=0;for(let x=i;x<=d;x+=n){const l={...r,rearGear:x},h=await j(l);p.push({value:x,et:h.et,mph:h.mph}),u++,C(Math.round(u/g*50)),b(`Testing gear ratio ${x.toFixed(2)}...`)}const a=p.reduce((x,l)=>x.et<l.et?x:l);return G(p),W(a),a},[r,j]),L=o.useCallback(async t=>{const i=t||r;if(i.transmissionType!=="converter")return null;const d=1500,n=6e3,p=200,g=[],u=Math.ceil((n-d)/p);let a=0;for(let l=d;l<=n;l+=p){const h={...i,converterStallRPM:l},_=await j(h);g.push({value:l,et:_.et,mph:_.mph}),a++,C(50+Math.round(a/u*50)),b(`Testing stall speed ${l} RPM...`)}const x=g.reduce((l,h)=>l.et<h.et?l:h);return A(g),E(x),x},[r,j]),T=o.useCallback(async t=>{M(),P(!0),O(t);try{if((t==="gear"||t==="both")&&await H(),(t==="converter"||t==="both")&&r.transmissionType==="converter"){const i=t==="both"&&s?{...r,rearGear:s.value}:r;await L(i)}}finally{P(!1),b("")}},[M,H,L,r,s]),S=o.useCallback(()=>{let t={...r};return s&&(t.rearGear=s.value),c&&(t.converterStallRPM=c.value),t},[r,s,c]),Q=o.useCallback(()=>{I(S()),f()},[S,I,f]),U=o.useCallback(async()=>{if(v){$(!0);try{await v(S()),D(!0),setTimeout(()=>{f()},1e3)}catch(t){console.error("Failed to save vehicle:",t),alert("Failed to save vehicle")}finally{$(!1)}}},[S,v,f]);if(!J)return null;const q=s||c,F=r.transmissionType==="converter";return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:f,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.6)",zIndex:1e3}}),e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"var(--color-bg)",borderRadius:"12px",boxShadow:"0 20px 60px rgba(0,0,0,0.4)",zIndex:1001,width:"500px",maxWidth:"95vw",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--color-border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"var(--color-text)"},children:"âš¡ Performance Optimizer"}),e.jsx("button",{onClick:f,style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",color:"var(--color-text-muted)",padding:"0 4px"},children:"Ã—"})]}),e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{style:{padding:"12px",backgroundColor:"var(--color-bg-secondary)",borderRadius:"8px",marginBottom:"16px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:600,color:"var(--color-text)",marginBottom:"4px"},children:r.name}),e.jsxs("div",{style:{color:"var(--color-text-muted)",fontSize:"0.8rem"},children:["Current: ",((N=r.rearGear)==null?void 0:N.toFixed(2))??"3.73"," gear ratio",F&&` â€¢ ${r.converterStallRPM??3e3} RPM stall`]})]}),!z&&!q&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[e.jsxs("button",{onClick:()=>T("gear"),style:{padding:"14px 16px",fontSize:"0.9rem",borderRadius:"8px",border:"2px solid var(--color-accent)",backgroundColor:"rgba(59, 130, 246, 0.1)",color:"var(--color-accent)",cursor:"pointer",fontWeight:600,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{style:{fontSize:"1.2rem"},children:"ðŸŽ¯"}),e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("div",{children:"Optimize Gear Ratio"}),e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:400,opacity:.8},children:"Find the best final drive ratio for quickest ET"})]})]}),F&&e.jsxs("button",{onClick:()=>T("converter"),style:{padding:"14px 16px",fontSize:"0.9rem",borderRadius:"8px",border:"2px solid #f59e0b",backgroundColor:"rgba(245, 158, 11, 0.1)",color:"#f59e0b",cursor:"pointer",fontWeight:600,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{style:{fontSize:"1.2rem"},children:"ðŸ”„"}),e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("div",{children:"Optimize Converter Stall"}),e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:400,opacity:.8},children:"Find the best stall speed for quickest ET"})]})]}),F&&e.jsxs("button",{onClick:()=>T("both"),style:{padding:"14px 16px",fontSize:"0.9rem",borderRadius:"8px",border:"2px solid #22c55e",backgroundColor:"rgba(34, 197, 94, 0.1)",color:"#22c55e",cursor:"pointer",fontWeight:600,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("span",{style:{fontSize:"1.2rem"},children:"ðŸš€"}),e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("div",{children:"Optimize Both"}),e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:400,opacity:.8},children:"Find best gear ratio AND converter stall together"})]})]})]}),z&&e.jsxs("div",{style:{textAlign:"center",padding:"30px 0"},children:[e.jsx("div",{style:{fontSize:"1rem",marginBottom:"12px",color:"var(--color-text)"},children:"Optimizing..."}),e.jsx("div",{style:{width:"100%",height:"10px",backgroundColor:"var(--color-bg-secondary)",borderRadius:"5px",overflow:"hidden",marginBottom:"8px"},children:e.jsx("div",{style:{width:`${B}%`,height:"100%",backgroundColor:"var(--color-accent)",transition:"width 0.2s ease"}})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--color-text-muted)"},children:K||`${B}% complete`})]}),q&&!z&&e.jsxs("div",{children:[s&&e.jsxs("div",{style:{padding:"16px",backgroundColor:"rgba(59, 130, 246, 0.1)",borderRadius:"8px",marginBottom:"12px",border:"1px solid rgba(59, 130, 246, 0.3)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-accent)",fontWeight:600,marginBottom:"4px"},children:"OPTIMAL GEAR RATIO"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--color-text)"},children:s.value.toFixed(2)}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--color-text-muted)",marginTop:"4px"},children:["ET: ",s.et.toFixed(3),"s @ ",s.mph.toFixed(1)," mph"]})]}),e.jsxs("div",{style:{textAlign:"right",fontSize:"0.8rem"},children:[e.jsxs("div",{style:{color:"var(--color-text-muted)"},children:["Current: ",(r.rearGear??3.73).toFixed(2)]}),e.jsxs("div",{style:{color:s.value!==(r.rearGear??3.73)?"#22c55e":"var(--color-text-muted)",fontWeight:600},children:[s.value-(r.rearGear??3.73)>=0?"+":"",(s.value-(r.rearGear??3.73)).toFixed(2)]})]})]}),e.jsx("div",{style:{marginTop:"12px"},children:e.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:"1px",height:"30px"},children:R.map((t,i)=>{const d=Math.min(...R.map(a=>a.et)),n=Math.max(...R.map(a=>a.et)),p=n-d||.1,g=(n-t.et)/p*100,u=t.value===s.value;return e.jsx("div",{style:{flex:1,height:`${Math.max(5,g)}%`,backgroundColor:u?"#22c55e":"var(--color-accent)",opacity:u?1:.3},title:`${t.value.toFixed(2)}: ${t.et.toFixed(3)}s`},i)})})})]}),c&&e.jsxs("div",{style:{padding:"16px",backgroundColor:"rgba(245, 158, 11, 0.1)",borderRadius:"8px",marginBottom:"12px",border:"1px solid rgba(245, 158, 11, 0.3)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#f59e0b",fontWeight:600,marginBottom:"4px"},children:"OPTIMAL CONVERTER STALL"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--color-text)"},children:[c.value.toFixed(0)," RPM"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--color-text-muted)",marginTop:"4px"},children:["ET: ",c.et.toFixed(3),"s @ ",c.mph.toFixed(1)," mph"]})]}),e.jsxs("div",{style:{textAlign:"right",fontSize:"0.8rem"},children:[e.jsxs("div",{style:{color:"var(--color-text-muted)"},children:["Current: ",r.converterStallRPM??3e3," RPM"]}),e.jsxs("div",{style:{color:c.value!==(r.converterStallRPM??3e3)?"#22c55e":"var(--color-text-muted)",fontWeight:600},children:[c.value-(r.converterStallRPM??3e3)>=0?"+":"",(c.value-(r.converterStallRPM??3e3)).toFixed(0)," RPM"]})]})]}),e.jsx("div",{style:{marginTop:"12px"},children:e.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:"1px",height:"30px"},children:k.map((t,i)=>{const d=Math.min(...k.map(a=>a.et)),n=Math.max(...k.map(a=>a.et)),p=n-d||.1,g=(n-t.et)/p*100,u=t.value===c.value;return e.jsx("div",{style:{flex:1,height:`${Math.max(5,g)}%`,backgroundColor:u?"#22c55e":"#f59e0b",opacity:u?1:.3},title:`${t.value} RPM: ${t.et.toFixed(3)}s`},i)})})})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"16px"},children:[e.jsx("button",{onClick:Q,style:{flex:1,padding:"12px 16px",fontSize:"0.9rem",borderRadius:"8px",border:"none",backgroundColor:"var(--color-accent)",color:"white",cursor:"pointer",fontWeight:600},children:"Apply to Session"}),v&&e.jsx("button",{onClick:U,disabled:y,style:{flex:1,padding:"12px 16px",fontSize:"0.9rem",borderRadius:"8px",border:"none",backgroundColor:"#22c55e",color:"white",cursor:y?"wait":"pointer",fontWeight:600,opacity:y?.7:1},children:V?"âœ“ Saved!":y?"Saving...":"Save to Vehicle"})]}),e.jsx("button",{onClick:M,style:{width:"100%",marginTop:"10px",padding:"10px 16px",fontSize:"0.85rem",borderRadius:"8px",border:"1px solid var(--color-border)",backgroundColor:"transparent",color:"var(--color-text-muted)",cursor:"pointer"},children:"Run Another Optimization"})]})]})]})]})}function re({onClick:r}){return e.jsxs("button",{onClick:r,style:{padding:"6px 12px",fontSize:"0.75rem",borderRadius:"4px",border:"1px solid var(--color-accent)",backgroundColor:"rgba(59, 130, 246, 0.1)",color:"var(--color-accent)",cursor:"pointer",fontWeight:500,display:"flex",alignItems:"center",gap:"6px"},title:"Open Performance Optimizer",children:[e.jsx("span",{children:"âš¡"}),e.jsx("span",{children:"Optimize"})]})}export{re as OptimizerButton,te as default};
//# sourceMappingURL=OptimizerModal-BZxGWnEG.js.map
