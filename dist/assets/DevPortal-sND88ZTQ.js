import{u as Xr,a as Kr,b as Er,r as v,j as e,c as we,s as ar,d as wr,e as Mr,f as Ar,g as Yr,v as Zr,h as Qe,V as Xe,i as Ir,k as Fr,R as jr,W as tr,T as or,P as Sr,l as et,m as Rr,B as rt,n as J,Z as $e,o as Le,J as Ue,p as Oe,A as be,C as Br,q as Hr,t as tt,w as ot,F as it,x as nt,K as st,y as lt,z as at,D as dt,E as ct,G as mt,H as Pr,I as kr,L as Lr,M as ht,N as pt,O as ut,Q as gt,S as ft,U as Ee,X as bt,Y as xt,_ as ir,$ as vt,a0 as yt,a1 as _t,a2 as Dr,a3 as qe,a4 as zr,a5 as nr,a6 as Be,a7 as jt,a8 as St,a9 as Rt,aa as Pt}from"./index-DT33Kt76.js";const Ke=["quarterJr","quarterPro","admin"],sr={quarterJr:"Quarter Jr",quarterPro:"Quarter Pro",admin:"Admin / Developer"},kt={quarterJr:"Basic mode - enter peak HP and RPM, other parameters are calculated automatically",quarterPro:"Full mode - enter complete HP curve and all vehicle parameters",admin:"Developer mode - all features plus dev tools and diagnostics"};function Ct(r,t){const i=Ke.indexOf(r),n=Ke.indexOf(t);return i>=n}function Tt(r){return Ct(r,"quarterPro")}const ge={engine:["peakHP","rpmAtPeakHP","displacement_cid","fuelSystem"],vehicle:["weight_lb","wheelbase_in","tireDia_in","tireWidth_in","rollout_in","bodyStyle"],drivetrain:["gearRatios","finalDrive","shiftRPM","isConverter","slipStallRPM","converterDia_in"],environment:["elevation_ft","barometer_inHg","temperature_F","relHumidity_pct","trackTemp_F","tractionIndex","wind_mph","wind_angle_deg"]},He={engine:["hpCurve","hpTorqueMultiplier"],vehicle:["staticFrontWeight_lb","cgHeight_in","overhang_in"],drivetrain:["perGearEff","shiftsRPM","launchRPM","slippage","torqueMult","lockup"],aero:["frontalArea_ft2","Cd","Cl"],pmi:["engine_flywheel_clutch","transmission_driveshaft","tires_wheels_ringgear"]};function Et(r){return Tt(r)?{engine:[...ge.engine,...He.engine],vehicle:[...ge.vehicle,...He.vehicle],drivetrain:[...ge.drivetrain,...He.drivetrain],environment:[...ge.environment],aero:[...He.aero],pmi:[...He.pmi]}:{engine:ge.engine,vehicle:ge.vehicle,drivetrain:ge.drivetrain,environment:ge.environment,aero:[],pmi:[]}}function wt(){const r=Xr(),t=Kr(),{setFlag:i,setUserLevel:n,resetFlags:m}=Er(),s=Et(t),[p,u]=v.useState([]),[d,P]=v.useState(""),[k,T]=v.useState(!0),[C,R]=v.useState(!1),a=v.useRef(null);v.useEffect(()=>{const g=console.log,S=console.warn,o=console.error,b=(x,...l)=>{const _=new Date().toISOString().split("T")[1].slice(0,12),A=l.map(N=>typeof N=="object"?JSON.stringify(N):String(N)).join(" "),I=`[${_}] [${x}] ${A}`;u(N=>[...N.slice(-500),I])};return console.log=(...x)=>{g(...x),b("LOG",...x)},console.warn=(...x)=>{S(...x),b("WARN",...x)},console.error=(...x)=>{o(...x),b("ERROR",...x)},()=>{console.log=g,console.warn=S,console.error=o}},[]),v.useEffect(()=>{k&&a.current&&(a.current.scrollTop=a.current.scrollHeight)},[p,k]);const y=()=>{const g=p.join(`
`),S=new Blob([g],{type:"text/plain"}),o=URL.createObjectURL(S),b=document.createElement("a");b.href=o,b.download=`rsa-logs-${Date.now()}.log`,b.click(),URL.revokeObjectURL(o)},h=d?p.filter(g=>g.toLowerCase().includes(d.toLowerCase())):p,j=[{key:"vb6StrictMode",label:"VB6 Strict Mode",description:"Require complete VB6 fixture for simulation (no defaults)"},{key:"showDiagnostics",label:"Show Diagnostics",description:"Display debug information in console and UI"},{key:"enableStepTrace",label:"Step Trace",description:"Log detailed step-by-step simulation data"},{key:"enableEnergyLogging",label:"Energy Logging",description:"Log energy balance calculations"}];return e.jsxs("div",{style:{padding:"2rem",height:"100%",overflow:"auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Settings & Flags"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Configure user level, feature flags, and debug options."})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"User Level (Program Tier)"}),e.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem"},children:Ke.map(g=>e.jsx("button",{onClick:()=>n(g),style:{flex:1,padding:"0.75rem",fontSize:"0.875rem",fontWeight:t===g?"600":"400",backgroundColor:t===g?g==="admin"?"#8b5cf6":g==="quarterPro"?"#3b82f6":"#10b981":"var(--color-bg)",color:t===g?"white":"var(--color-text)",border:`2px solid ${t===g?g==="admin"?"#8b5cf6":g==="quarterPro"?"#3b82f6":"#10b981":"var(--color-border)"}`,borderRadius:"var(--radius-md)",cursor:"pointer",transition:"all 0.2s"},children:sr[g]},g))}),e.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--color-muted)",marginBottom:"1rem"},children:[e.jsx("strong",{children:"Current:"})," ",sr[t]," ‚Äî ",kt[t]]}),e.jsxs("details",{style:{fontSize:"0.875rem"},children:[e.jsxs("summary",{style:{cursor:"pointer",fontWeight:"500",marginBottom:"0.5rem"},children:["View Available Inputs for ",sr[t]]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"0.75rem",padding:"0.75rem",backgroundColor:"var(--color-bg)",borderRadius:"var(--radius-sm)",marginTop:"0.5rem"},children:[e.jsxs("div",{children:[e.jsx("strong",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"Engine"}),e.jsxs("ul",{style:{margin:"0.25rem 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:[s.engine.slice(0,5).map(g=>e.jsx("li",{children:g},g)),s.engine.length>5&&e.jsxs("li",{children:["+",s.engine.length-5," more"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"Vehicle"}),e.jsxs("ul",{style:{margin:"0.25rem 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:[s.vehicle.slice(0,5).map(g=>e.jsx("li",{children:g},g)),s.vehicle.length>5&&e.jsxs("li",{children:["+",s.vehicle.length-5," more"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"Drivetrain"}),e.jsxs("ul",{style:{margin:"0.25rem 0",paddingLeft:"1rem",fontSize:"0.75rem"},children:[s.drivetrain.slice(0,5).map(g=>e.jsx("li",{children:g},g)),s.drivetrain.length>5&&e.jsxs("li",{children:["+",s.drivetrain.length-5," more"]})]})]})]})]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:"600"},children:"Feature Flags"}),e.jsx("button",{onClick:m,style:{padding:"0.375rem 0.75rem",fontSize:"0.75rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-sm)",cursor:"pointer"},children:"Reset All"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"0.75rem"},children:j.map(g=>e.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.5rem",padding:"0.75rem",backgroundColor:r[g.key]?"#dbeafe":"var(--color-bg)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:r[g.key],onChange:S=>i(g.key,S.target.checked),style:{marginTop:"2px"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"500",fontSize:"0.875rem"},children:g.label}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:g.description})]})]},g.key))})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem"},children:[e.jsxs("h3",{style:{margin:0,fontSize:"1rem",fontWeight:"600"},children:["Console Logs (",p.length,")"]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>R(!C),style:{padding:"0.375rem 0.75rem",fontSize:"0.75rem",backgroundColor:C?"#3b82f6":"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-sm)",cursor:"pointer"},children:C?"Hide":"Show"}),e.jsx("button",{onClick:y,disabled:p.length===0,style:{padding:"0.375rem 0.75rem",fontSize:"0.75rem",backgroundColor:p.length>0?"#10b981":"#d1d5db",color:"white",border:"none",borderRadius:"var(--radius-sm)",cursor:p.length>0?"pointer":"not-allowed"},children:"Download"}),e.jsx("button",{onClick:()=>u([]),disabled:p.length===0,style:{padding:"0.375rem 0.75rem",fontSize:"0.75rem",backgroundColor:p.length>0?"#ef4444":"#d1d5db",color:"white",border:"none",borderRadius:"var(--radius-sm)",cursor:p.length>0?"pointer":"not-allowed"},children:"Clear"})]})]}),C&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("input",{type:"text",value:d,onChange:g=>P(g.target.value),placeholder:"Filter logs...",style:{flex:1,padding:"0.375rem 0.5rem",fontSize:"0.75rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-sm)",backgroundColor:"var(--color-bg)"}}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem"},children:[e.jsx("input",{type:"checkbox",checked:k,onChange:g=>T(g.target.checked)}),"Auto-scroll"]})]}),e.jsx("div",{ref:a,style:{height:"200px",padding:"0.5rem",backgroundColor:"#1e293b",color:"#e2e8f0",borderRadius:"var(--radius-sm)",fontFamily:"monospace",fontSize:"0.7rem",overflow:"auto",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:h.length===0?e.jsx("div",{style:{color:"#9ca3af",fontStyle:"italic"},children:p.length===0?"No logs yet":"No matches"}):h.map((g,S)=>{let o="#e2e8f0";return g.includes("[WARN]")&&(o="#fbbf24"),g.includes("[ERROR]")&&(o="#ef4444"),e.jsx("div",{style:{color:o},children:g},S)})})]})]})]})}function Ye(r){var i,n,m,s,p,u;const t=[];return r.drivetrain?((i=r.drivetrain.gearRatios)!=null&&i.length||t.push("drivetrain.gearRatios"),(n=r.drivetrain.perGearEff)!=null&&n.length||t.push("drivetrain.perGearEff"),r.drivetrain.gearRatios&&r.drivetrain.perGearEff&&r.drivetrain.gearRatios.length!==r.drivetrain.perGearEff.length&&t.push("perGearEff length must equal gearRatios length"),!r.drivetrain.clutch&&!r.drivetrain.converter&&t.push("drivetrain.clutch or drivetrain.converter"),(!r.engineHP||r.engineHP.length<2)&&t.push("engineHP (>=2 points)"),(m=r.fuel)!=null&&m.type||t.push("fuel.type"),((s=r.pmi)==null?void 0:s.engine_flywheel_clutch)==null&&t.push("pmi.engine_flywheel_clutch"),((p=r.pmi)==null?void 0:p.transmission_driveshaft)==null&&t.push("pmi.transmission_driveshaft"),((u=r.pmi)==null?void 0:u.tires_wheels_ringgear)==null&&t.push("pmi.tires_wheels_ringgear"),t.length?{ok:!1,missing:t}:{ok:!0}):(t.push("drivetrain.*"),{ok:!1,missing:t})}function Mt(){var a,y;const{fixture:r}=we(),[t,i]=v.useState(null),[n,m]=v.useState(null),[s,p]=v.useState(null),[u,d]=v.useState(null),[P,k]=v.useState(null),T=()=>{d("validate"),k(null);try{const h=Ye(r);i(h)}catch(h){k((h==null?void 0:h.message)??String(h))}finally{d(null)}},C=async()=>{d("dryrun"),k(null),m(null);try{const h=Ye(r);m({ok:h.ok,message:h.ok?"Fixture can be normalized successfully":`Missing fields: ${h.missing.join(", ")}`,details:h})}catch(h){k((h==null?void 0:h.message)??String(h))}finally{d(null)}},R=async()=>{var h,j,g;d("smoke"),k(null),p(null);try{const S=await ar("VB6Exact",{...r,raceLengthFt:1320});p({et_s:S.et_s,mph:S.mph,model:(h=S.meta)==null?void 0:h.model,steps:(g=(j=S.meta)==null?void 0:j.termination)==null?void 0:g.steps})}catch(S){k((S==null?void 0:S.message)??String(S))}finally{d(null)}};return e.jsxs("div",{style:{padding:"2rem"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Health Check"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Quick validation and testing tools for VB6 fixtures."})]}),P&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem",whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"0.875rem",color:"#991b1b"},children:P}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem",marginBottom:"2rem"},children:[e.jsx("button",{onClick:T,disabled:u!==null,style:{padding:"1rem",fontSize:"1rem",fontWeight:500,backgroundColor:u==="validate"?"#9ca3af":"#3b82f6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:u!==null?"not-allowed":"pointer",transition:"background-color 0.2s"},children:u==="validate"?"Validating...":"Validate Current VB6 Fixture"}),e.jsx("button",{onClick:C,disabled:u!==null,style:{padding:"1rem",fontSize:"1rem",fontWeight:500,backgroundColor:u==="dryrun"?"#9ca3af":"#8b5cf6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:u!==null?"not-allowed":"pointer",transition:"background-color 0.2s"},children:u==="dryrun"?"Running...":"Normalize & Dry-Run"}),e.jsx("button",{onClick:R,disabled:u!==null,style:{padding:"1rem",fontSize:"1rem",fontWeight:500,backgroundColor:u==="smoke"?"#9ca3af":"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:u!==null?"not-allowed":"pointer",transition:"background-color 0.2s"},children:u==="smoke"?"Running...":"Smoke Sim (1320 ft)"})]}),t&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:t.ok?"#dcfce7":"#fee2e2",border:`1px solid ${t.ok?"#22c55e":"#ef4444"}`,borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.5rem",fontSize:"1rem"},children:"Validation Result"}),t.ok?e.jsx("p",{style:{margin:0,color:"#166534"},children:"‚úÖ Fixture is valid and complete"}):e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 0.5rem 0",color:"#991b1b",fontWeight:500},children:"‚ùå Fixture is incomplete"}),e.jsx("p",{style:{margin:"0 0 0.5rem 0",color:"#991b1b",fontSize:"0.875rem"},children:"Missing fields:"}),e.jsx("ul",{style:{margin:0,paddingLeft:"1.5rem",color:"#991b1b"},children:t.missing.map(h=>e.jsx("li",{style:{fontSize:"0.875rem"},children:h},h))})]})]}),n&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:n.ok?"#dbeafe":"#fee2e2",border:`1px solid ${n.ok?"#3b82f6":"#ef4444"}`,borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.5rem",fontSize:"1rem"},children:"Dry-Run Result"}),e.jsxs("p",{style:{margin:0,color:n.ok?"#1e40af":"#991b1b"},children:[n.ok?"‚úÖ":"‚ùå"," ",n.message]})]}),s&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#dcfce7",border:"1px solid #22c55e",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem"},children:"Smoke Test Result"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#166534",marginBottom:"0.25rem"},children:"ET (s)"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#166534"},children:((a=s.et_s)==null?void 0:a.toFixed(3))??"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#166534",marginBottom:"0.25rem"},children:"MPH"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#166534"},children:((y=s.mph)==null?void 0:y.toFixed(2))??"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#166534",marginBottom:"0.25rem"},children:"Model"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:"500",color:"#166534"},children:s.model??"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"#166534",marginBottom:"0.25rem"},children:"Steps"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:"500",color:"#166534"},children:s.steps??"N/A"})]})]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#eff6ff",border:"1px solid #3b82f6",borderRadius:"var(--radius-md)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.5rem",fontSize:"1rem"},children:"About These Tests"}),e.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.875rem"},children:[e.jsxs("li",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Validate:"})," Checks if all required VB6 fixture fields are present"]}),e.jsxs("li",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Dry-Run:"})," Validates that the fixture can be normalized (no actual simulation)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Smoke Sim:"})," Runs a quick 1320 ft simulation to verify the fixture works end-to-end"]})]})]})]})}function At(r){var t;return(((t=r[r.length-1])==null?void 0:t.rpm)??8e3)+100}function It(r){const t=r.pmi??{};return{engine_flywheel_clutch:t.engine_flywheel_clutch??3.42,transmission_driveshaft:t.transmission_driveshaft??.247,tires_wheels_ringgear:t.tires_wheels_ringgear??50.8}}function Ft(r){const t=r.environment??{};return{elevationFt:t.elevation_ft??t.elevation??0,baroInHg:t.barometer_inHg??t.barometer??29.92,tempF:t.temp_F??t.temperature??59,rhPct:t.rel_humidity_pct??t.humidity??0,windMPH:t.wind_mph??t.windVelocity??0,windDeg:t.wind_angle_deg??t.windAngle??0,trackTempF:t.trackTemp_F??t.trackTemp??80,tractionIdx:t.tractionIndex??3}}function Bt(r,t){var T,C,R,a,y,h,j,g;const i=It(r),n=Ft(r),m=t<=660?"EIGHTH":"QUARTER",s=r.drivetrain??{},p={finalDrive:Number(s.finalDrive??s.final_drive??0),overallEff:Number(s.overallEff??s.overallEfficiency??s.efficiency??1),gearRatios:Array.isArray(s.gearRatios)?s.gearRatios.map(Number):[],perGearEff:Array.isArray(s.perGearEff)?s.perGearEff.map(Number):[],shiftRPM:Array.isArray(s.shiftRPM??s.shiftsRPM)?(s.shiftRPM??s.shiftsRPM).map(Number):[],clutch:s.clutch?{...s.clutch}:void 0,converter:s.converter?{...s.converter}:void 0},u=r.vehicle??{},d={weightLb:u.weight_lb??u.weight??r.weight??2400,wheelbaseIn:u.wheelbase_in??u.wheelbase??107,tireRolloutIn:((T=r.finalDrive)==null?void 0:T.tireRolloutIn)??u.tire_rollout_in??u.rollout??102.5,tireWidthIn:((C=r.finalDrive)==null?void 0:C.tireWidthIn)??u.tire_width_in??u.tireWidth??17,frontalAreaFt2:((R=r.aero)==null?void 0:R.frontalArea)??u.frontalArea_ft2??18.2,Cd:((a=r.aero)==null?void 0:a.cd)??u.Cd??.24,Cl:((y=r.aero)==null?void 0:y.cl)??u.Cl??.1,overhangIn:u.overhang_in??u.overhang??40},P={model:"VB6Exact",distanceFt:t,raceLength:m,env:n,vehicle:d,drivetrain:p,pmi:i,fuel:r.fuel};if(r.engineHP&&Array.isArray(r.engineHP)){const S=((h=r==null?void 0:r.fuel)==null?void 0:h.hpTorqueMultiplier)??1,o=(r.engineHP??[]).map(b=>Array.isArray(b)?{rpm:Number(b[0]),hp:Number(b[1])*S}:{rpm:Number(b==null?void 0:b.rpm),hp:Number(b==null?void 0:b.hp)*S}).filter(b=>Number.isFinite(b.rpm)&&Number.isFinite(b.hp)).sort((b,x)=>b.rpm-x.rpm);o.length>=2&&(P.engineParams={powerHP:o,redlineRPM:At(o),idleRPM:900})}const k=Number.isFinite(t)?Number(t):Number(r==null?void 0:r.raceLengthFt)||((r==null?void 0:r.raceLength)==="EIGHTH"?660:1320);if(P.raceLengthFt=k,P.raceLength=k===660?"EIGHTH":"QUARTER",!((j=P.engineParams)!=null&&j.powerHP)&&Array.isArray(r==null?void 0:r.engineHP)){const S=((g=r==null?void 0:r.fuel)==null?void 0:g.hpTorqueMultiplier)??1,o=r.engineHP.map(b=>Array.isArray(b)?{rpm:Number(b[0]),hp:Number(b[1])*S}:{rpm:Number(b==null?void 0:b.rpm),hp:Number(b==null?void 0:b.hp)*S}).filter(b=>Number.isFinite(b.rpm)&&Number.isFinite(b.hp)).sort((b,x)=>b.rpm-x.rpm);o.length>=2&&(P.engineParams={...P.engineParams??{},powerHP:o})}return P}function Ht({onSelect:r,showEditButton:t=!0,onEditClick:i}){const{vehicles:n,activeVehicleId:m,setActiveVehicleById:s,loading:p}=wr(),u=d=>{const P=d.target.value||null;s(P),P&&r&&r(P)};return p?e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)",marginBottom:"1rem",border:"1px solid var(--color-border)"},children:e.jsx("span",{style:{color:"var(--color-text-secondary)",fontSize:"0.875rem"},children:"Loading vehicles..."})}):e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)",marginBottom:"1rem",border:"1px solid var(--color-border)",display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:"500",color:"var(--color-text)",whiteSpace:"nowrap"},children:"Active Vehicle:"}),e.jsxs("select",{value:m??"",onChange:u,style:{flex:1,padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"},children:[e.jsx("option",{value:"",children:"‚Äî Select a vehicle ‚Äî"}),n.map(d=>e.jsx("option",{value:d.id,children:d.name||d.id},d.id))]}),t&&m&&e.jsx("button",{onClick:i,style:{padding:"0.5rem 0.75rem",fontSize:"0.75rem",backgroundColor:"var(--color-primary)",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer",whiteSpace:"nowrap"},children:"Edit in Vehicle Editor"}),n.length===0&&e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)",fontStyle:"italic"},children:"No vehicles saved yet"})]})}function Lt(r){var t,i;if(!((t=r==null?void 0:r.engineParams)!=null&&t.powerHP)&&Array.isArray(r==null?void 0:r.engineHP)){const n=((i=r==null?void 0:r.fuel)==null?void 0:i.hpTorqueMultiplier)??1,m=r.engineHP.map(s=>Array.isArray(s)?{rpm:Number(s[0]),hp:Number(s[1])*n}:{rpm:Number(s==null?void 0:s.rpm),hp:Number(s==null?void 0:s.hp)*n}).filter(s=>Number.isFinite(s.rpm)&&Number.isFinite(s.hp)).sort((s,p)=>s.rpm-p.rpm);m.length>=2&&(r.engineParams={...r.engineParams??{},powerHP:m})}return r}function Dt(){var l,_,A,I,N,Q,ee,ne,se,te,le,re,Y,de,oe;const r=Mr(),{fixture:t,setFixture:i}=we(),n=Ar("enableStepTrace"),m=Er(),{userLevel:s,setUserLevel:p}=m,{activeVehicle:u}=wr(),[d,P]=v.useState("QUARTER"),[k,T]=v.useState(!1),[C,R]=v.useState(null),[a,y]=v.useState(null),[h,j]=v.useState([]),g=Ye(t),S=c=>{var w,B,F;if(console.log("[RunInspector] Vehicle selected:",c),u&&u.id===c)try{const z=Yr(u),D=Zr(z);if(!D.ok){console.warn("[RunInspector] Adapter validation warnings:",D.errors),R(`Vehicle data incomplete: ${D.errors.join("; ")}`);return}i(z),console.log("[RunInspector] Fixture updated from vehicle:",{vehicleId:c,vehicleName:u.name,engineHPCount:(w=z.engineHP)==null?void 0:w.length,gearCount:(F=(B=z.drivetrain)==null?void 0:B.gearRatios)==null?void 0:F.length})}catch(z){console.error("[RunInspector] Failed to convert vehicle to fixture:",z),R(`Failed to load vehicle: ${z.message}`)}},o=()=>{v.startTransition(()=>r("/vehicles"))},b=async()=>{var w,B,F,z,D,E,Z;if(!t){R("No fixture loaded.");return}T(!0),R(null),y(null),j([]);let c=null;try{const V=d==="EIGHTH"?660:1320;c=Bt(t,V),c=Lt(c),c.raceLengthFt=V,console.log("[RUN] powerHP?",Array.isArray((w=c==null?void 0:c.engineParams)==null?void 0:w.powerHP),(z=(F=(B=c==null?void 0:c.engineParams)==null?void 0:B.powerHP)==null?void 0:F.slice)==null?void 0:z.call(F,0,2),"raceLengthFt",c==null?void 0:c.raceLengthFt);const L=await ar("VB6Exact",c);y(L),j([])}catch(V){const L=(D=c==null?void 0:c.engineParams)==null?void 0:D.powerHP;console.error("[Run Inspector error]",V,{hpSummary:Array.isArray(L)?`n=${L.length},first=${(E=L[0])==null?void 0:E.rpm},last=${(Z=L[L.length-1])==null?void 0:Z.rpm}`:"none"}),R((V==null?void 0:V.message)??String(V))}finally{T(!1)}},x=()=>{if(h.length===0){alert("No step data available to download");return}const c=["step","v_ftps","EngRPM","wheelRPM","ClutchSlip","HPSave","HPEngPMI","HPChasPMI","DragHP","HP_afterL1","HP_afterL2","PQWT","AMin","AMax","AGS_applied","Vel_next","Dist_next"],w=h.map(E=>[E.step,E.v_ftps,E.EngRPM,E.wheelRPM,E.ClutchSlip,E.HPSave,E.HPEngPMI,E.HPChasPMI,E.DragHP,E.HP_afterL1,E.HP_afterL2,E.PQWT,E.AMin,E.AMax,E.AGS_applied,E.Vel_next,E.Dist_next]),B=[c.join(","),...w.map(E=>E.join(","))].join(`
`),F=new Blob([B],{type:"text/csv"}),z=URL.createObjectURL(F),D=document.createElement("a");D.href=z,D.download=`run-inspector-VB6Exact-${d}-${Date.now()}.csv`,D.click(),URL.revokeObjectURL(z)};return e.jsxs("div",{style:{padding:"2rem",height:"100%",overflow:"auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Run Inspector & Steps"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Run simulations with VB6 fixtures and inspect detailed step-by-step physics data."})]}),!g.ok&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("p",{style:{margin:"0 0 0.75rem 0",fontSize:"0.875rem",color:"#991b1b",fontWeight:"600"},children:"Fixture validation failed."}),e.jsx("pre",{style:{margin:"0 0 0.75rem 0",padding:"0.5rem",backgroundColor:"#fef2f2",border:"1px solid #fca5a5",borderRadius:"var(--radius-sm)",fontSize:"0.75rem",color:"#991b1b",fontFamily:"monospace",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:g.missing.join(", ")}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>v.startTransition(()=>r("/dev?panel=input-inspector")),style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Open VB6 Inputs"}),e.jsx("button",{onClick:()=>r("/dev?panel=quick-paste&example=prostock"),style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Load ProStock_Pro Example"})]})]}),!n&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fef3c7",border:"1px solid #fbbf24",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.875rem",color:"#92400e"},children:[e.jsx("strong",{children:"üí° Hint:"})," Enable ",e.jsx("code",{children:"enableStepTrace"})," flag in the Feature Flags panel to capture detailed step data during simulation runs."]})}),C&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem",whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"0.875rem",color:"#991b1b"},children:C}),e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)",marginBottom:"1rem",border:"1px solid var(--color-border)",display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:"500",color:"var(--color-text)",whiteSpace:"nowrap"},children:"User Level:"}),e.jsx("div",{style:{display:"flex",gap:"0.25rem"},children:Ke.map(c=>e.jsx("button",{onClick:()=>p(c),style:{padding:"0.375rem 0.75rem",fontSize:"0.75rem",fontWeight:s===c?"600":"400",backgroundColor:s===c?"var(--color-primary)":"var(--color-bg)",color:s===c?"white":"var(--color-text)",border:`1px solid ${s===c?"var(--color-primary)":"var(--color-border)"}`,borderRadius:"var(--radius-sm)",cursor:"pointer",textTransform:"capitalize"},children:c},c))}),s==="admin"&&e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--color-text-secondary)"},children:"üîì Full access"})]}),e.jsx(Ht,{onSelect:S,onEditClick:o}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Controls"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem"},children:"Distance"}),e.jsxs("select",{value:d,onChange:c=>P(c.target.value),style:{width:"100%",padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"},children:[e.jsx("option",{value:"EIGHTH",children:"EIGHTH (660 ft)"}),e.jsx("option",{value:"QUARTER",children:"QUARTER (1320 ft)"})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"flex-end"},children:e.jsx("button",{onClick:b,disabled:k||!g.ok,style:{width:"100%",padding:"0.5rem 1rem",fontSize:"0.875rem",fontWeight:"500",backgroundColor:k||!g.ok?"#9ca3af":"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:k||!g.ok?"not-allowed":"pointer"},children:k?"Running...":"Run with current VB6 UI Fixture"})})]}),e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem",backgroundColor:g.ok?"#f0fdf4":"#fef2f2",border:`1px solid ${g.ok?"#86efac":"#fca5a5"}`,borderRadius:"var(--radius-md)"},children:[e.jsx("div",{style:{fontSize:"0.75rem",fontWeight:"600",marginBottom:"0.5rem",color:g.ok?"#166534":"#991b1b"},children:"Fixture Requirements"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"0.25rem",fontSize:"0.75rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{children:(_=(l=t.drivetrain)==null?void 0:l.gearRatios)!=null&&_.length?"‚úÖ":"‚ùå"}),e.jsx("span",{style:{color:"var(--color-text)"},children:"drivetrain.gearRatios"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{children:(I=(A=t.drivetrain)==null?void 0:A.perGearEff)!=null&&I.length?"‚úÖ":"‚ùå"}),e.jsx("span",{style:{color:"var(--color-text)"},children:"drivetrain.perGearEff"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{children:(N=t.drivetrain)!=null&&N.clutch||(Q=t.drivetrain)!=null&&Q.converter?"‚úÖ":"‚ùå"}),e.jsx("span",{style:{color:"var(--color-text)"},children:"clutch or converter"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{children:(ee=t.engineHP)!=null&&ee.length?"‚úÖ":"‚ùå"}),e.jsx("span",{style:{color:"var(--color-text)"},children:"engineHP"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{children:(ne=t.fuel)!=null&&ne.type?"‚úÖ":"‚ùå"}),e.jsx("span",{style:{color:"var(--color-text)"},children:"fuel.type"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx("span",{title:((se=t.pmi)==null?void 0:se.engine_flywheel_clutch)!=null&&((te=t.pmi)==null?void 0:te.transmission_driveshaft)!=null&&((le=t.pmi)==null?void 0:le.tires_wheels_ringgear)!=null?"All PMI fields present":(()=>{var w,B,F;const c=[];return((w=t.pmi)==null?void 0:w.engine_flywheel_clutch)==null&&c.push("engine_flywheel_clutch"),((B=t.pmi)==null?void 0:B.transmission_driveshaft)==null&&c.push("transmission_driveshaft"),((F=t.pmi)==null?void 0:F.tires_wheels_ringgear)==null&&c.push("tires_wheels_ringgear"),`Missing: ${c.join(", ")}`})(),children:((re=t.pmi)==null?void 0:re.engine_flywheel_clutch)!=null&&((Y=t.pmi)==null?void 0:Y.transmission_driveshaft)!=null&&((de=t.pmi)==null?void 0:de.tires_wheels_ringgear)!=null?"‚úÖ":"‚ùå"}),e.jsx("span",{style:{color:"var(--color-text)"},children:"pmi.*"})]})]})]})]}),a&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Results"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginBottom:"0.25rem"},children:"ET (s)"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:a.et_s.toFixed(3)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginBottom:"0.25rem"},children:"MPH"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:a.mph.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginBottom:"0.25rem"},children:"Model"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:"500"},children:a.meta.model})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginBottom:"0.25rem"},children:"Termination"}),e.jsx("div",{style:{fontSize:"0.875rem"},children:((oe=a.meta.termination)==null?void 0:oe.reason)||"DISTANCE"})]})]})]}),h.length>0&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:"600"},children:"First 12 Steps"}),e.jsx("button",{onClick:x,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Download CSV"})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.75rem",borderCollapse:"collapse",fontFamily:"monospace"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#1e293b",color:"#e2e8f0"},children:[e.jsx("th",{style:{padding:"0.5rem",textAlign:"left",borderBottom:"2px solid var(--color-border)"},children:"Step"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"v_ftps"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"EngRPM"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"wheelRPM"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"ClutchSlip"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"HPSave"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"HPEngPMI"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"HPChasPMI"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"DragHP"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"HP_L1"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"HP_L2"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"PQWT"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"AMin"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"AMax"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"AGS"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"Vel_next"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"Dist_next"})]})}),e.jsx("tbody",{children:h.map((c,w)=>e.jsxs("tr",{style:{backgroundColor:w%2===0?"transparent":"rgba(0,0,0,0.02)"},children:[e.jsx("td",{style:{padding:"0.5rem",borderBottom:"1px solid var(--color-border)"},children:c.step}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.v_ftps.toFixed(3)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.EngRPM.toFixed(0)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.wheelRPM.toFixed(2)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.ClutchSlip.toFixed(4)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.HPSave.toFixed(1)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.HPEngPMI.toFixed(1)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.HPChasPMI.toFixed(1)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.DragHP.toFixed(2)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.HP_afterL1.toFixed(1)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.HP_afterL2.toFixed(1)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.PQWT.toFixed(1)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.AMin.toFixed(3)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.AMax.toFixed(3)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.AGS_applied.toFixed(3)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.Vel_next.toFixed(3)}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"right",borderBottom:"1px solid var(--color-border)"},children:c.Dist_next.toFixed(6)})]},c.step))})]})})]}),a&&h.length===0&&e.jsx("div",{style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",color:"var(--color-muted)"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.875rem"},children:["Step data capture not yet implemented. Enable ",e.jsx("code",{children:"enableStepTrace"})," flag and implement step data collection hook in rsaclassic.ts."]})})]})}function Nr(r){return{vehicle:{name:"VB6 Fixture Vehicle",weightLb:r.vehicle.weight_lb},env:{elevation:r.env.elevation_ft,temperatureF:r.env.temperature_F,barometerInHg:r.env.barometer_inHg,humidityPct:r.env.relHumidity_pct,trackTempF:r.env.trackTemp_F,tractionIndex:r.env.tractionIndex,windMph:r.env.wind_mph,windAngleDeg:r.env.wind_angle_deg},raceLength:"QUARTER"}}function zt(){const{fixture:r}=we(),t=Ar("enableEnergyLogging"),[i,n]=v.useState(!1),[m,s]=v.useState(null),[p,u]=v.useState(null),[d,P]=v.useState(null),k=async()=>{n(!0),s(null),u(null),P(null);try{Qe(r);const R=Nr(r);R.raceLength="QUARTER";const a=await ar("VB6Exact",R);u(a);const y=a.meta.energy;if(y){const h=y.engine_in_ftlbf||0,j=y.balance_ftlbf||0;P({engine_in_ftlbf:y.engine_in_ftlbf||0,drag_loss_ftlbf:y.drag_loss_ftlbf||0,rolling_resistance_ftlbf:y.rolling_resistance_ftlbf||0,driveline_loss_ftlbf:y.driveline_loss_ftlbf||0,engine_pmi_loss_ftlbf:y.engine_pmi_loss_ftlbf||0,chassis_pmi_loss_ftlbf:y.chassis_pmi_loss_ftlbf||0,final_ke_ftlbf:y.final_ke_ftlbf||0,balance_ftlbf:j,balance_pct:h>0?j/h*100:0})}else s("Energy data not available in simulation result. Enable enableEnergyLogging flag.")}catch(R){R instanceof Xe?s(`Fixture validation failed:

${R.message}

Please complete all required fields in VB6 Inputs panel.`):s(R instanceof Error?R.message:String(R))}finally{n(!1)}},T=()=>{if(!d)return;const R=JSON.stringify(d,null,2),a=new Blob([R],{type:"application/json"}),y=URL.createObjectURL(a),h=document.createElement("a");h.href=y,h.download=`energy-breakdown-${Date.now()}.json`,h.click(),URL.revokeObjectURL(y)},C=()=>{if(!d)return;const R=["Category","Energy (ft-lbf)","Percentage"],a=d.engine_in_ftlbf,y=[["Engine Input",d.engine_in_ftlbf,"100.00%"],["Drag Loss",d.drag_loss_ftlbf,`${(d.drag_loss_ftlbf/a*100).toFixed(2)}%`],["Rolling Resistance",d.rolling_resistance_ftlbf,`${(d.rolling_resistance_ftlbf/a*100).toFixed(2)}%`],["Driveline Loss",d.driveline_loss_ftlbf,`${(d.driveline_loss_ftlbf/a*100).toFixed(2)}%`],["Engine PMI Loss",d.engine_pmi_loss_ftlbf,`${(d.engine_pmi_loss_ftlbf/a*100).toFixed(2)}%`],["Chassis PMI Loss",d.chassis_pmi_loss_ftlbf,`${(d.chassis_pmi_loss_ftlbf/a*100).toFixed(2)}%`],["Final Kinetic Energy",d.final_ke_ftlbf,`${(d.final_ke_ftlbf/a*100).toFixed(2)}%`],["Balance",d.balance_ftlbf,`${d.balance_pct.toFixed(2)}%`]],h=[R.join(","),...y.map(o=>o.join(","))].join(`
`),j=new Blob([h],{type:"text/csv"}),g=URL.createObjectURL(j),S=document.createElement("a");S.href=g,S.download=`energy-breakdown-${Date.now()}.csv`,S.click(),URL.revokeObjectURL(g)};return e.jsxs("div",{style:{padding:"2rem",height:"100%",overflow:"auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Energy Accounting"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Visualize energy flow and balance during simulation runs."})]}),!t&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fef3c7",border:"1px solid #fbbf24",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.875rem",color:"#92400e"},children:[e.jsx("strong",{children:"üí° Instructions:"})," Enable ",e.jsx("code",{children:"enableEnergyLogging"})," flag in the Feature Flags panel to capture energy accounting data during simulation runs."]})}),m&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem",whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"0.875rem",color:"#991b1b"},children:m}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx("button",{onClick:k,disabled:i,style:{padding:"0.75rem 1.5rem",fontSize:"0.875rem",fontWeight:"500",backgroundColor:i?"#9ca3af":"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:i?"not-allowed":"pointer"},children:i?"Running...":"Run VB6Exact (QUARTER)"})}),p&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"Run Results"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"ET (s)"}),e.jsx("div",{style:{fontSize:"1.25rem",fontWeight:"bold"},children:p.et_s.toFixed(3)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"MPH"}),e.jsx("div",{style:{fontSize:"1.25rem",fontWeight:"bold"},children:p.mph.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"Model"}),e.jsx("div",{style:{fontSize:"1rem",fontWeight:"500"},children:p.meta.model})]})]})]}),d&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:"600"},children:"Energy Breakdown"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:T,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Export JSON"}),e.jsx("button",{onClick:C,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Export CSV"})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsx(fe,{label:"Engine Input",value:d.engine_in_ftlbf,percentage:100,color:"#10b981",isInput:!0}),e.jsx(fe,{label:"Drag Loss",value:d.drag_loss_ftlbf,percentage:d.drag_loss_ftlbf/d.engine_in_ftlbf*100,color:"#ef4444"}),e.jsx(fe,{label:"Rolling Resistance",value:d.rolling_resistance_ftlbf,percentage:d.rolling_resistance_ftlbf/d.engine_in_ftlbf*100,color:"#f59e0b"}),e.jsx(fe,{label:"Driveline Loss",value:d.driveline_loss_ftlbf,percentage:d.driveline_loss_ftlbf/d.engine_in_ftlbf*100,color:"#f59e0b"}),e.jsx(fe,{label:"Engine PMI Loss",value:d.engine_pmi_loss_ftlbf,percentage:d.engine_pmi_loss_ftlbf/d.engine_in_ftlbf*100,color:"#f59e0b"}),e.jsx(fe,{label:"Chassis PMI Loss",value:d.chassis_pmi_loss_ftlbf,percentage:d.chassis_pmi_loss_ftlbf/d.engine_in_ftlbf*100,color:"#f59e0b"}),e.jsx(fe,{label:"Final Kinetic Energy",value:d.final_ke_ftlbf,percentage:d.final_ke_ftlbf/d.engine_in_ftlbf*100,color:"#3b82f6"}),e.jsx(fe,{label:"Balance (Error)",value:d.balance_ftlbf,percentage:d.balance_pct,color:Math.abs(d.balance_pct)<1?"#10b981":"#ef4444",showSign:!0})]}),e.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#1e293b",borderRadius:"var(--radius-md)",color:"#e2e8f0",fontFamily:"monospace",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Total Energy In:"})," ",d.engine_in_ftlbf.toLocaleString()," ft-lbf"]}),e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Total Losses:"})," ",(d.drag_loss_ftlbf+d.rolling_resistance_ftlbf+d.driveline_loss_ftlbf+d.engine_pmi_loss_ftlbf+d.chassis_pmi_loss_ftlbf).toLocaleString()," ","ft-lbf"]}),e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Final KE:"})," ",d.final_ke_ftlbf.toLocaleString()," ft-lbf"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Balance:"})," ",d.balance_ftlbf.toLocaleString()," ft-lbf (",d.balance_pct.toFixed(2),"%)"]})]})]})]})}function fe({label:r,value:t,percentage:i,color:n,isInput:m,showSign:s}){const p=s&&t>=0?`+${t.toLocaleString()}`:t.toLocaleString(),u=Math.min(Math.abs(i),100);return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.25rem",fontSize:"0.875rem"},children:[e.jsx("span",{style:{fontWeight:m?"600":"400"},children:r}),e.jsxs("span",{style:{fontFamily:"monospace"},children:[p," ft-lbf (",i.toFixed(2),"%)"]})]}),e.jsx("div",{style:{width:"100%",height:"24px",backgroundColor:"#e5e7eb",borderRadius:"var(--radius-sm)",overflow:"hidden"},children:e.jsx("div",{style:{width:`${u}%`,height:"100%",backgroundColor:n,transition:"width 0.3s ease"}})})]})}const Je=[{name:"SuperGas_Pro",source:"QuarterPro",raceLengthTargets:{EIGHTH:{et_s:6.27,mph:108.2,tolET_s:.2,tolMPH:3,anchors:{t60_s:1.35}},QUARTER:{et_s:9.9,mph:135.1,tolET_s:.3,tolMPH:4}}},{name:"TA_Dragster_Pro",source:"QuarterPro",raceLengthTargets:{EIGHTH:{et_s:3.56,mph:205.3,tolET_s:.12,tolMPH:5},QUARTER:{et_s:5.52,mph:243.1,tolET_s:.12,tolMPH:6}}},{name:"ProStock_Pro",source:"QuarterPro",raceLengthTargets:{EIGHTH:{et_s:4.37,mph:160.9,tolET_s:.12,tolMPH:4,anchors:{t60_s:1.01}},QUARTER:{et_s:6.8,mph:202.3,tolET_s:.15,tolMPH:5}}},{name:"FunnyCar_Pro",source:"QuarterPro",raceLengthTargets:{EIGHTH:{et_s:3.37,mph:243.5,tolET_s:.1,tolMPH:6},QUARTER:{et_s:4.98,mph:297,tolET_s:.1,tolMPH:7}}},{name:"Motorcycle_Pro",source:"QuarterPro",raceLengthTargets:{EIGHTH:{et_s:7.63,mph:91.1,tolET_s:.25,tolMPH:3},QUARTER:{et_s:11.99,mph:111.3,tolET_s:.3,tolMPH:3}}},{name:"SuperComp_Pro",source:"QuarterPro",raceLengthTargets:{EIGHTH:{et_s:5.66,mph:120.4,tolET_s:.18,tolMPH:4},QUARTER:{et_s:8.9,mph:151.6,tolET_s:.2,tolMPH:4}}},{name:"Motorcycle_Jr",source:"QuarterJr",raceLengthTargets:{EIGHTH:{et_s:7.45,mph:89.4,tolET_s:.25,tolMPH:3},QUARTER:{et_s:12,mph:104.5,tolET_s:.3,tolMPH:3}}},{name:"ETRacer_Jr",source:"QuarterJr",raceLengthTargets:{EIGHTH:{et_s:8.6,mph:80.3,tolET_s:.3,tolMPH:3},QUARTER:{et_s:13.5,mph:100.8,tolET_s:.35,tolMPH:3.5}}},{name:"EXP_Jr",source:"QuarterJr",raceLengthTargets:{EIGHTH:{et_s:5.15,mph:130.3,tolET_s:.15,tolMPH:4},QUARTER:{et_s:8.18,mph:160.2,tolET_s:.2,tolMPH:4}}},{name:"EXP_050523_Jr",source:"QuarterJr",raceLengthTargets:{EIGHTH:{et_s:5.06,mph:132.5,tolET_s:.15,tolMPH:4},QUARTER:{et_s:8.04,mph:163.5,tolET_s:.2,tolMPH:4}}}];function Nt(r,t,i,n){const m=r.raceLengthTargets[t];if(!m)throw new Error(`Benchmark ${r.name} has no target for ${t}`);const s=i-m.et_s,p=n-m.mph,u=Math.abs(s)<=m.tolET_s,d=Math.abs(p)<=m.tolMPH;return{pass:u&&d,etPass:u,mphPass:d,etDelta:s,mphDelta:p,etTolerance:m.tolET_s,mphTolerance:m.tolMPH}}function Wt(r){const t=[];if(r.env.elevation===void 0&&t.push("env.elevation"),r.env.barometerInHg===void 0&&t.push("env.barometerInHg"),r.env.temperatureF===void 0&&t.push("env.temperatureF"),r.env.humidityPct===void 0&&t.push("env.humidityPct"),r.vehicle.weightLb||t.push("vehicle.weightLb"),!r.vehicle.tireDiaIn&&!r.vehicle.tireRolloutIn&&t.push("vehicle.tireDiaIn OR vehicle.tireRolloutIn"),r.vehicle.rolloutIn===void 0&&t.push("vehicle.rolloutIn"),!r.vehicle.rearGear&&!r.vehicle.finalDrive&&t.push("vehicle.rearGear OR vehicle.finalDrive"),(!r.vehicle.gearRatios||r.vehicle.gearRatios.length===0)&&t.push("vehicle.gearRatios[]"),(!r.vehicle.shiftRPM||r.vehicle.shiftRPM.length===0)&&t.push("vehicle.shiftRPM[]"),r.vehicle.frontalArea_ft2===void 0&&t.push("vehicle.frontalArea_ft2"),r.vehicle.cd===void 0&&t.push("vehicle.cd"),!r.vehicle.torqueCurve||r.vehicle.torqueCurve.length===0?t.push("vehicle.torqueCurve[]"):r.vehicle.torqueCurve.every(n=>n.rpm!==void 0&&(n.hp!==void 0||n.tq_lbft!==void 0))||t.push("vehicle.torqueCurve[] must have rpm and (hp OR tq_lbft) for each point"),r.vehicle.converter&&(r.vehicle.converter.stallRPM===void 0&&t.push("vehicle.converter.stallRPM (required if converter present)"),r.vehicle.converter.torqueMult===void 0&&t.push("vehicle.converter.torqueMult (required if converter present)"),r.vehicle.converter.slipRatio===void 0&&t.push("vehicle.converter.slipRatio (required if converter present)")),r.vehicle.clutch&&(r.vehicle.clutch.slipRPM===void 0&&r.vehicle.clutch.launchRPM===void 0&&t.push("vehicle.clutch.slipRPM OR vehicle.clutch.launchRPM (required if clutch present)"),r.vehicle.clutch.slipRatio===void 0&&t.push("vehicle.clutch.slipRatio (required if clutch present)")),r.vehicle.gearRatios&&r.vehicle.shiftRPM){const i=r.vehicle.gearRatios.length,n=r.vehicle.shiftRPM.length;n!==i-1&&n!==i&&t.push(`vehicle.shiftRPM[] length mismatch (${n} shifts for ${i} gears)`)}if(r.vehicle.gearEff&&r.vehicle.gearRatios&&r.vehicle.gearEff.length!==r.vehicle.gearRatios.length&&t.push(`vehicle.gearEff[] length mismatch (${r.vehicle.gearEff.length} vs ${r.vehicle.gearRatios.length} gears)`),t.length>0)throw new Error(`Benchmark config '${r.name}' is missing required VB6 parameters:
`+t.map(i=>`  - ${i}`).join(`
`)+`

All required fields must be present from VB6 printouts - NO DEFAULTS ALLOWED.
This ensures VB6 parity by preventing silent defaults in the simulation.`)}const dr={ProStock_Pro:{name:"ProStock_Pro",fuel:"GAS",env:{elevation:32,barometerInHg:29.92,temperatureF:75,humidityPct:55,windMph:5,windAngleDeg:135,trackTempF:105,tractionIndex:3},vehicle:{weightLb:2355,wheelbaseIn:107,overhangIn:40,rolloutIn:9,tireRolloutIn:102.5,tireWidthIn:17,frontalArea_ft2:18.2,cd:.24,liftCoeff:.1,finalDrive:4.86,transEff:.975,gearRatios:[2.6,1.9,1.5,1.2,1],gearEff:[.99,.991,.992,.993,.994],shiftRPM:[9400,9400,9400,9400],clutch:{launchRPM:7200,slipRPM:7600,slipRatio:1.004,lockup:!1},torqueCurve:[{rpm:7e3,hp:1220},{rpm:7200,hp:1235},{rpm:7400,hp:1248},{rpm:7600,hp:1258},{rpm:7800,hp:1266},{rpm:8e3,hp:1272},{rpm:8200,hp:1276},{rpm:8400,hp:1278},{rpm:8600,hp:1279},{rpm:8800,hp:1278},{rpm:9e3,hp:1276},{rpm:9200,hp:1272},{rpm:9400,hp:1266},{rpm:9500,hp:1263}]}},FunnyCar_Pro:{name:"FunnyCar_Pro",fuel:"NITRO",env:{elevation:300,barometerInHg:29.92,temperatureF:76,humidityPct:50,windMph:0,trackTempF:112,tractionIndex:1},vehicle:{weightLb:2350,wheelbaseIn:125,overhangIn:40,rolloutIn:12,tireRolloutIn:118,tireWidthIn:18,frontalArea_ft2:24.1,cd:.5,liftCoeff:.8,finalDrive:3.2,transEff:.96,gearRatios:[1],gearEff:[1],shiftRPM:[100],clutch:{launchRPM:6400,slipRPM:6800,slipRatio:1,lockup:!1},pmi:{engine_flywheel_clutch:6.03,transmission_driveshaft:.107,tires_wheels_ringgear:75.4},torqueCurve:[{rpm:6400,hp:6116},{rpm:6600,hp:6276},{rpm:6800,hp:6306},{rpm:7e3,hp:6139},{rpm:7200,hp:5829},{rpm:7400,hp:5344},{rpm:7600,hp:4732},{rpm:7800,hp:3993},{rpm:9e3,hp:1297},{rpm:9250,hp:1269},{rpm:9500,hp:1222}]}},TA_Dragster_Pro:{name:"TA_Dragster_Pro",fuel:"METHANOL",env:{elevation:0,barometerInHg:29.92,temperatureF:77,humidityPct:45,windMph:0,trackTempF:110,tractionIndex:2},vehicle:{weightLb:1980,wheelbaseIn:280,overhangIn:30,rolloutIn:12,tireRolloutIn:110,tireWidthIn:17,frontalArea_ft2:19.5,cd:.58,liftCoeff:.4,finalDrive:4.56,transEff:.97,gearRatios:[1.85,1.3,1],gearEff:[.97,.98,.99],shiftRPM:[9200,9400],clutch:{launchRPM:6e3,slipRPM:7200,slipRatio:1.01,lockup:!1},torqueCurve:[{rpm:6e3,hp:1800},{rpm:6500,hp:2e3},{rpm:7e3,hp:2180},{rpm:7500,hp:2340},{rpm:8e3,hp:2480},{rpm:8500,hp:2600},{rpm:9e3,hp:2700},{rpm:9500,hp:2780},{rpm:1e4,hp:2840},{rpm:10500,hp:2880},{rpm:11e3,hp:2900},{rpm:11500,hp:2900}]}},SuperComp_Pro:{name:"SuperComp_Pro",fuel:"GAS",env:{elevation:600,barometerInHg:29.92,temperatureF:87,humidityPct:35,windMph:0,trackTempF:112,tractionIndex:5},vehicle:{weightLb:1700,wheelbaseIn:225,overhangIn:30,rolloutIn:12,tireDiaIn:32.6,tireWidthIn:13.2,frontalArea_ft2:13.6,cd:.5,liftCoeff:.15,finalDrive:4.56,transEff:.97,gearRatios:[1.76,1],gearEff:[.97,.99],shiftRPM:[7500],converter:{launchRPM:5e3,stallRPM:5500,slipRatio:1.06,torqueMult:1.7,lockup:!1,diameterIn:10},torqueCurve:[{rpm:3500,hp:520},{rpm:4e3,hp:560},{rpm:4500,hp:600},{rpm:5e3,hp:640},{rpm:5500,hp:680},{rpm:6e3,hp:715},{rpm:6500,hp:745},{rpm:7e3,hp:770},{rpm:7500,hp:790},{rpm:8e3,hp:805},{rpm:8500,hp:815},{rpm:9e3,hp:820},{rpm:9500,hp:820},{rpm:1e4,hp:815}]}},SuperGas_Pro:{name:"SuperGas_Pro",fuel:"GAS",env:{elevation:850,barometerInHg:29.92,temperatureF:77,humidityPct:30,windMph:0,trackTempF:102,tractionIndex:5},vehicle:{weightLb:2300,wheelbaseIn:103,overhangIn:30,rolloutIn:12,tireDiaIn:32.4,tireWidthIn:14.4,frontalArea_ft2:22.1,cd:.4,liftCoeff:.25,finalDrive:5.14,transEff:.97,gearRatios:[1.76,1],gearEff:[.97,.99],shiftRPM:[7600],converter:{launchRPM:5e3,stallRPM:5500,slipRatio:1.06,torqueMult:1.7,lockup:!1,diameterIn:10},torqueCurve:[{rpm:3500,hp:450},{rpm:4e3,hp:490},{rpm:4500,hp:530},{rpm:5e3,hp:565},{rpm:5500,hp:600},{rpm:6e3,hp:630},{rpm:6500,hp:655},{rpm:7e3,hp:675},{rpm:7500,hp:690},{rpm:8e3,hp:700},{rpm:8500,hp:705},{rpm:9e3,hp:705},{rpm:9500,hp:700}]}},Motorcycle_Pro:{name:"Motorcycle_Pro",fuel:"GAS",env:{elevation:500,barometerInHg:29.92,temperatureF:75,humidityPct:50,windMph:0,trackTempF:100,tractionIndex:4},vehicle:{weightLb:650,wheelbaseIn:54,rolloutIn:12,tireDiaIn:28,tireWidthIn:5,frontalArea_ft2:7.5,cd:.55,liftCoeff:.05,finalDrive:6.5,transEff:.99,gearRatios:[2.74,1.96,1.4,1],shiftRPM:[8e3,8e3,8e3],clutch:{launchRPM:6e3,slipRPM:6e3,slipRatio:1,lockup:!0},torqueCurve:[{rpm:5e3,hp:60},{rpm:5500,hp:64},{rpm:6e3,hp:68},{rpm:6500,hp:71},{rpm:7e3,hp:73},{rpm:7200,hp:74},{rpm:7500,hp:74},{rpm:8e3,hp:73},{rpm:8500,hp:71}]}},Motorcycle_Jr:{name:"Motorcycle_Jr",fuel:"GAS",env:{elevation:900,barometerInHg:29.92,temperatureF:74,humidityPct:40,tractionIndex:4},vehicle:{weightLb:730,wheelbaseIn:54,rolloutIn:12,tireDiaIn:28,tireWidthIn:5,frontalArea_ft2:7.9,cd:.55,liftCoeff:.05,finalDrive:6.81,transEff:.99,gearRatios:[2.74,1.96,1.4,1],shiftRPM:[8e3,8e3,8e3],clutch:{launchRPM:6e3,slipRPM:6e3,slipRatio:1,lockup:!0},torqueCurve:[{rpm:5e3,hp:62},{rpm:5500,hp:68},{rpm:6e3,hp:73},{rpm:6500,hp:77},{rpm:7e3,hp:80},{rpm:7200,hp:81},{rpm:7500,hp:81},{rpm:8e3,hp:80},{rpm:8500,hp:78}]}},ETRacer_Jr:{name:"ETRacer_Jr",fuel:"GAS",env:{elevation:680,barometerInHg:29.92,temperatureF:86,humidityPct:60,tractionIndex:5},vehicle:{weightLb:3600,wheelbaseIn:108,rolloutIn:14,tireDiaIn:28,tireWidthIn:10,frontalArea_ft2:26.1,cd:.45,liftCoeff:.2,finalDrive:4.11,transEff:.97,gearRatios:[2.48,1.48,1],shiftRPM:[6e3,6e3],converter:{launchRPM:2500,stallRPM:3e3,lockup:!1,diameterIn:10,slipRatio:1.05,torqueMult:1.6},powerHP:325,torqueCurve:[{rpm:3e3,hp:220},{rpm:3500,hp:250},{rpm:4e3,hp:275},{rpm:4500,hp:295},{rpm:5e3,hp:310},{rpm:5500,hp:322},{rpm:5600,hp:325},{rpm:6e3,hp:325},{rpm:6500,hp:320}]}},EXP_Jr:{name:"EXP_Jr",fuel:"GAS",env:{elevation:400,barometerInHg:29.92,temperatureF:80,humidityPct:45,tractionIndex:4},vehicle:{weightLb:2100,wheelbaseIn:180,rolloutIn:12,tireDiaIn:30,tireWidthIn:12,frontalArea_ft2:15.5,cd:.48,liftCoeff:.18,finalDrive:4.3,transEff:.97,gearRatios:[1.8,1.3,1],shiftRPM:[7800,8e3],clutch:{launchRPM:5500,slipRPM:6e3,slipRatio:1.005,lockup:!1},torqueCurve:[{rpm:5e3,hp:750},{rpm:5500,hp:810},{rpm:6e3,hp:860},{rpm:6500,hp:900},{rpm:7e3,hp:930},{rpm:7500,hp:950},{rpm:8e3,hp:960},{rpm:8500,hp:960},{rpm:9e3,hp:950}]}},EXP_050523_Jr:{name:"EXP_050523_Jr",fuel:"GAS",env:{elevation:420,barometerInHg:29.92,temperatureF:78,humidityPct:48,tractionIndex:4},vehicle:{weightLb:2080,wheelbaseIn:180,rolloutIn:12,tireDiaIn:30.5,tireWidthIn:12.5,frontalArea_ft2:15.2,cd:.46,liftCoeff:.16,finalDrive:4.25,transEff:.975,gearRatios:[1.82,1.32,1],shiftRPM:[7900,8100],clutch:{launchRPM:5600,slipRPM:6100,slipRatio:1.004,lockup:!1},torqueCurve:[{rpm:5e3,hp:770},{rpm:5500,hp:830},{rpm:6e3,hp:880},{rpm:6500,hp:920},{rpm:7e3,hp:955},{rpm:7500,hp:980},{rpm:8e3,hp:995},{rpm:8500,hp:1e3},{rpm:9e3,hp:995}]}}};(()=>{const r=dr.ProStock_Pro;if(!r)return;const t=Ir,i=r.vehicle;i.weightLb=t.vehicle.weight_lb,i.wheelbaseIn=t.vehicle.wheelbase_in,i.overhangIn=t.vehicle.overhang_in??i.overhangIn,i.rolloutIn=t.vehicle.rollout_in??i.rolloutIn,i.tireDiaIn=t.vehicle.tire.diameter_in,i.tireRolloutIn=t.vehicle.tire.diameter_in*Math.PI,i.tireWidthIn=t.vehicle.tire.width_in,i.frontalArea_ft2=t.aero.frontalArea_ft2,i.cd=t.aero.Cd,i.liftCoeff=t.aero.Cl??i.liftCoeff,i.finalDrive=t.drivetrain.finalDrive,i.transEff=t.drivetrain.overallEfficiency,i.gearRatios=[...t.drivetrain.gearRatios],i.gearEff=[...t.drivetrain.perGearEff],i.shiftRPM=[...t.drivetrain.shiftsRPM],i.clutch={launchRPM:t.drivetrain.clutch.launchRPM,slipRPM:t.drivetrain.clutch.slipRPM,slipRatio:t.drivetrain.clutch.slippageFactor,lockup:t.drivetrain.clutch.lockup},i.pmi={engine_flywheel_clutch:t.pmi.engine_flywheel_clutch,transmission_driveshaft:t.pmi.transmission_driveshaft,tires_wheels_ringgear:t.pmi.tires_wheels_ringgear},i.engine={hpCurve:t.engineHP.map(([n,m])=>({rpm:n,hp:m})),fuelType:t.fuel.type,hpTorqueMultiplier:t.fuel.hpTorqueMultiplier},r.env.elevation=t.env.elevation_ft,r.env.barometerInHg=t.env.barometer_inHg,r.env.temperatureF=t.env.temperature_F,r.env.humidityPct=t.env.relHumidity_pct,r.env.windMph=t.env.wind_mph,r.env.windAngleDeg=t.env.wind_angle_deg,r.env.trackTempF=t.env.trackTemp_F,r.env.tractionIndex=t.env.tractionIndex})();const Cr={ProStock_Pro:Ir};function Gt(r){var n;const t=dr[r];if(!t)throw new Error(`Benchmark config not found: ${r}`);return{env:{elevation_ft:t.env.elevation,barometer_inHg:t.env.barometerInHg,temperature_F:t.env.temperatureF,relHumidity_pct:t.env.humidityPct,wind_mph:t.env.windMph??0,wind_angle_deg:t.env.windAngleDeg??0,trackTemp_F:t.env.trackTempF??t.env.temperatureF,tractionIndex:t.env.tractionIndex??1},vehicle:{weight_lb:t.vehicle.weightLb,wheelbase_in:t.vehicle.wheelbaseIn??100,overhang_in:t.vehicle.overhangIn??40,rollout_in:t.vehicle.rolloutIn,staticFrontWeight_lb:t.vehicle.weightLb*.38,cgHeight_in:(t.vehicle.tireDiaIn??32)/2+3.75,bodyStyle:1,tire:{diameter_in:t.vehicle.tireDiaIn??(t.vehicle.tireRolloutIn??100)/Math.PI,width_in:t.vehicle.tireWidthIn??10}},aero:{frontalArea_ft2:t.vehicle.frontalArea_ft2,Cd:t.vehicle.cd,Cl:t.vehicle.liftCoeff??0},drivetrain:{finalDrive:t.vehicle.finalDrive??t.vehicle.rearGear??3,overallEfficiency:t.vehicle.transEff??.95,gearRatios:t.vehicle.gearRatios??[1],perGearEff:t.vehicle.gearEff??[.95],shiftsRPM:t.vehicle.shiftRPM??[7e3],clutch:t.vehicle.clutch?{launchRPM:t.vehicle.clutch.launchRPM??3e3,slipRPM:t.vehicle.clutch.slipRPM??3500,slippageFactor:t.vehicle.clutch.slipRatio??.1,lockup:t.vehicle.clutch.lockup??!1}:void 0,converter:t.vehicle.converter?{stallRPM:t.vehicle.converter.stallRPM??2500,torqueMult:t.vehicle.converter.torqueMult??2,slippageFactor:t.vehicle.converter.slipRatio??.1,lockup:t.vehicle.converter.lockup??!1}:void 0},pmi:{engine_flywheel_clutch:.5,transmission_driveshaft:.2,tires_wheels_ringgear:.3},engineHP:((n=t.vehicle.torqueCurve)==null?void 0:n.map(m=>[m.rpm,m.hp??0]))??[],fuel:{type:t.fuel??"GAS",hpTorqueMultiplier:1}}}function Vt(){const{fixture:r,setFixture:t}=we(),[i,n]=v.useState(JSON.stringify(r,null,2)),[m,s]=v.useState(null),[p,u]=v.useState(null),[d,P]=v.useState("ProStock_Pro"),[k,T]=v.useState("ProStock_Pro"),[C,R]=v.useState(null),a=()=>{try{const o=JSON.parse(i);Qe(o),s(null),alert("‚úì Fixture is valid and complete!")}catch(o){o instanceof Xe?s(o.message):o instanceof SyntaxError?s(`JSON Syntax Error: ${o.message}`):s(o instanceof Error?o.message:String(o))}},y=()=>{try{const o=JSON.parse(i);t(o),s(null),alert("‚úì Applied to UI fixture store!")}catch(o){o instanceof SyntaxError?s(`JSON Syntax Error: ${o.message}`):s(o instanceof Error?o.message:String(o))}},h=()=>{try{const o=JSON.parse(i);Qe(o);const b=Nr(o);u(b),s(null)}catch(o){o instanceof Xe?(s(o.message),u(null)):o instanceof SyntaxError?s(`JSON Syntax Error: ${o.message}`):s(o instanceof Error?o.message:String(o))}},j=()=>{p&&(navigator.clipboard.writeText(JSON.stringify(p,null,2)),alert("‚úì Copied simulation input to clipboard!"))},g=()=>{try{const o=JSON.parse(i),b=Cr[d],x=Wr(o,b,"");R(x.length>0?x.join(`
`):"No differences found")}catch(o){R(`Error: ${o instanceof Error?o.message:String(o)}`)}},S=()=>{try{const o=Gt(k),b=JSON.stringify(o,null,2);n(b),t(o),s(null),alert(`‚úì Populated from benchmark: ${k}`)}catch(o){s(o instanceof Error?o.message:String(o))}};return e.jsxs("div",{style:{padding:"2rem",height:"100%",overflow:"auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Input Inspector (VB6)"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Visualize, validate, and compare VB6 fixtures and simulation inputs."})]}),m&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem",whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"0.875rem",color:"#991b1b"},children:m}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"Load from Benchmark"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("select",{value:k,onChange:o=>T(o.target.value),style:{flex:1,padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"},children:Je.map(o=>e.jsxs("option",{value:o.name,children:[o.name," (",o.source,")"]},o.name))}),e.jsx("button",{onClick:S,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer",whiteSpace:"nowrap"},children:"Populate from Benchmark"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"(A) VB6 UI Fixture (Editable)"}),e.jsx("textarea",{value:i,onChange:o=>n(o.target.value),style:{width:"100%",height:"400px",padding:"0.75rem",fontFamily:"monospace",fontSize:"0.75rem",backgroundColor:"#1e293b",color:"#e2e8f0",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",resize:"vertical"}}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("button",{onClick:a,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Validate"}),e.jsx("button",{onClick:y,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Apply to UI"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"(B) Simulation Input (Readonly)"}),e.jsx("pre",{style:{width:"100%",height:"400px",padding:"0.75rem",fontFamily:"monospace",fontSize:"0.75rem",backgroundColor:"#1e293b",color:"#e2e8f0",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",overflow:"auto",margin:0},children:p?JSON.stringify(p,null,2):'// Click "Build Input From UI" to generate'}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("button",{onClick:h,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Build Input From UI"}),e.jsx("button",{onClick:j,disabled:!p,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:p?"#6b7280":"#d1d5db",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:p?"pointer":"not-allowed"},children:"Copy Input JSON"})]})]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"Diff vs Code Fixture"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",alignItems:"center"},children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:"500"},children:"Compare against:"}),e.jsx("select",{value:d,onChange:o=>P(o.target.value),style:{padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"},children:Object.keys(Cr).map(o=>e.jsx("option",{value:o,children:o},o))}),e.jsx("button",{onClick:g,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#f59e0b",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Diff vs Fixture"})]}),C&&e.jsx("pre",{style:{padding:"0.75rem",backgroundColor:"#1e293b",color:"#e2e8f0",borderRadius:"var(--radius-sm)",fontSize:"0.75rem",overflow:"auto",margin:0,maxHeight:"300px",whiteSpace:"pre-wrap"},children:C})]})]})}function Wr(r,t,i){const n=[];for(const m in t){const s=i?`${i}.${m}`:m;m in r?typeof t[m]=="object"&&t[m]!==null&&!Array.isArray(t[m])?n.push(...Wr(r[m],t[m],s)):JSON.stringify(r[m])!==JSON.stringify(t[m])&&(n.push(`~ CHANGED: ${s}`),n.push(`  Reference: ${JSON.stringify(t[m])}`),n.push(`  Current:   ${JSON.stringify(r[m])}`)):n.push(`- MISSING: ${s}`)}for(const m in r)if(!(m in t)){const s=i?`${i}.${m}`:m;n.push(`+ ADDED: ${s} = ${JSON.stringify(r[m])}`)}return n}const Tr="rsa.quickpaste.profiles.v1";function Ut(){const r=Mr(),[t]=Fr(),{fixture:i,setFixture:n}=we(),[m,s]=v.useState(""),[p,u]=v.useState([]),[d,P]=v.useState(null),[k,T]=v.useState(""),[C,R]=v.useState(""),[a,y]=v.useState(""),[h,j]=v.useState(null),[g,S]=v.useState([]),[o,b]=v.useState(""),[x,l]=v.useState(""),[_,A]=v.useState(null),[I,N]=v.useState(!1);v.useEffect(()=>{try{const c=localStorage.getItem(Tr);c&&S(JSON.parse(c))}catch(c){console.error("Failed to load profiles:",c)}},[]);const Q=c=>{try{localStorage.setItem(Tr,JSON.stringify(c)),S(c)}catch(w){console.error("Failed to save profiles:",w)}},ee=c=>{const w=c.trim().split(`
`),B=[];for(const F of w){const z=F.trim();if(!z)continue;const D=z.split(/[\s,]+/);if(D.length<2)throw new Error(`Invalid line: "${F}" - expected "RPM HP" or "RPM,HP"`);const E=parseFloat(D[0]),Z=parseFloat(D[1]);if(isNaN(E)||isNaN(Z))throw new Error(`Invalid numbers in line: "${F}"`);B.push({rpm:E,hp:Z})}if(B.length===0)throw new Error("No valid dyno data found");return B.sort((F,z)=>F.rpm-z.rpm),B},ne=()=>{try{const c=ee(m);u(c),P(null)}catch(c){P(c instanceof Error?c.message:String(c)),u([])}},se=()=>{try{const c=ee(m);n({...i,engineHP:c.map(w=>[w.rpm,w.hp])}),P(null),alert(`‚úì Applied ${c.length} dyno points to VB6 UI Fixture!`)}catch(c){P(c instanceof Error?c.message:String(c))}},te=()=>{try{j(null);const c={},w={};if(k.trim()){const F=parseFloat(k);if(isNaN(F))throw new Error("Invalid PMI Engine value");c.engine_flywheel_clutch=F}if(C.trim()){const F=parseFloat(C);if(isNaN(F))throw new Error("Invalid PMI Chassis value");c.tires_wheels_ringgear=F}if(a.trim()){const F=a.split(",").map(D=>D.trim()),z=[];for(const D of F){const E=parseFloat(D);if(isNaN(E))throw new Error(`Invalid gear efficiency value: "${D}"`);z.push(E)}w.perGearEff=z}if(Object.keys(c).length===0&&Object.keys(w).length===0){j("No values to apply");return}const B={...i};Object.keys(c).length>0&&(B.pmi={...i.pmi,...c}),Object.keys(w).length>0&&(B.drivetrain={...i.drivetrain,...w}),n(B),alert("‚úì Applied PMI values to VB6 UI Fixture!")}catch(c){j(c instanceof Error?c.message:String(c))}},le=()=>{if(!x.trim()){alert("Please enter a profile name");return}const c={name:x.trim(),timestamp:Date.now(),fixture:JSON.parse(JSON.stringify(i))},w=[...g,c];Q(w),l(""),alert(`‚úì Saved profile "${c.name}"`)},re=()=>{if(!o){alert("Please select a profile");return}const c=g.find(w=>w.name===o);if(!c){alert("Profile not found");return}n(c.fixture),alert(`‚úì Loaded profile "${c.name}"`)},Y=()=>{if(!o){alert("Please select a profile");return}if(!confirm(`Delete profile "${o}"?`))return;const c=g.filter(w=>w.name!==o);Q(c),b("")},de=()=>{try{Qe(i),A(null),alert("‚úì Fixture is complete and valid!")}catch(c){c instanceof Xe?A(c.message):A(c instanceof Error?c.message:String(c))}},oe=async()=>{N(!0),A(null);try{const c=await fetch("/src/dev/fixtures/ProStock_Pro.vb6.json");if(!c.ok)throw new Error(`Failed to load fixture: ${c.statusText}`);const w=await c.json();w.pmi||(w.pmi={engine_flywheel_clutch:3.42,transmission_driveshaft:.247,tires_wheels_ringgear:50.8}),n(w);const B=Ye(w);if(B.ok)alert(`‚úì ProStock_Pro fixture loaded and validated successfully!

Fixture valid: all PMI fields detected.`);else{const F=B.missing.join(", ");alert(`‚ö† Fixture loaded but incomplete.

Missing fields: ${F}`),A(`Missing fields: ${F}`)}v.startTransition(()=>{r("/dev?panel=input-inspector")})}catch(c){const w=c instanceof Error?c.message:String(c);A(`Failed to load ProStock_Pro fixture: ${w}`),alert(`‚ùå Error loading fixture: ${w}`)}finally{N(!1)}};return v.useEffect(()=>{t.get("example")==="prostock"&&setTimeout(()=>{oe()},0)},[t]),e.jsxs("div",{style:{padding:"2rem",height:"100%",overflow:"auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Quick Paste (Dyno & PMI)"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Quickly paste dyno tables and PMI values into VB6 fixtures."})]}),_&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem",whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"0.875rem",color:"#991b1b"},children:_}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"1. Paste Dyno Table"}),e.jsx("p",{style:{fontSize:"0.875rem",color:"var(--color-muted)",marginBottom:"0.75rem"},children:'Paste dyno data as "RPM HP" or "RPM,HP" (one pair per line)'}),e.jsx("textarea",{value:m,onChange:c=>s(c.target.value),placeholder:`7000 1275
7100 1280
7200 1285`,style:{width:"100%",height:"150px",padding:"0.75rem",fontFamily:"monospace",fontSize:"0.875rem",backgroundColor:"#1e293b",color:"#e2e8f0",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",resize:"vertical"}}),d&&e.jsx("div",{style:{marginTop:"0.5rem",padding:"0.5rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-sm)",fontSize:"0.875rem",color:"#991b1b"},children:d}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.75rem"},children:[e.jsx("button",{onClick:ne,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Preview"}),e.jsx("button",{onClick:se,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Apply to VB6 UI Fixture"})]}),p.length>0&&e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("h4",{style:{marginTop:0,marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:["Preview (",p.length," points)"]}),e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"#1e293b",borderRadius:"var(--radius-sm)",fontFamily:"monospace",fontSize:"0.75rem",color:"#e2e8f0",maxHeight:"150px",overflow:"auto"},children:[p.slice(0,10).map((c,w)=>e.jsxs("div",{children:[c.rpm.toFixed(0)," RPM ‚Üí ",c.hp.toFixed(1)," HP"]},w)),p.length>10&&e.jsxs("div",{style:{color:"#9ca3af",marginTop:"0.5rem"},children:["... and ",p.length-10," more points"]})]})]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"2. Paste PMI Values"}),h&&e.jsx("div",{style:{marginBottom:"0.75rem",padding:"0.5rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-sm)",fontSize:"0.875rem",color:"#991b1b"},children:h}),e.jsxs("div",{style:{display:"grid",gap:"0.75rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.25rem"},children:"PMI Engine (slug-ft¬≤)"}),e.jsx("input",{type:"text",value:k,onChange:c=>T(c.target.value),placeholder:"e.g., 3.42",style:{width:"100%",padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.25rem"},children:"PMI Chassis (slug-ft¬≤)"}),e.jsx("input",{type:"text",value:C,onChange:c=>R(c.target.value),placeholder:"e.g., 50.8",style:{width:"100%",padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.25rem"},children:"Gear Efficiencies (comma-separated)"}),e.jsx("input",{type:"text",value:a,onChange:c=>y(c.target.value),placeholder:"e.g., 0.98, 0.97, 0.96, 0.95",style:{width:"100%",padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"}})]})]}),e.jsx("button",{onClick:te,style:{marginTop:"0.75rem",padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Apply PMI Values"})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"3. Load/Save Profiles"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem"},children:"Save Current Fixture as Profile"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:x,onChange:c=>l(c.target.value),placeholder:"Profile name",style:{flex:1,padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"}}),e.jsx("button",{onClick:le,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Save"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem"},children:"Load Profile"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("select",{value:o,onChange:c=>b(c.target.value),style:{flex:1,padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"},children:[e.jsx("option",{value:"",children:"Select a profile..."}),g.map(c=>e.jsxs("option",{value:c.name,children:[c.name," (",new Date(c.timestamp).toLocaleDateString(),")"]},c.name))]}),e.jsx("button",{onClick:re,disabled:!o,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:o?"#10b981":"#d1d5db",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:o?"pointer":"not-allowed"},children:"Load"}),e.jsx("button",{onClick:Y,disabled:!o,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:o?"#ef4444":"#d1d5db",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:o?"pointer":"not-allowed"},children:"Delete"})]})]}),g.length===0&&e.jsx("p",{style:{marginTop:"0.75rem",fontSize:"0.875rem",color:"var(--color-muted)",fontStyle:"italic"},children:"No saved profiles yet"})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"4. Load Example Fixture"}),e.jsx("button",{onClick:oe,disabled:I,style:{padding:"0.75rem 1.5rem",fontSize:"0.875rem",fontWeight:"500",backgroundColor:I?"#9ca3af":"#f59e0b",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:I?"not-allowed":"pointer"},children:I?"Loading...":"Load Example: ProStock_Pro"}),e.jsx("p",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"var(--color-muted)"},children:"Loads complete ProStock_Pro fixture from VB6 printout, validates it, and opens Input Inspector"})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:de,style:{padding:"0.75rem 1.5rem",fontSize:"0.875rem",fontWeight:"500",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Validate Current Fixture"}),e.jsx("p",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"var(--color-muted)"},children:"Runs assertComplete() to check if all required fields are present"})]})]})}function Gr(r){const t=r.elevation_ft??0,i=r.fuelSystem??1,n=[.0205558,.00118163,154988e-10,40245e-11,434856e-15,2096e-14],m=n[0]+n[1]*r.temperature_F+n[2]*r.temperature_F**2+n[3]*r.temperature_F**3+n[4]*r.temperature_F**4+n[5]*r.temperature_F**5,s=r.relHumidity_pct/100*m,p=Math.pow((or-.00356616*t)/or,5.25588),u=Sr*r.barometer_inHg/rt*p,d=u-s,P=d/Sr,k=s*Rr/(d*tr),T=jr*(1/tr+k/Rr)/(1+k),C=T/(jr/tr),R=r.temperature_F+et,a=R/or,h=144*u/(T*R)/32.174;let j,g;switch(i){case 1:j=1,g=1;break;case 2:j=1,g=2;break;case 3:j=2,g=1;break;case 4:j=2,g=2;break;case 5:j=3,g=2;break;case 6:j=1,g=3;break;case 7:case 9:j=2,g=3;break;case 8:j=3,g=3;break;default:j=1,g=1;break}const S=1+2.48*Math.pow(k,1.5);let o,b,x;switch(j){case 1:o=1,b=.6,x=.15;break;case 2:o=1,b=.3,x=.13;break;case 3:o=.85,b=.5,x=.055;break;default:o=1,b=.6,x=.15;break}if(g===2&&(x=x-.005),g===3){const _=.3050108932461874;o=.95-_*b,b=b+_,x=.6*x}let l=Math.pow(P,o)/(Math.sqrt(C)*Math.pow(a,b));return l=(1+x)*S/l-x,i===9&&(l=1),{rho_slug_per_ft3:h,pamb_psi:u,PWV_psi:s,pair_psi:d,WAR:k,RGAS:T,temp_R:R,hpc:l,delta:P,theta:a,rgrs:C}}const lr=.002377;function Ot(r,t){return .5*r*t*t}function qt(r){return r*5280/3600}function $t(){const{fixture:r,setFixture:t}=we(),[i,n]=v.useState(""),[m,s]=v.useState(""),[p,u]=v.useState(""),[d,P]=v.useState(null),[k,T]=v.useState(null);v.useEffect(()=>{var a,y,h;r.env?(n(((a=r.env.barometer_inHg)==null?void 0:a.toString())||"29.92"),s(((y=r.env.temperature_F)==null?void 0:y.toString())||"75"),u(((h=r.env.relHumidity_pct)==null?void 0:h.toString())||"50")):(n("29.92"),s("75"),u("50"))},[r.env]),v.useEffect(()=>{try{const a=parseFloat(i),y=parseFloat(m),h=parseFloat(p);if(isNaN(a)||isNaN(y)||isNaN(h)){P(null),T(null);return}const g=Gr({barometer_inHg:a,temperature_F:y,relHumidity_pct:h});P(g),T(null)}catch(a){T(a instanceof Error?a.message:String(a)),P(null)}},[i,m,p]);const C=()=>{var a,y,h,j,g;try{const S=parseFloat(i),o=parseFloat(m),b=parseFloat(p);if(isNaN(S)||isNaN(o)||isNaN(b)){alert("Please enter valid numbers for all fields");return}t({...r,env:{elevation_ft:((a=r.env)==null?void 0:a.elevation_ft)??0,barometer_inHg:S,temperature_F:o,relHumidity_pct:b,wind_mph:((y=r.env)==null?void 0:y.wind_mph)??0,wind_angle_deg:((h=r.env)==null?void 0:h.wind_angle_deg)??0,trackTemp_F:((j=r.env)==null?void 0:j.trackTemp_F)??o,tractionIndex:((g=r.env)==null?void 0:g.tractionIndex)??1}}),alert("‚úì Applied environment values to VB6 UI Fixture!")}catch(S){alert(`Error: ${S instanceof Error?S.message:String(S)}`)}},R=d?(d.rho_slug_per_ft3-lr)/lr*100:0;return e.jsxs("div",{style:{padding:"2rem",height:"100%",overflow:"auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Environment & Air Model"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Visualize air density calculations and dynamic pressure at various speeds."})]}),k&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem",fontSize:"0.875rem",color:"#991b1b"},children:k}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Environmental Conditions"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem"},children:"Barometer (inHg)"}),e.jsx("input",{type:"text",value:i,onChange:a=>n(a.target.value),placeholder:"29.92",style:{width:"100%",padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem"},children:"Temperature (¬∞F)"}),e.jsx("input",{type:"text",value:m,onChange:a=>s(a.target.value),placeholder:"75",style:{width:"100%",padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.5rem"},children:"Relative Humidity (%)"}),e.jsx("input",{type:"text",value:p,onChange:a=>u(a.target.value),placeholder:"50",style:{width:"100%",padding:"0.5rem",fontSize:"0.875rem",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-bg)"}})]})]}),e.jsx("button",{onClick:C,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Apply to current VB6 UI Fixture"})]}),d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Computed Air Density"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginBottom:"0.25rem"},children:"Air Density (œÅ)"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",fontFamily:"monospace"},children:d.rho_slug_per_ft3.toFixed(6)}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"slugs/ft¬≥"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginBottom:"0.25rem"},children:"Standard œÅ"}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",fontFamily:"monospace"},children:lr.toFixed(6)}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:"slugs/ft¬≥ (sea level, 59¬∞F)"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginBottom:"0.25rem"},children:"Delta from Standard"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",fontFamily:"monospace",color:R>0?"#10b981":R<0?"#ef4444":"inherit"},children:[R>=0?"+":"",R.toFixed(2),"%"]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:R>0?"Denser (more power)":R<0?"Thinner (less power)":"Standard"})]})]}),e.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem",backgroundColor:"#1e293b",borderRadius:"var(--radius-sm)",fontFamily:"monospace",fontSize:"0.75rem",color:"#e2e8f0"},children:[e.jsx("div",{style:{marginBottom:"0.25rem"},children:e.jsx("strong",{children:"Intermediate Values:"})}),e.jsxs("div",{children:["Ambient Pressure: ",d.pamb_psi.toFixed(4)," psi"]}),e.jsxs("div",{children:["Water Vapor Pressure: ",d.PWV_psi.toFixed(4)," psi"]}),e.jsxs("div",{children:["Dry Air Pressure: ",d.pair_psi.toFixed(4)," psi"]}),e.jsxs("div",{children:["Water-to-Air Ratio: ",d.WAR.toFixed(6)]}),e.jsxs("div",{children:["Gas Constant: ",d.RGAS.toFixed(4)," ft¬∑lbf/(lbm¬∑¬∞R)"]}),e.jsxs("div",{children:["Temperature: ",d.temp_R.toFixed(2)," ¬∞R"]})]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Dynamic Pressure (q) at Various Speeds"}),e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#1e293b",color:"#e2e8f0"},children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",borderBottom:"2px solid var(--color-border)"},children:"Speed (MPH)"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"Speed (ft/s)"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"q (psf)"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"q (psi)"})]})}),e.jsx("tbody",{children:[10,50,100,200].map((a,y)=>{const h=qt(a),j=Ot(d.rho_slug_per_ft3,h),g=j/144;return e.jsxs("tr",{style:{backgroundColor:y%2===0?"transparent":"rgba(0,0,0,0.02)"},children:[e.jsx("td",{style:{padding:"0.75rem",borderBottom:"1px solid var(--color-border)"},children:a}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",borderBottom:"1px solid var(--color-border)"},children:h.toFixed(2)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",borderBottom:"1px solid var(--color-border)"},children:j.toFixed(4)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",borderBottom:"1px solid var(--color-border)"},children:g.toFixed(6)})]},a)})})]}),e.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.75rem",color:"var(--color-muted)"},children:[e.jsx("strong",{children:"Note:"})," Dynamic pressure q = 0.5 √ó œÅ √ó v¬≤. Used in drag force calculation: F_drag = Cd √ó A √ó q"]})]})]})]})}function cr(r,t,i,n,m){let s=0;for(s=0;s<i-1&&!(m<=r[s+1]);s++);s>=i-1&&(s=i-2),s<0&&(s=0);const p=r[s],u=r[s+1],d=t[s],P=t[s+1];if(u===p)return d;const k=(m-p)/(u-p);return d+k*(P-d)}function Vr(r,t,i,n,m){let s,p;if(m)s=1+4e-5*i,p=s*r*Le/12;else{const u=(Math.pow(t,1.4)+r-16)/(.171*Math.pow(r,1.7));s=1+u*135e-7*Math.pow(i,1.6);const d=1+u*35e-5*i;d<s&&(s=d),p=(s-.035*Math.abs(n))*r*Le/12}return{TireGrowth:s,TireCirFt:p}}function Ur(r,t){return(1-(r-1)*.01)/Math.pow(t,.25)}function Or(r){return r?ct:mt}function Jt(r,t){if(!(t!=null&&t.enabled))return 1;const{activateTime_s:i,duration_s:n,throttlePct:m,rampTime_s:s=0}=t,p=i+n;if(r<i||r>=p)return 1;const u=m/100;if(s>0&&r<i+s){const d=(r-i)/s;return 1-(1-u)*d}if(s>0&&r>p-s){const d=(p-r)/s;return 1-(1-u)*d}return u}function Qt(r,t,i,n,m){const s=r.Gear;let p;const u=r.Gear!==r.PrevGear;if(u)p=t.DTShift,r.PrevGear=r.Gear;else{if(p=n,r.Ags0_g>0&&r.L>1){const G=Math.min(r.AgsMax_g/r.Ags0_g,10);p=n*Math.pow(G,4)}p>.1&&(p=.1)}let d=0;const P=r.time_s-r.Time0_s;P>0&&(d=(r.AGS_g-r.Ags0_g)/P),d<Ue&&(d=Ue),d>Oe&&(d=Oe),r.Vel0_ftps=r.Vel_ftps,r.Ags0_g=r.AGS_g,r.Time0_s=r.time_s,r.Dist0_ft=r.Dist_ft,r.RPM0=r.EngRPM,r.DSRPM0=r.DSRPM,r.RPM0===t.LaunchRPM&&r.Time0_s===0&&(r.RPM0=t.Stall,t.LaunchRPM<t.Stall&&(r.Time0_s=t.EnginePMI*(t.Stall-t.LaunchRPM)/25e4));const k=Vr(t.TireDia_in,t.TireWidth_in,r.Vel_ftps,r.Ags0_g,i.isLandSpeed);r.TireGrowth=k.TireGrowth,r.TireCirFt=k.TireCirFt;let T;i.isLandSpeed?T=1.01+(i.TractionIndex-1)*.01:T=1.02+(.005*(i.TractionIndex-1)+3*(i.TrackTempEffect-1))*(1-Math.pow(r.Dist0_ft/1320,2));const C=t.TGR[s-1]??1,R=t.TiresPMI+t.TransPMI*Math.pow(t.GearRatio,2)*Math.pow(C,2);let a=r.Vel0_ftps+r.Ags0_g*J*p+d*J*p*p/2;a<r.Vel0_ftps*.9&&r.Vel0_ftps>100&&(a=r.Vel0_ftps),a<0&&(a=0);const y=t.ShiftRPM[s-1]??9e3;if(!u&&(p<.005&&(p=.005),p>.05&&(p=.05),a=r.Vel0_ftps+r.Ags0_g*J*p+d*J*p*p/2,r.Vel0_ftps>0&&r.RPM0>t.Stall&&s<t.NGR)){const G=r.Vel0_ftps*(y+5)/r.RPM0;a>G&&(a=G,r.Ags0_g*J>0&&(p=(a-r.Vel0_ftps)/(r.Ags0_g*J)))}const h=a*a-r.Vel0_ftps*r.Vel0_ftps,j=T*a*60/r.TireCirFt,g=j*t.GearRatio*C;let S=t.Slippage*g,o,b=t.Stall,x=0;t.isClutch?(S<t.Stall&&(s===1||!t.LockUp)&&(S=t.Stall),o=g/S):s===1||!t.LockUp?(b=t.Stall,x=t.Slippage*g/b,r.L>2&&(x>.6&&(b=b*(1+(t.Slippage-1)*(x-.6)/(1/t.Slippage-.6))),x=t.Slippage*g/b),o=1/t.Slippage,S<b&&(S=b,o=(t.TorqueMult-(t.TorqueMult-1)*x)*g/b)):(S=1.005*g,o=g/S),o>1&&(o=1);let l=cr(t.xrpm,t.yhp,t.NHP,1,S);l=t.HPTQMult*l/i.hpc,t.RevLimiterRPM>0&&S>=t.RevLimiterRPM&&(l=l*.05);const _=Jt(r.time_s,m);l=l*_;const A=l;l=l*o;const I=Math.sqrt(a*a+2*a*(i.WindSpeed_mph/$e)*Math.cos(Le*i.WindAngle_deg/180)+Math.pow(i.WindSpeed_mph/$e,2)),N=Math.sign(I)*i.rho*Math.pow(Math.abs(I),2)/(2*J);let Q;t.BodyStyle===8?Q=t.RefArea_ft2+(r.TireGrowth-1)*t.TireDia_in/2*t.TireWidth_in/144:Q=t.RefArea_ft2+(r.TireGrowth-1)*t.TireDia_in/2*(2*t.TireWidth_in)/144;const ee=t.Weight_lbf+t.LiftCoef*Q*N,ne=i.isLandSpeed?Br:Hr,se=i.isLandSpeed?tt:ot,te=i.isLandSpeed?it:nt,re=(ne-r.Dist0_ft/1320*se)*ee+1e-4*ee*($e*a)+t.DragCoef*Q*N,Y=re*a/550,de=12*r.TireCirFt/(2*Le),oe=(r.Ags0_g*t.Weight_lbf*(t.YCG_in-de+te/t.Efficiency*de)+re*t.YCG_in)/t.Wheelbase_in;let c=t.StaticFWt_lbf-oe,w=0;c<0&&(w=-c*t.Wheelbase_in/64,c=0);let B=ee-c-w;B<0&&(B=t.Weight_lbf);const F=Ur(i.TractionIndex,i.TrackTempEffect),z=Or(i.isLandSpeed);let D=F*z*t.TireDia_in*(t.TireWidth_in+1)*(.92+.08*Math.pow(B/1900,2.15));t.BodyStyle===8&&(D=.5*D);const E=(D/r.TireGrowth-re)/t.Weight_lbf,Z=t.TGEff[s-1]??.99;l=l*Z*t.Efficiency/T;const V=l;l=l-Y;let L=550*J*l/t.Weight_lbf,W=L/(a*J),pe=!1;W>E&&(pe=!0,L=L*(E-(W-E))/W,W=E-(W-E)),W<be&&(W=be,L=be*J*a);let ce=Math.max(0,h)/(2*L)+r.Time0_s;const Me=i.isLandSpeed?st:lt,Ae=i.isLandSpeed?at:dt;let me=t.EnginePMI*S*(S-r.RPM0);me<0&&(t.isClutch?me=Me*me:me=Ae*me);let je=R*j*(j-r.DSRPM0);je<0&&(je=0);let Ie=0,ae=0,xe=0;for(xe=1;xe<=12;xe++){const G=ce-r.Time0_s;if(G<=0)break;const M=Math.pow(2*Le/60,2)/(12*550*G);Ie=me*M,ae=je*M,l=(A-Ie)*o,l=(l*Z*t.Efficiency-ae)/T-Y,L=550*J*l/t.Weight_lbf,W=L/(a*J);let ie=0;G!==0&&(ie=(W-r.Ags0_g)/G),ie<Ue&&(ie=Ue,W=r.Ags0_g+ie*G,L=W*J*a),ie>Oe&&(ie=Oe,W=r.Ags0_g+ie*G,L=W*J*a),pe=!1,W>E&&(pe=!0,L=L*(E-(W-E))/W,W=E-(W-E)),W<be&&(W=be,L=be*J*a);const ze=Math.max(0,h)/(2*L)+r.Time0_s,Fe=ze-r.Time0_s;if(xe===12||Math.abs(100*(Fe-G)/Fe)<=.01){ce=ze;break}let he=l/A;he<Pr&&(he=Pr),he>kr&&(he=kr),ce=r.Time0_s+G+he*(Fe-G)}const Se=ce-r.Time0_s;let ve;if(L<.1||Se<=0){const G=(r.Vel0_ftps+a)/2;ve=r.Dist0_ft+Math.max(0,G*Math.abs(Se))}else{const G=Math.pow(r.Vel0_ftps,3),M=2*L*Se+r.Vel0_ftps*r.Vel0_ftps;if(M<0){const ie=(r.Vel0_ftps+a)/2;ve=r.Dist0_ft+ie*Se}else ve=(Math.pow(M,1.5)-G)/(3*L)+r.Dist0_ft}return r.L+=1,r.time_s=ce,r.Vel_ftps=a,r.Dist_ft=ve,r.AGS_g=W,r.EngRPM=S,r.DSRPM=j,r.SLIP=pe,{TimeStep_s:p,VelSqrd:h,LockRPM:g,ClutchSlip:o,zStall:b,SlipRatio:x,TireSlip:T,WindFPS:I,q:N,RefArea2_ft2:Q,DownForce_lbf:ee,DragForce_lbf:re,DragHP:Y,DynamicFWT_lbf:c,DynamicRWT_lbf:B,WheelBarWT_lbf:w,CRTF:D,AMax_g:E,ChassisPMI:R,EngAccHP:me,ChasAccHP:je,HPSave:A,HPAtWheels:V,HP:l,PQWT:L,iterations:xe}}function Xt(r,t,i){const n=Vr(r.TireDia_in,r.TireWidth_in,0,0,t.isLandSpeed),m=cr(r.xrpm,r.yhp,r.NHP,1,i);let u=5252*(r.HPTQMult*m/t.hpc)/i;const d=r.TGR[0]??1,P=r.TGEff[0]??.99;u=u*r.TorqueMult*d*P;const k=t.isLandSpeed?Br:Hr,T=t.WindSpeed_mph/$e,C=Math.sign(T)*t.rho*Math.pow(Math.abs(T),2)/(2*J),R=k*r.Weight_lbf+r.DragCoef*r.RefArea_ft2*C;let a;t.isLandSpeed?a=1.01+(t.TractionIndex-1)*.01:a=1.02+(t.TractionIndex-1)*.005+(t.TrackTempEffect-1)*3;const y=u*r.GearRatio*r.Efficiency/(a*r.TireDia_in/24)-R;let j=(r.isClutch?.88:.96)*y/r.Weight_lbf;const S=r.Weight_lbf-r.StaticFWt_lbf,o=Ur(t.TractionIndex,t.TrackTempEffect),b=Or(t.isLandSpeed);let x=o*b*r.TireDia_in*(r.TireWidth_in+1)*(.92+.08*Math.pow(S/1900,2.15));r.BodyStyle===8&&(x=.5*x);const l=(x-R)/r.Weight_lbf;return j>l&&(j=l),j<be&&(j=be),{L:1,time_s:0,Vel_ftps:.001,Dist_ft:0,AGS_g:j,EngRPM:i,DSRPM:0,Gear:1,SLIP:!1,Vel0_ftps:0,Ags0_g:j,Time0_s:0,Dist0_ft:0,RPM0:i,DSRPM0:0,AgsMax_g:j,TireGrowth:n.TireGrowth,TireCirFt:n.TireCirFt,ShiftFlag:0,PrevGear:1}}function Kt(r,t,i,n){let m=r*.11*Math.pow(t*i/n,-.3333333333333333);return m=m/15,m<.005&&(m=.005),m}function Yt(r){const t=Lr[r];return t?t.lengthFt:r==="EIGHTH"?660:1320}function Zt(r){const t=ir[r];return t||(r==="EIGHTH"?ir.EIGHTH:ir.QUARTER)}function eo(r){if(!r)return 1;const t=r.toUpperCase();return t==="GAS+CARB"||t==="GASOLINE+CARBURETOR"?1:t==="GAS+INJECT"||t==="GASOLINE+FUEL INJECTION"?2:t==="METHANOL+CARB"||t==="METHANOL+CARBURETOR"?3:t==="METHANOL+INJECT"||t==="METHANOL+FUEL INJECTION"?4:t==="NITRO+INJECT"||t==="NITROMETHANE+FUEL INJECTION"?5:t==="GAS+SUPERCHARGED"||t==="GASOLINE+SUPERCHARGED"?6:t==="METHANOL+SUPERCHARGED"?7:t==="NITRO+SUPERCHARGED"||t==="NITROMETHANE+SUPERCHARGED"?8:t==="ELECTRIC"?9:t.includes("SUPERCHARG")||t.includes("BLOWN")?t.includes("NITRO")?8:t.includes("METHANOL")||t.includes("ALCOHOL")?7:6:t.includes("INJECT")||t.includes("EFI")?t.includes("NITRO")?5:t.includes("METHANOL")||t.includes("ALCOHOL")?4:2:t.includes("NITRO")?5:t.includes("METHANOL")||t.includes("ALCOHOL")?3:t.includes("ELECTRIC")?9:1}function ro(r){var k,T,C,R;const t=r.vehicle,i=r.engine??t.engine,n=(i==null?void 0:i.hpCurve)??(i==null?void 0:i.torqueCurve)??t.torqueCurve??t.hpCurve??[];console.log("[VB6Exact] extractHPCurve sources:",{"engine?.hpCurve":(k=i==null?void 0:i.hpCurve)==null?void 0:k.length,"engine?.torqueCurve":(T=i==null?void 0:i.torqueCurve)==null?void 0:T.length,"vehicle.torqueCurve":(C=t.torqueCurve)==null?void 0:C.length,"vehicle.hpCurve":(R=t.hpCurve)==null?void 0:R.length,"resolved hpCurve length":n.length,"first 2 points":n.slice(0,2)});const m=[],s=[];for(const a of n)Array.isArray(a)?(m.push(a[0]),s.push(a[1])):a&&typeof a=="object"&&(m.push(a.rpm),a.hp!==void 0?s.push(a.hp):a.torque!==void 0?s.push(a.torque*a.rpm/5252):a.tq_lbft!==void 0&&s.push(a.tq_lbft*a.rpm/5252));if(m.length>=2)return console.log("[VB6Exact] Using QuarterPro HP curve:",{NHP:m.length,rpmRange:`${Math.min(...m)} - ${Math.max(...m)}`,hpRange:`${Math.min(...s)} - ${Math.max(...s)}`,peakHP:Math.max(...s),curve:m.map((a,y)=>`${a}:${s[y]}`).join(", ")}),{xrpm:m,yhp:s,NHP:m.length,isQuarterJr:!1};const p=Number(t.powerHP??t.peakHP),u=Number(t.rpmAtPeakHP??t.peakRPM??6500),d=Number(t.displacement_cid??t.displacementCID??350),P=r.fuelSystem??t.fuelSystem??1;if(Number.isFinite(p)&&p>0){const a=bt({peakHP:p,peakRPM:u,displacement_cid:d,fuelSystem:P}),{rpm:y,hp:h}=xt(a);return{xrpm:y,yhp:h,NHP:a.NHP,isQuarterJr:!0,quarterJrParams:{peakHP:p,rpmAtPeakHP:u,displacement_cid:d,fuelSystem:P}}}return{xrpm:[4e3,6500],yhp:[100,150],NHP:2,isQuarterJr:!1}}function to(r){const t=Math.abs(100-r);let i;return r>100?i=1+25e-7*Math.pow(t,2.5):i=1+2e-6*Math.pow(t,2.5),i>1.04&&(i=1.04),i}function oo(r){var hr,pr,ur,gr,fr,br,xr,vr,yr;const t=[],i=[],n=r.vehicle,m=r.env,s=r.raceLength??"QUARTER",p=r.raceLengthFt??Yt(s),u=((hr=Lr[s])==null?void 0:hr.category)==="landspeed",d=n.rolloutIn??9,P=n.overhangIn??0;let k=2*d;k<24&&(k=24);let T=(P+.25*k)/12;const C=.5*k/12;T<C&&(T=C);const R=d/12,a=r.drivetrain??n.drivetrain,y=(a==null?void 0:a.clutch)??r.clutch??n.clutch,h=(a==null?void 0:a.converter)??r.converter??n.converter,j=r.engine??n.engine,g=r.pmi??n.pmi,S=r.throttleStop,o=S!=null&&S.enabled?{enabled:!0,activateTime_s:S.activateTime_s,duration_s:S.duration_s,throttlePct:S.throttlePct,rampTime_s:S.rampTime_s}:void 0,b=n.transmissionType??r.transmissionType,x=b==="clutch"?!0:b==="converter"?!1:!h||y&&!h,l=r.fuel,_=typeof l=="string"?l:(l==null?void 0:l.fuelType)??(l==null?void 0:l.fuelSystem)??(l==null?void 0:l.type)??r.fuelType??r.fuelSystem??n.fuelSystem??n.fuelType,A=eo(_);console.log("[VB6Exact] Fuel system detection:",{rawFuel:l,fuelString:_,fuelSystemType:A,"vehicle.fuelType":n.fuelType,"vehicle.fuelSystem":n.fuelSystem});const I=Gr({barometer_inHg:m.barometerInHg??29.92,temperature_F:m.temperatureF??59,relHumidity_pct:m.humidityPct??50,elevation_ft:m.elevation??0,fuelSystem:A}),N=I.rho_slug_per_ft3*J,Q=I.hpc;console.log("[VB6Exact] Air/HPC calculation:",{rho_lbm_ft3:N.toFixed(4),hpc:Q.toFixed(4),fuelSystemType:A});const ee=ro(r),{xrpm:ne,yhp:se,NHP:te,isQuarterJr:le,quarterJrParams:re}=ee;te<2&&t.push("HP curve has fewer than 2 points"),le&&t.push("Using QuarterJr mode (synthetic HP curve from peak HP)");const Y=(a==null?void 0:a.gearRatios)??n.gearRatios??[2.5,1.8,1.4,1.1,1],de=(a==null?void 0:a.finalDriveRatio)??n.finalDrive??n.rearGear??3.73,oe=Y.length,c=n.tire,w=(c==null?void 0:c.diameter_in)??n.tireDiaIn??32,B=(c==null?void 0:c.width_in)??n.tireWidthIn??17,F=n.bodyStyle??ht(n.weightLb);let z,D,E,Z,V,L,W,pe,De,ce,Me,Ae;if(le&&re){const{displacement_cid:H,fuelSystem:ye}=re;z=pt(oe,!x);const X=n.shiftRPM??(a==null?void 0:a.shiftRPM)??7e3;D=Y.map(()=>X);const U=(y==null?void 0:y.slipRPM)??(h==null?void 0:h.stallRPM)??n.slipStallRPM??5e3;if(x)Z=vt(U),V=1,E=U;else{const rr=(h==null?void 0:h.diameter_in)??(h==null?void 0:h.diameter)??n.converterDiameterIn??n.converterDia_in??10;let ue;if(U>220){E=U;const O=ut(ne,se,te,1,E)*(_t/E)/Q;ue=E/1e3*(E/O)}else ue=U,E=U;const Ge=ue/(200*Math.pow(7/rr,4));Z=1.01+Ge/20+ue/8e3,V=2.633-Math.pow(Ge,.3)-ue/1500,V<1&&(V=1),V>2&&(V=2)}De=yt(F);const K=gt(F);ce=K.dragCoef,Me=K.liftCoef,Ae=K.overhang_in;const q=ft(H,ye,!x,oe,w,B,F);L=q.enginePMI,W=q.transPMI,pe=q.tiresPMI}else{z=(a==null?void 0:a.perGearEff)??n.gearEfficiencies??null??Y.map(()=>.99),D=(a==null?void 0:a.shiftRPMs)??(a==null?void 0:a.shiftsRPM)??n.shiftRPMs??Y.map(()=>7e3);const ye=(y==null?void 0:y.slipRPM)??n.clutchSlipRPM??7200,X=(h==null?void 0:h.stallRPM)??n.converterStallRPM??5500;E=x?ye:X;const U=(y==null?void 0:y.slippageFactor)??(y==null?void 0:y.slippage)??(y==null?void 0:y.slipRatio)??n.clutchSlippage??1.0025,K=(h==null?void 0:h.slippageFactor)??(h==null?void 0:h.slippage)??(h==null?void 0:h.slipRatio)??n.converterSlippage??1.06;Z=x?U:K,V=x?1:(h==null?void 0:h.torqueMult)??(h==null?void 0:h.torqueMultiplier)??n.converterTorqueMult??2.2,L=(g==null?void 0:g.engine_flywheel_clutch)??n.enginePMI??(j==null?void 0:j.enginePMI)??4,pe=(g==null?void 0:g.tires_wheels_ringgear)??n.tiresPMI??(j==null?void 0:j.tiresPMI)??.5,W=(g==null?void 0:g.transmission_driveshaft)??n.transPMI??(j==null?void 0:j.transPMI)??.2,De=(a==null?void 0:a.overallEfficiency)??n.transEfficiency??.97;const q=r.aero??n.aero;ce=(q==null?void 0:q.Cd)??(q==null?void 0:q.cd)??n.cd??.35,Me=(q==null?void 0:q.Cl)??(q==null?void 0:q.cl)??n.liftCoeff??0,Ae=P}const me=n.cgHeight_in??n.cgHeightIn??w/2+3.75,je=n.staticFrontWeight_lb??n.staticFrontWeightLb??n.weightLb*.38,Ie=le?Ae:P,ae={Weight_lbf:n.weightLb,Wheelbase_in:n.wheelbaseIn??100,YCG_in:me,StaticFWt_lbf:je,TireDia_in:w,TireWidth_in:B,Rollout_in:n.rolloutIn??12,GearRatio:de,TGR:Y,TGEff:z,Efficiency:De,DTShift:x?.2:.25,Slippage:Z,TorqueMult:V,Stall:E,LockUp:(h==null?void 0:h.lockup)??!1,isClutch:x,RefArea_ft2:((pr=r.aero)==null?void 0:pr.frontalArea_ft2)??n.frontalArea_ft2??n.frontalAreaFt2??20,DragCoef:ce,LiftCoef:Me,BodyStyle:F,EnginePMI:L,TiresPMI:pe,TransPMI:W,xrpm:ne,yhp:se,NHP:te,HPTQMult:n.hpTorqueMultiplier??(j==null?void 0:j.hpTqMult)??1,ShiftRPM:D,NGR:oe,LaunchRPM:x?(y==null?void 0:y.launchRPM)??n.clutchLaunchRPM??E:E,ShiftMode:n.shiftMode??"rpm",ShiftTimes:n.shiftTimes??[],RevLimiterRPM:n.revLimiterRPM??0};if(le&&Ie!==P){let H=2*d;H<24&&(H=24),T=(Ie+.25*H)/12;const ye=.5*H/12;T<ye&&(T=ye)}const xe=m.trackTempF??100,Se=u?1:to(xe),ve={rho:N,hpc:Q,TractionIndex:m.tractionIndex??5,TrackTempEffect:Se,WindSpeed_mph:m.windMph??0,WindAngle_deg:m.windAngleDeg??0,isLandSpeed:u},G=x?(y==null?void 0:y.launchRPM)??E:E,M=Xt(ae,ve,G),ie=cr(ne,se,te,1,G),mr=Kt(60,ie,V,n.weightLb),ze=u?5e4:5e3,Fe=u?300:30,he={iterations:[],convergenceHistory:[]},Ze=[],er=Zt(s);let Ne=0,We=null,Re=null,Pe=null;for(let H=0;H<ze&&!(M.Dist_ft-R+T>=p+50||M.time_s>=Fe);H++){if(!Number.isFinite(M.Vel_ftps)||!Number.isFinite(M.Dist_ft)||!Number.isFinite(M.AGS_g)){t.push(`NaN detected at step ${H}: Vel=${M.Vel_ftps}, Dist=${M.Dist_ft}, AGS=${M.AGS_g}`);break}const X=Qt(M,ae,ve,mr,o);if(he.iterations.push(X.iterations),H<20&&he.convergenceHistory.push({step:H,iterations:X.iterations,HPSave:X.HPSave,HP:X.HP,PQWT:X.PQWT,AGS_g:M.AGS_g}),We===null&&M.Dist_ft>=R){const $=(M.Dist_ft-R)/M.Vel_ftps;We=M.time_s-$}const U=Math.max(0,M.Dist_ft-R+T),K=We!==null?M.time_s-We:0,q=ae.TGR[M.Gear-1]??1,rr=(X.LockRPM??M.EngRPM)/q,ue=X.TireSlip,Ge=M.Vel_ftps*ue*Ee,_r=(o==null?void 0:o.enabled)&&K>=o.activateTime_s&&K<o.activateTime_s+o.duration_s;if(i.push({t_s:K,s_ft:U,v_fps:M.Vel_ftps,v_mph:M.Vel_ftps*Ee,a_g:M.AGS_g,rpm:M.EngRPM,dsrpm:rr,lockRpm:X.LockRPM,gear:M.Gear,slip:M.SLIP,tireSlip:ue,hp:X.HPAtWheels,dragHp:X.DragHP,netHp:X.HP,wheelSpeed_mph:Ge,throttleStopActive:_r}),Re===null&&U>=594){const O=i.length>1?((ur=i[i.length-2])==null?void 0:ur.s_ft)??0:0,$=i.length>1?((gr=i[i.length-2])==null?void 0:gr.t_s)??0:0;if(O<594&&U>O){const Ce=(594-O)/(U-O);Re=$+Ce*(K-$)}else Re=K}if(Pe===null&&U>=1254){const O=i.length>1?((fr=i[i.length-2])==null?void 0:fr.s_ft)??0:0,$=i.length>1?((br=i[i.length-2])==null?void 0:br.t_s)??0:0;if(O<1254&&U>O){const Ce=(1254-O)/(U-O);Pe=$+Ce*(K-$)}else Pe=K}for(;Ne<er.length&&U>=er[Ne];){const O=er[Ne],$=i.length>1?((xr=i[i.length-2])==null?void 0:xr.s_ft)??0:0,Ce=i.length>1?((vr=i[i.length-2])==null?void 0:vr.t_s)??0:0;let Te=K;if($<O&&U>$){const Qr=(O-$)/(U-$);Te=Ce+Qr*(K-Ce)}let Ve;O===660&&Re!==null&&Te>Re?Ve=Ee*66/(Te-Re):O===1320&&Pe!==null&&Te>Pe?Ve=Ee*66/(Te-Pe):Ve=M.Vel_ftps*Ee,Ze.push({d_ft:O,t_s:Te,v_mph:Ve}),Ne++}if(M.ShiftFlag===1)M.ShiftFlag=2,M.Gear++;else if(M.ShiftFlag===2)M.ShiftFlag=0;else if(M.Gear<ae.NGR)if((ae.ShiftMode??"rpm")==="time"){const $=(yr=ae.ShiftTimes)==null?void 0:yr[M.Gear-1];$!==void 0&&M.time_s>=$&&(M.ShiftFlag=1)}else{const $=ae.ShiftRPM[M.Gear-1]??7e3;M.EngRPM>=$&&(M.ShiftFlag=1)}}const ke=Ze.find(H=>H.d_ft===p),qr=(ke==null?void 0:ke.t_s)??M.time_s,$r=(ke==null?void 0:ke.v_mph)??M.Vel_ftps*Ee,Jr=i.map(H=>({t_s:H.t_s,s_ft:H.s_ft,v_mph:H.v_mph,v_fps:H.v_fps,a_g:H.a_g,rpm:H.rpm,dsrpm:H.dsrpm,lockRpm:H.lockRpm,gear:H.gear,slip:H.slip,tireSlip:H.tireSlip,hp:H.hp,dragHp:H.dragHp,wheelSpeed_mph:H.wheelSpeed_mph}));return{et_s:qr,mph:$r,timeslip:Ze,traces:Jr,meta:{model:"VB6Exact",steps:i.length,warnings:t},vb6Diagnostics:he}}const io={name:"VB6Exact",simulate:oo};function no(){const[r,t]=v.useState(new Set),[i,n]=v.useState(new Set(["QUARTER"])),[m,s]=v.useState(!1),[p,u]=v.useState([]),[d,P]=v.useState(null),k=o=>{const b=new Set(r);b.has(o)?b.delete(o):b.add(o),t(b)},T=o=>{const b=new Set(i);b.has(o)?b.delete(o):b.add(o),n(b)},C=()=>{t(new Set(Je.map(o=>o.name)))},R=()=>{t(new Set)},a=(o,b)=>{const x=dr[o];if(!x)throw new Error(`Benchmark config not found: ${o}`);return Wt(x),{vehicle:{id:`benchmark_${o}`,name:o,weightLb:x.vehicle.weightLb,tireDiaIn:x.vehicle.tireDiaIn??x.vehicle.tireRolloutIn/Math.PI,rearGear:x.vehicle.rearGear??x.vehicle.finalDrive,rolloutIn:x.vehicle.rolloutIn,powerHP:x.vehicle.torqueCurve?Math.max(...x.vehicle.torqueCurve.map(_=>_.hp??0)):x.vehicle.powerHP,defaultRaceLength:b,torqueCurve:x.vehicle.torqueCurve,frontalArea_ft2:x.vehicle.frontalArea_ft2,cd:x.vehicle.cd,gearRatios:x.vehicle.gearRatios,shiftRPM:x.vehicle.shiftRPM,wheelbaseIn:x.vehicle.wheelbaseIn,overhangIn:x.vehicle.overhangIn,tireRolloutIn:x.vehicle.tireRolloutIn,tireWidthIn:x.vehicle.tireWidthIn,liftCoeff:x.vehicle.liftCoeff,rrCoeff:x.vehicle.rrCoeff,finalDrive:x.vehicle.finalDrive??x.vehicle.rearGear,transEff:x.vehicle.transEff,gearEff:x.vehicle.gearEff,converter:x.vehicle.converter,clutch:x.vehicle.clutch},env:{elevation:x.env.elevation,barometerInHg:x.env.barometerInHg,temperatureF:x.env.temperatureF,humidityPct:x.env.humidityPct},raceLength:b}},y=async()=>{if(r.size===0||i.size===0){P("Please select at least one benchmark and one race length");return}s(!0),P(null),u([]);const o=[];try{for(const b of r){const x=Je.find(l=>l.name===b);if(x)for(const l of i){const _=x.raceLengthTargets[l];if(_)try{const A=a(b,l),I=io.simulate(A),N=Nt(x,l,I.et_s,I.mph);o.push({benchmarkName:b,raceLength:l,targetET:_.et_s,targetMPH:_.mph,actualET:I.et_s,actualMPH:I.mph,etDelta:N.etDelta,mphDelta:N.mphDelta,etPass:N.etPass,mphPass:N.mphPass,pass:N.pass,etTolerance:N.etTolerance,mphTolerance:N.mphTolerance})}catch(A){console.error(`Error running ${b} ${l}:`,A),o.push({benchmarkName:b,raceLength:l,targetET:_.et_s,targetMPH:_.mph,actualET:0,actualMPH:0,etDelta:0,mphDelta:0,etPass:!1,mphPass:!1,pass:!1,etTolerance:_.tolET_s,mphTolerance:_.tolMPH})}}}u(o)}catch(b){P(b instanceof Error?b.message:String(b))}finally{s(!1)}},h=o=>{alert(`TODO: Load ${o} fixture into VB6 Inputs and navigate to Run Inspector`)},j=()=>{if(p.length===0){alert("No results to export");return}const o=["Benchmark","Distance","Target ET (s)","Actual ET (s)","ET Delta (s)","ET Tolerance (s)","ET Pass","Target MPH","Actual MPH","MPH Delta","MPH Tolerance","MPH Pass","Overall Pass"],b=p.map(I=>[I.benchmarkName,I.raceLength,I.targetET.toFixed(3),I.actualET.toFixed(3),I.etDelta.toFixed(3),I.etTolerance.toFixed(3),I.etPass?"PASS":"FAIL",I.targetMPH.toFixed(2),I.actualMPH.toFixed(2),I.mphDelta.toFixed(2),I.mphTolerance.toFixed(2),I.mphPass?"PASS":"FAIL",I.pass?"PASS":"FAIL"]),x=[o.join(","),...b.map(I=>I.join(","))].join(`
`),l=new Blob([x],{type:"text/csv"}),_=URL.createObjectURL(l),A=document.createElement("a");A.href=_,A.download=`parity-results-${Date.now()}.csv`,A.click(),URL.revokeObjectURL(_)},g=p.filter(o=>o.pass).length,S=p.length;return e.jsxs("div",{style:{padding:"2rem",height:"100%",overflow:"auto"},children:[e.jsxs("div",{style:{marginBottom:"2rem"},children:[e.jsx("h2",{style:{marginTop:0,marginBottom:"0.5rem"},children:"Parity Runner"}),e.jsx("p",{style:{color:"var(--color-muted)",fontSize:"0.875rem",margin:0},children:"Run benchmark tests and compare VB6Exact against Quarter Pro/Jr targets."})]}),d&&e.jsx("div",{style:{padding:"1rem",backgroundColor:"#fee2e2",border:"1px solid #ef4444",borderRadius:"var(--radius-md)",marginBottom:"1rem",fontSize:"0.875rem",color:"#991b1b"},children:d}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem",fontWeight:"600"},children:"Select Benchmarks"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("button",{onClick:C,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Select All"}),e.jsx("button",{onClick:R,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Select None"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.5rem",marginBottom:"1rem"},children:Je.map(o=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",cursor:"pointer",fontSize:"0.875rem"},children:[e.jsx("input",{type:"checkbox",checked:r.has(o.name),onChange:()=>k(o.name)}),e.jsx("span",{children:o.name}),e.jsxs("span",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:["(",o.source,")"]})]},o.name))}),e.jsx("h3",{style:{marginTop:"1rem",marginBottom:"0.75rem",fontSize:"1rem",fontWeight:"600"},children:"Race Lengths"}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:i.has("EIGHTH"),onChange:()=>T("EIGHTH")}),e.jsx("span",{children:"EIGHTH (660 ft)"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:i.has("QUARTER"),onChange:()=>T("QUARTER")}),e.jsx("span",{children:"QUARTER (1320 ft)"})]})]})]}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx("button",{onClick:y,disabled:m,style:{padding:"0.75rem 1.5rem",fontSize:"0.875rem",fontWeight:"500",backgroundColor:m?"#9ca3af":"#10b981",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:m?"not-allowed":"pointer"},children:m?"Running...":"Run Selected Benchmarks"})}),p.length>0&&e.jsx("div",{style:{padding:"1rem",backgroundColor:g===S?"#d1fae5":"#fee2e2",border:`1px solid ${g===S?"#10b981":"#ef4444"}`,borderRadius:"var(--radius-md)",marginBottom:"1rem"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:"1rem",fontWeight:"600"},children:g===S?"‚úì All Tests Passed":`‚ö† ${S-g} Test(s) Failed`}),e.jsxs("div",{style:{fontSize:"0.875rem"},children:[g," / ",S," passed"]})]})}),p.length>0&&e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--color-surface)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem",fontWeight:"600"},children:"Results"}),e.jsx("button",{onClick:j,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"var(--radius-md)",cursor:"pointer"},children:"Export CSV"})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",fontSize:"0.875rem",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#1e293b",color:"#e2e8f0"},children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",borderBottom:"2px solid var(--color-border)"},children:"Benchmark"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"center",borderBottom:"2px solid var(--color-border)"},children:"Distance"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"Target ET"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"Actual ET"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"ET Œî"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"Target MPH"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"Actual MPH"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",borderBottom:"2px solid var(--color-border)"},children:"MPH Œî"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"center",borderBottom:"2px solid var(--color-border)"},children:"Status"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"center",borderBottom:"2px solid var(--color-border)"},children:"Actions"})]})}),e.jsx("tbody",{children:p.map((o,b)=>e.jsxs("tr",{style:{backgroundColor:b%2===0?"transparent":"rgba(0,0,0,0.02)"},children:[e.jsx("td",{style:{padding:"0.75rem",borderBottom:"1px solid var(--color-border)"},children:o.benchmarkName}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center",borderBottom:"1px solid var(--color-border)"},children:o.raceLength}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",borderBottom:"1px solid var(--color-border)"},children:o.targetET.toFixed(3)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",borderBottom:"1px solid var(--color-border)"},children:o.actualET.toFixed(3)}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",color:o.etPass?"#10b981":"#ef4444",borderBottom:"1px solid var(--color-border)"},children:[o.etDelta>=0?"+":"",o.etDelta.toFixed(3)]}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",borderBottom:"1px solid var(--color-border)"},children:o.targetMPH.toFixed(2)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",borderBottom:"1px solid var(--color-border)"},children:o.actualMPH.toFixed(2)}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right",fontFamily:"monospace",color:o.mphPass?"#10b981":"#ef4444",borderBottom:"1px solid var(--color-border)"},children:[o.mphDelta>=0?"+":"",o.mphDelta.toFixed(2)]}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center",borderBottom:"1px solid var(--color-border)"},children:e.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"9999px",fontSize:"0.75rem",fontWeight:"600",backgroundColor:o.pass?"#10b981":"#ef4444",color:"white"},children:o.pass?"PASS":"FAIL"})}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center",borderBottom:"1px solid var(--color-border)"},children:e.jsx("button",{onClick:()=>h(o.benchmarkName),style:{padding:"0.25rem 0.75rem",fontSize:"0.75rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"var(--radius-sm)",cursor:"pointer"},children:"Open in Run Inspector"})})]},`${o.benchmarkName}-${o.raceLength}`))})]})})]})]})}const f={container:{padding:"1rem"},tabs:{display:"flex",gap:"0.25rem",marginBottom:"1rem",borderBottom:"1px solid var(--color-border)"},tab:{padding:"0.75rem 1.5rem",border:"none",background:"transparent",cursor:"pointer",fontSize:"0.875rem",fontWeight:500,color:"var(--color-muted)",borderBottom:"2px solid transparent",marginBottom:"-1px"},tabActive:{color:"var(--color-primary)",borderBottomColor:"var(--color-primary)"},section:{marginBottom:"1.5rem"},sectionHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem"},sectionTitle:{fontSize:"0.875rem",fontWeight:600,textTransform:"uppercase",color:"var(--color-muted)"},card:{backgroundColor:"var(--color-background)",border:"1px solid var(--color-border)",borderRadius:"var(--radius-md)",overflow:"hidden"},row:{display:"flex",alignItems:"center",gap:"1rem",padding:"0.75rem 1rem",borderBottom:"1px solid var(--color-border)"},badge:{padding:"0.25rem 0.5rem",borderRadius:"9999px",fontSize:"0.75rem",fontWeight:600},button:{padding:"0.5rem 1rem",borderRadius:"var(--radius-sm)",border:"none",cursor:"pointer",fontSize:"0.875rem",fontWeight:500},primaryBtn:{backgroundColor:"var(--color-primary)",color:"white"},secondaryBtn:{backgroundColor:"var(--color-surface)",color:"var(--color-text)",border:"1px solid var(--color-border)"},dangerBtn:{backgroundColor:"#dc2626",color:"white"},smallBtn:{padding:"0.25rem 0.5rem",fontSize:"0.75rem"},input:{width:"100%",padding:"0.5rem",borderRadius:"var(--radius-sm)",border:"1px solid var(--color-border)",backgroundColor:"var(--color-background)",color:"var(--color-text)",fontSize:"0.875rem"},formGroup:{marginBottom:"1rem"},label:{display:"block",fontSize:"0.875rem",fontWeight:500,marginBottom:"0.25rem"},modal:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},modalContent:{backgroundColor:"var(--color-surface)",borderRadius:"var(--radius-lg)",padding:"1.5rem",width:"500px",maxWidth:"90vw",maxHeight:"90vh",overflow:"auto"},checkboxGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))",gap:"0.5rem"},checkbox:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.75rem"}},so=[{id:"quarter_jr",name:"Quarter Jr"},{id:"quarter_pro",name:"Quarter Pro"},{id:"bonneville_pro",name:"Bonneville Pro"},{id:"engine_pro",name:"Engine Pro"},{id:"fourlink",name:"Four Link"},{id:"cam_analyzer",name:"Cam Analyzer"}];function lo({user:r,onClose:t,onSave:i,onDelete:n}){const[m,s]=v.useState((r==null?void 0:r.email)||""),[p,u]=v.useState((r==null?void 0:r.name)||""),[d,P]=v.useState((r==null?void 0:r.role)||"user"),[k,T]=v.useState((r==null?void 0:r.products)||[]),[C,R]=v.useState(""),a=h=>{T(j=>j.includes(h)?j.filter(g=>g!==h):[...j,h])},y=h=>{h.preventDefault(),i({email:m,name:p,role:d,products:k,...C?{password:C}:{}}),t()};return e.jsx("div",{style:f.modal,onClick:t,children:e.jsxs("div",{style:f.modalContent,onClick:h=>h.stopPropagation(),children:[e.jsx("h3",{style:{marginTop:0},children:r?"Edit User":"Create User"}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Email"}),e.jsx("input",{style:f.input,type:"email",value:m,onChange:h=>s(h.target.value),required:!0,disabled:!!r})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Name"}),e.jsx("input",{style:f.input,type:"text",value:p,onChange:h=>u(h.target.value),required:!0})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Role"}),e.jsxs("select",{style:f.input,value:d,onChange:h=>P(h.target.value),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"beta",children:"Beta Tester"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"owner",children:"Owner"})]})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Products"}),e.jsx("div",{style:f.checkboxGrid,children:so.map(h=>e.jsxs("label",{style:f.checkbox,children:[e.jsx("input",{type:"checkbox",checked:k.includes(h.id),onChange:()=>a(h.id)}),h.name]},h.id))})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:r?"New Password (leave blank to keep)":"Password"}),e.jsx("input",{style:f.input,type:"password",value:C,onChange:h=>R(h.target.value),...!r&&{required:!0,minLength:6}})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"1rem"},children:[r&&n&&e.jsx("button",{type:"button",style:{...f.button,...f.dangerBtn},onClick:()=>{n(),t()},children:"Delete"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginLeft:"auto"},children:[e.jsx("button",{type:"button",style:{...f.button,...f.secondaryBtn},onClick:t,children:"Cancel"}),e.jsx("button",{type:"submit",style:{...f.button,...f.primaryBtn},children:r?"Save":"Create"})]})]})]})]})})}function ao({role:r,products:t,onClose:i,onSave:n,onDelete:m}){const[s,p]=v.useState((r==null?void 0:r.name)||""),[u,d]=v.useState((r==null?void 0:r.description)||""),[P,k]=v.useState((r==null?void 0:r.color)||"#6b7280"),[T,C]=v.useState((r==null?void 0:r.products)||[]),[R,a]=v.useState((r==null?void 0:r.additionalFeatures)||[]),[y,h]=v.useState((r==null?void 0:r.canManageUsers)||!1),[j,g]=v.useState((r==null?void 0:r.canManageRoles)||!1),[S,o]=v.useState((r==null?void 0:r.sortOrder)||50),b=_=>{_.preventDefault(),n({name:s,description:u,color:P,products:T,additionalFeatures:R,canManageUsers:y,canManageRoles:j,isSystem:(r==null?void 0:r.isSystem)||!1,sortOrder:S}),i()},x=_=>{C(A=>A.includes(_)?A.filter(I=>I!==_):[...A,_])},l=_=>{a(A=>A.includes(_)?A.filter(I=>I!==_):[...A,_])};return e.jsx("div",{style:f.modal,onClick:i,children:e.jsxs("div",{style:f.modalContent,onClick:_=>_.stopPropagation(),children:[e.jsx("h3",{style:{marginTop:0},children:r?"Edit Role":"Create Role"}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 100px",gap:"1rem"},children:[e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Name"}),e.jsx("input",{style:f.input,value:s,onChange:_=>p(_.target.value),required:!0})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Color"}),e.jsx("input",{type:"color",style:{...f.input,height:"38px",padding:"2px"},value:P,onChange:_=>k(_.target.value)})]})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Description"}),e.jsx("textarea",{style:{...f.input,minHeight:"50px"},value:u,onChange:_=>d(_.target.value)})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Products Access"}),e.jsx("div",{style:f.checkboxGrid,children:t.map(_=>e.jsxs("label",{style:f.checkbox,children:[e.jsx("input",{type:"checkbox",checked:T.includes(_.id),onChange:()=>x(_.id)}),e.jsx("span",{style:{color:_.color},children:_.icon})," ",_.name]},_.id))})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Additional Features"}),e.jsx("div",{style:f.checkboxGrid,children:zr.filter(_=>["dev_tools","user_management","role_management","system_settings","view_analytics","beta_features"].includes(_)).map(_=>e.jsxs("label",{style:f.checkbox,children:[e.jsx("input",{type:"checkbox",checked:R.includes(_),onChange:()=>l(_)}),_.replace(/_/g," ")]},_))})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem"},children:[e.jsxs("label",{style:f.checkbox,children:[e.jsx("input",{type:"checkbox",checked:y,onChange:_=>h(_.target.checked)}),"Can Manage Users"]}),e.jsxs("label",{style:f.checkbox,children:[e.jsx("input",{type:"checkbox",checked:j,onChange:_=>g(_.target.checked)}),"Can Manage Roles"]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Sort Order"}),e.jsx("input",{type:"number",style:f.input,value:S,onChange:_=>o(parseInt(_.target.value)||0)})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"1rem"},children:[r&&!r.isSystem&&m&&e.jsx("button",{type:"button",style:{...f.button,...f.dangerBtn},onClick:()=>{m(),i()},children:"Delete"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginLeft:"auto"},children:[e.jsx("button",{type:"button",style:{...f.button,...f.secondaryBtn},onClick:i,children:"Cancel"}),e.jsx("button",{type:"submit",style:{...f.button,...f.primaryBtn},children:r?"Save":"Create"})]})]})]})]})})}function co({product:r,onClose:t,onSave:i,onDelete:n}){const[m,s]=v.useState((r==null?void 0:r.name)||""),[p,u]=v.useState((r==null?void 0:r.description)||""),[d,P]=v.useState((r==null?void 0:r.icon)||"üì¶"),[k,T]=v.useState((r==null?void 0:r.color)||"#6b7280"),[C,R]=v.useState((r==null?void 0:r.features)||[]),[a,y]=v.useState((r==null?void 0:r.isPremium)||!1),[h,j]=v.useState((r==null?void 0:r.sortOrder)||50),g=o=>{o.preventDefault(),i({name:m,description:p,icon:d,color:k,features:C,isPremium:a,sortOrder:h}),t()},S=o=>{R(b=>b.includes(o)?b.filter(x=>x!==o):[...b,o])};return e.jsx("div",{style:f.modal,onClick:t,children:e.jsxs("div",{style:f.modalContent,onClick:o=>o.stopPropagation(),children:[e.jsx("h3",{style:{marginTop:0},children:r?"Edit Product":"Create Product"}),e.jsxs("form",{onSubmit:g,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"60px 1fr 100px",gap:"1rem"},children:[e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Icon"}),e.jsx("input",{style:{...f.input,textAlign:"center",fontSize:"1.5rem"},value:d,onChange:o=>P(o.target.value)})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Name"}),e.jsx("input",{style:f.input,value:m,onChange:o=>s(o.target.value),required:!0})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Color"}),e.jsx("input",{type:"color",style:{...f.input,height:"38px",padding:"2px"},value:k,onChange:o=>T(o.target.value)})]})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Description"}),e.jsx("textarea",{style:{...f.input,minHeight:"50px"},value:p,onChange:o=>u(o.target.value)})]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Features"}),e.jsx("div",{style:f.checkboxGrid,children:zr.filter(o=>!["dev_tools","user_management","role_management","system_settings","view_analytics","beta_features"].includes(o)).map(o=>e.jsxs("label",{style:f.checkbox,children:[e.jsx("input",{type:"checkbox",checked:C.includes(o),onChange:()=>S(o)}),o.replace(/_/g," ")]},o))})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("label",{style:f.checkbox,children:[e.jsx("input",{type:"checkbox",checked:a,onChange:o=>y(o.target.checked)}),"Premium Product"]}),e.jsxs("div",{style:f.formGroup,children:[e.jsx("label",{style:f.label,children:"Sort Order"}),e.jsx("input",{type:"number",style:f.input,value:h,onChange:o=>j(parseInt(o.target.value)||0)})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"1rem"},children:[r&&n&&e.jsx("button",{type:"button",style:{...f.button,...f.dangerBtn},onClick:()=>{n(),t()},children:"Delete"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginLeft:"auto"},children:[e.jsx("button",{type:"button",style:{...f.button,...f.secondaryBtn},onClick:t,children:"Cancel"}),e.jsx("button",{type:"submit",style:{...f.button,...f.primaryBtn},children:r?"Save":"Create"})]})]})]})]})})}function mo(){var g,S,o,b,x;const r=Dr(),[t,i]=v.useState("users"),[n,m]=v.useState(null),[s,p]=v.useState(null),[u,d]=v.useState(null),[P,k]=v.useState([]),[T,C]=v.useState(!0),[R,a]=v.useState(null),y=r.getAllRoles(),h=r.getAllProducts(),j=async()=>{C(!0),a(null);try{const l=await qe.getAll();k(l.users)}catch(l){a(l.message||"Failed to load users")}finally{C(!1)}};return v.useEffect(()=>{j()},[]),e.jsxs("div",{style:f.container,children:[e.jsxs("div",{style:{marginBottom:"1rem",padding:"0.75rem",backgroundColor:"#fef3c7",borderRadius:"var(--radius-sm)",fontSize:"0.75rem"},children:[e.jsx("strong",{children:"Current User:"})," ",(g=r.user)==null?void 0:g.email," (Role: ",(S=r.user)==null?void 0:S.roleId,")",e.jsx("br",{}),e.jsx("strong",{children:"User Role Object:"})," ",((o=r.getUserRole())==null?void 0:o.name)||"NOT FOUND",e.jsx("br",{}),e.jsx("strong",{children:"Products:"})," ",((x=(b=r.getUserRole())==null?void 0:b.products)==null?void 0:x.join(", "))||"NONE",e.jsx("br",{}),e.jsx("button",{onClick:()=>{r.resetAuthData(),window.location.reload()},style:{...f.button,...f.dangerBtn,marginTop:"0.5rem"},children:"üîÑ Reset All Auth Data"})]}),e.jsx("div",{style:f.tabs,children:["users","roles","products"].map(l=>e.jsx("button",{style:{...f.tab,...t===l?f.tabActive:{}},onClick:()=>i(l),children:l==="users"?`üë• Users (${P.length})`:l==="roles"?`üé≠ Roles (${y.length})`:`üì¶ Products (${h.length})`},l))}),t==="users"&&e.jsxs("div",{style:f.section,children:[e.jsxs("div",{style:f.sectionHeader,children:[e.jsx("span",{style:f.sectionTitle,children:"Database Users (API)"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{style:{...f.button,...f.secondaryBtn},onClick:j,children:"üîÑ Refresh"}),e.jsx("button",{style:{...f.button,...f.primaryBtn},onClick:()=>m("new"),children:"+ Add User"})]})]}),R&&e.jsx("div",{style:{padding:"0.75rem",backgroundColor:"#fee2e2",color:"#991b1b",borderRadius:"var(--radius-sm)",marginBottom:"0.5rem"},children:R}),T?e.jsx("div",{style:{padding:"1rem",textAlign:"center",color:"var(--color-muted)"},children:"Loading users..."}):e.jsxs("div",{style:f.card,children:[P.map(l=>{var A;const _={owner:"#7c3aed",admin:"#dc2626",beta:"#2563eb",user:"#6b7280"};return e.jsxs("div",{style:f.row,children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:500},children:l.name}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:l.email})]}),e.jsx("span",{style:{...f.badge,backgroundColor:_[l.role]||"#6b7280",color:"white"},children:l.role}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:((A=l.products)==null?void 0:A.join(", "))||"no products"}),e.jsx("button",{style:{...f.button,...f.secondaryBtn,...f.smallBtn},onClick:()=>m(l),children:"Edit"})]},l.id)}),P.length===0&&e.jsx("div",{style:{padding:"1rem",textAlign:"center",color:"var(--color-muted)"},children:"No users found"})]})]}),t==="roles"&&e.jsxs("div",{style:f.section,children:[e.jsxs("div",{style:f.sectionHeader,children:[e.jsx("span",{style:f.sectionTitle,children:"All Roles"}),e.jsx("button",{style:{...f.button,...f.primaryBtn},onClick:()=>p("new"),children:"+ Add Role"})]}),e.jsx("div",{style:f.card,children:y.map(l=>e.jsxs("div",{style:f.row,children:[e.jsx("span",{style:{...f.badge,backgroundColor:l.color,color:"white"},children:l.name}),e.jsx("div",{style:{flex:1,fontSize:"0.75rem",color:"var(--color-muted)"},children:l.description}),e.jsxs("div",{style:{fontSize:"0.75rem"},children:[l.products.length," products, ",l.additionalFeatures.length," features"]}),l.isSystem&&e.jsx("span",{style:{...f.badge,backgroundColor:"#f3f4f6",color:"#4b5563"},children:"System"}),e.jsx("button",{style:{...f.button,...f.secondaryBtn,...f.smallBtn},onClick:()=>p(l),children:"Edit"})]},l.id))})]}),t==="products"&&e.jsxs("div",{style:f.section,children:[e.jsxs("div",{style:f.sectionHeader,children:[e.jsx("span",{style:f.sectionTitle,children:"All Products"}),e.jsx("button",{style:{...f.button,...f.primaryBtn},onClick:()=>d("new"),children:"+ Add Product"})]}),e.jsx("div",{style:f.card,children:h.map(l=>e.jsxs("div",{style:f.row,children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:l.icon}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:500,color:l.color},children:l.name}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)"},children:l.description})]}),e.jsxs("div",{style:{fontSize:"0.75rem"},children:[l.features.length," features"]}),l.isPremium&&e.jsx("span",{style:{...f.badge,backgroundColor:"#fef3c7",color:"#92400e"},children:"Premium"}),e.jsx("button",{style:{...f.button,...f.secondaryBtn,...f.smallBtn},onClick:()=>d(l),children:"Edit"})]},l.id))})]}),n&&e.jsx(lo,{user:n==="new"?null:n,onClose:()=>m(null),onSave:async l=>{try{n==="new"?await qe.create({email:l.email,password:l.password,name:l.name,role:l.role,products:l.products}):await qe.update(n.id,{name:l.name,role:l.role,products:l.products}),j()}catch(_){alert(_.message||"Failed to save user")}},onDelete:n!=="new"?async()=>{await qe.delete(n.id),j()}:void 0}),s&&e.jsx(ao,{role:s==="new"?null:s,products:h,onClose:()=>p(null),onSave:l=>{s==="new"?r.createRole(l):r.updateRole(s.id,l)},onDelete:s!=="new"?()=>r.deleteRole(s.id):void 0}),u&&e.jsx(co,{product:u==="new"?null:u,onClose:()=>d(null),onSave:l=>{u==="new"?r.createProduct(l):r.updateProduct(u.id,l)},onDelete:u!=="new"?()=>r.deleteProduct(u.id):void 0})]})}function ho(){const{user:r}=Dr(),[t,i]=v.useState([]),[n,m]=v.useState(null),[s,p]=v.useState(!1),[u,d]=v.useState(""),[P,k]=v.useState(!1),[T,C]=v.useState(null),R=(r==null?void 0:r.roleId)==="admin"||(r==null?void 0:r.roleId)==="owner",a=(r==null?void 0:r.roleId)==="owner";v.useEffect(()=>{nr().then(i)},[]);const y=[...Be,...t.filter(l=>!Be.some(_=>_.id===l.id))],h=u?y.filter(l=>l.name.toLowerCase().includes(u.toLowerCase())||l.city.toLowerCase().includes(u.toLowerCase())||l.state.toLowerCase().includes(u.toLowerCase())):y,j=()=>{if(!R){C({type:"error",text:"Only admins can add tracks"});return}m({id:`custom_${Date.now()}`,name:"",city:"",state:"",country:"USA",lat:0,lon:0,elevation_ft:0,length:"1/4"}),p(!0)},g=l=>{if(!R){C({type:"error",text:"Only admins can edit tracks"});return}if(Be.some(_=>_.id===l.id)){C({type:"error",text:"Built-in tracks cannot be edited. Create a copy instead."});return}m({...l}),p(!1)},S=l=>{if(!R){C({type:"error",text:"Only admins can add tracks"});return}m({...l,id:`custom_${Date.now()}`,name:`${l.name} (Copy)`}),p(!0)},o=async()=>{if(n){if(!n.name.trim()){C({type:"error",text:"Track name is required"});return}k(!0),C(null);try{if(s){const _=await jt(n);if(!_.success){C({type:"error",text:_.error||"Failed to save track"});return}}else{const _=await St(n.id,n);if(!_.success){C({type:"error",text:_.error||"Failed to update track"});return}}const l=await nr();i(l),m(null),p(!1),C({type:"success",text:s?"Track added successfully":"Track updated successfully"})}finally{k(!1)}}},b=async l=>{if(!a){C({type:"error",text:"Only owners can delete tracks"});return}if(Be.some(A=>A.id===l)){C({type:"error",text:"Built-in tracks cannot be deleted."});return}if(!confirm("Delete this track?"))return;k(!0);const _=await Rt(l);if(_.success){const A=await nr();i(A),C({type:"success",text:"Track deleted"})}else C({type:"error",text:_.error||"Failed to delete track"});k(!1)},x=l=>Be.some(_=>_.id===l);return e.jsxs("div",{children:[T&&e.jsx("div",{style:{padding:"10px 16px",marginBottom:"1rem",borderRadius:"6px",backgroundColor:T.type==="error"?"rgba(239, 68, 68, 0.1)":"rgba(34, 197, 94, 0.1)",color:T.type==="error"?"#ef4444":"#22c55e",border:`1px solid ${T.type==="error"?"#ef4444":"#22c55e"}`},children:T.text}),e.jsxs("div",{style:{marginBottom:"1rem",display:"flex",gap:"1rem",alignItems:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:j,className:"btn",style:{backgroundColor:R?"var(--color-primary)":"var(--color-muted)"},disabled:!R||P,children:"+ Add Track"}),e.jsx("input",{type:"text",placeholder:"Search tracks...",value:u,onChange:l=>d(l.target.value),className:"input",style:{width:"200px"}}),e.jsxs("span",{style:{color:"var(--color-muted)",fontSize:"0.85rem"},children:[h.length," tracks (",t.length," custom)"]}),!R&&e.jsx("span",{style:{color:"var(--color-muted)",fontSize:"0.8rem",fontStyle:"italic"},children:"(Admin access required to edit)"})]}),n&&e.jsxs("div",{className:"card",style:{marginBottom:"1rem",padding:"1rem"},children:[e.jsx("h4",{style:{marginBottom:"1rem"},children:s?"New Track":"Edit Track"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Track Name *"}),e.jsx("input",{type:"text",className:"input",value:n.name,onChange:l=>m({...n,name:l.target.value}),placeholder:"e.g., My Local Dragstrip"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"City"}),e.jsx("input",{type:"text",className:"input",value:n.city,onChange:l=>m({...n,city:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"State"}),e.jsx("input",{type:"text",className:"input",value:n.state,onChange:l=>m({...n,state:l.target.value}),maxLength:2,style:{width:"60px"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Latitude"}),e.jsx("input",{type:"number",className:"input",step:"0.0001",value:n.lat,onChange:l=>m({...n,lat:parseFloat(l.target.value)||0}),placeholder:"e.g., 34.0589"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Longitude"}),e.jsx("input",{type:"number",className:"input",step:"0.0001",value:n.lon,onChange:l=>m({...n,lon:parseFloat(l.target.value)||0}),placeholder:"e.g., -117.7517"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Elevation (ft)"}),e.jsx("input",{type:"number",className:"input",value:n.elevation_ft,onChange:l=>m({...n,elevation_ft:parseInt(l.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Track Angle (¬∞)"}),e.jsx("input",{type:"number",className:"input",step:"1",min:"0",max:"359",value:n.trackAngle??0,onChange:l=>m({...n,trackAngle:parseInt(l.target.value)||0}),placeholder:"0 = North"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--color-muted)",marginTop:"4px"},children:"Direction track points (0=N, 90=E, 180=S, 270=W)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Track Length"}),e.jsxs("select",{className:"input",value:n.length,onChange:l=>m({...n,length:l.target.value}),children:[e.jsx("option",{value:"1/4",children:"1/4 Mile"}),e.jsx("option",{value:"1/8",children:"1/8 Mile"}),e.jsx("option",{value:"both",children:"Both"})]})]})]}),e.jsxs("div",{style:{marginTop:"1rem",display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:o,className:"btn",style:{backgroundColor:"var(--color-primary)"},children:"Save Track"}),e.jsx("button",{onClick:()=>{m(null),p(!1)},className:"btn",children:"Cancel"})]})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.85rem"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"2px solid var(--color-border)"},children:[e.jsx("th",{style:{textAlign:"left",padding:"8px"},children:"Track Name"}),e.jsx("th",{style:{textAlign:"left",padding:"8px"},children:"Location"}),e.jsx("th",{style:{textAlign:"right",padding:"8px"},children:"Lat"}),e.jsx("th",{style:{textAlign:"right",padding:"8px"},children:"Lon"}),e.jsx("th",{style:{textAlign:"right",padding:"8px"},children:"Elev (ft)"}),e.jsx("th",{style:{textAlign:"right",padding:"8px"},children:"Angle"}),e.jsx("th",{style:{textAlign:"center",padding:"8px"},children:"Length"}),e.jsx("th",{style:{textAlign:"center",padding:"8px"},children:"Actions"})]})}),e.jsx("tbody",{children:h.map(l=>e.jsxs("tr",{style:{borderBottom:"1px solid var(--color-border)",backgroundColor:x(l.id)?"transparent":"rgba(34, 197, 94, 0.05)"},children:[e.jsxs("td",{style:{padding:"8px"},children:[l.name,x(l.id)&&e.jsx("span",{style:{marginLeft:"6px",fontSize:"0.7rem",color:"var(--color-muted)"},children:"(built-in)"})]}),e.jsxs("td",{style:{padding:"8px"},children:[l.city,", ",l.state]}),e.jsx("td",{style:{padding:"8px",textAlign:"right",fontFamily:"monospace"},children:l.lat.toFixed(4)}),e.jsx("td",{style:{padding:"8px",textAlign:"right",fontFamily:"monospace"},children:l.lon.toFixed(4)}),e.jsx("td",{style:{padding:"8px",textAlign:"right"},children:l.elevation_ft.toLocaleString()}),e.jsxs("td",{style:{padding:"8px",textAlign:"right"},children:[l.trackAngle??"-","¬∞"]}),e.jsx("td",{style:{padding:"8px",textAlign:"center"},children:l.length}),e.jsx("td",{style:{padding:"8px",textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"center"},children:[e.jsx("button",{onClick:()=>S(l),style:{padding:"4px 8px",fontSize:"0.75rem",border:"1px solid var(--color-border)",borderRadius:"4px",backgroundColor:"var(--color-bg-secondary)",cursor:"pointer"},title:"Copy track",children:"üìã"}),!x(l.id)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>g(l),style:{padding:"4px 8px",fontSize:"0.75rem",border:"1px solid var(--color-border)",borderRadius:"4px",backgroundColor:"var(--color-bg-secondary)",cursor:"pointer"},title:"Edit track",children:"‚úèÔ∏è"}),e.jsx("button",{onClick:()=>b(l.id),style:{padding:"4px 8px",fontSize:"0.75rem",border:"1px solid #ef4444",borderRadius:"4px",backgroundColor:"transparent",color:"#ef4444",cursor:"pointer"},title:"Delete track",children:"üóëÔ∏è"})]})]})})]},l.id))})]})}),e.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"var(--color-bg-secondary)",borderRadius:"8px",fontSize:"0.85rem"},children:[e.jsx("h4",{style:{marginBottom:"0.5rem"},children:"Track Angle"}),e.jsxs("p",{style:{color:"var(--color-muted)",margin:0},children:["The track angle is the compass direction the track points (direction cars travel down the strip). This is used to calculate the effective headwind/tailwind from the weather wind direction.",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"0¬∞"})," = North, ",e.jsx("strong",{children:"90¬∞"})," = East, ",e.jsx("strong",{children:"180¬∞"})," = South, ",e.jsx("strong",{children:"270¬∞"})," = West",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"Tip:"})," Use Google Maps to find coordinates. Right-click on the track location and copy the coordinates."]})]})]})}const _e=[{id:"settings",title:"‚öôÔ∏è Settings & Flags",component:wt,category:"core"},{id:"health-check",title:"ü©∫ Health Check",component:Mt,category:"core"},{id:"run-inspector",title:"‚ñ∂Ô∏è Run Inspector",component:Dt,category:"simulation"},{id:"energy",title:"‚ö° Energy Accounting",component:zt,category:"simulation"},{id:"input-inspector",title:"üîç Input Inspector",component:Vt,category:"data"},{id:"quick-paste",title:"üìã Quick Paste",component:Ut,category:"data"},{id:"air",title:"üå°Ô∏è Air Model",component:$t,category:"data"},{id:"parity",title:"üß™ Parity Runner",component:no,category:"testing"},{id:"users",title:"üë• User Management",component:mo,category:"core"},{id:"tracks",title:"üèÅ Track Editor",component:ho,category:"data"}];function uo(){const[r,t]=Fr(),i=r.get("panel"),[n,m]=v.useState(()=>i&&_e.some(u=>u.id===i)?i:_e.length>0?_e[0].id:"");v.useEffect(()=>{n&&t({panel:n},{replace:!0})},[n,t]),v.useEffect(()=>{i&&_e.some(u=>u.id===i)&&m(i)},[i]);const s=_e.find(u=>u.id===n),p=s==null?void 0:s.component;return e.jsx(Pt,{title:"Dev Portal",children:e.jsxs("div",{style:{display:"flex",gap:"1rem",minHeight:"70vh"},children:[e.jsxs("nav",{style:{width:"200px",flexShrink:0,borderRight:"1px solid var(--color-border)",paddingRight:"1rem"},children:[e.jsx("h3",{style:{fontSize:"0.875rem",fontWeight:"600",textTransform:"uppercase",color:"var(--color-muted)",marginBottom:"1rem"},children:"Dev Panels"}),e.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:_e.map(u=>e.jsx("li",{style:{marginBottom:"0.25rem"},children:e.jsx("button",{onClick:()=>m(u.id),style:{width:"100%",textAlign:"left",padding:"0.5rem 0.75rem",border:"none",background:n===u.id?"var(--color-primary)":"transparent",color:n===u.id?"white":"var(--color-text)",borderRadius:"var(--radius-sm)",cursor:"pointer",fontSize:"0.875rem",transition:"background-color 0.2s"},onMouseEnter:d=>{n!==u.id&&(d.currentTarget.style.backgroundColor="var(--color-surface)")},onMouseLeave:d=>{n!==u.id&&(d.currentTarget.style.backgroundColor="transparent")},children:u.title})},u.id))}),_e.length===0&&e.jsx("p",{style:{fontSize:"0.875rem",color:"var(--color-muted)",fontStyle:"italic"},children:"No panels registered"})]}),e.jsx("div",{style:{flex:1,minWidth:0,backgroundColor:"var(--color-surface)",borderRadius:"var(--radius-md)",overflow:"auto"},children:p?e.jsx(p,{}):e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:e.jsx("p",{style:{color:"var(--color-muted)"},children:"No panel selected"})})})]})})}export{uo as default};
//# sourceMappingURL=DevPortal-sND88ZTQ.js.map
